import{j as e}from"./query-vendor-DD8i-cqI.js";import{r as i}from"./react-vendor-CPrm261X.js";import{a as m,n as o}from"./index-d455q6tz.js";import{B as f}from"./Button-Y9hrQFtU.js";import"./animation-vendor-DKvKsx_2.js";const F=t=>Array.isArray(t)?t:t!=null&&t.data&&Array.isArray(t.data)?t.data:t!=null&&t.meetings&&Array.isArray(t.meetings)?t.meetings:[],L=t=>t!=null&&t.data?t.data:t,O=async t=>{try{const l=new URLSearchParams;t!=null&&t.status,t!=null&&t.upcoming;const s=l.toString()?`?${l.toString()}`:"",d=await m.get(`/admin/meetings${s}`);return F(d)}catch(l){return console.error("Failed to fetch meetings:",l),[]}},$=async t=>{const l=await m.post("/admin/meetings",t);return L(l)},I=async(t,l)=>{const s=await m.put(`/admin/meetings/${t}`,l);return L(s)},G=async t=>{try{return await m.patch(`/admin/meetings/${t}`,{status:"CANCELLED"}),!0}catch(l){throw console.error("Failed to cancel meeting:",l),l}},P=async t=>{try{const s=await m.get(`/admin/meetings/${t}/attendance`);return Array.isArray(s)?s:s!=null&&s.data&&Array.isArray(s.data)?s.data:s!=null&&s.attendance&&Array.isArray(s.attendance)?s.attendance:[]}catch(l){return console.error("Failed to fetch meeting attendance:",l),[]}},A={SCHEDULED:"bg-blue-100 text-blue-700",IN_PROGRESS:"bg-green-100 text-green-700",COMPLETED:"bg-gray-100 text-gray-700",CANCELLED:"bg-red-100 text-red-700"},E={AGM:"Annual General Meeting",SGM:"Special General Meeting",COMMITTEE:"Committee Meeting",OTHER:"Other"};function W(){const[t,l]=i.useState([]),[s,d]=i.useState(!0),[b,n]=i.useState(!1),[y,g]=i.useState(null),[u,x]=i.useState(null),[r,j]=i.useState([]),[w,N]=i.useState(!1),v=async()=>{d(!0);try{const a=await O();l(a)}catch(a){console.error(a),o.error("Failed to load meetings")}finally{d(!1)}};i.useEffect(()=>{v()},[]);const D=async a=>{if(confirm("Are you sure you want to cancel this meeting?"))try{await G(a),o.success("Meeting cancelled"),v()}catch{o.error("Failed to cancel meeting")}},C=async a=>{x(a);try{const c=await P(a.id);j(c),N(!0)}catch{o.error("Failed to load attendance")}},M=a=>new Date(a).toLocaleDateString("en-KE",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),T=a=>{const[c,p]=a.split(":"),h=parseInt(c||"0"),V=h>=12?"PM":"AM";return`${h%12||12}:${p||"00"} ${V}`},S=t.filter(a=>a.status==="SCHEDULED"&&new Date(a.date)>=new Date),k=t.filter(a=>a.status==="COMPLETED"||new Date(a.date)<new Date);return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-wiria-blue-dark mb-2",children:"Meeting Management"}),e.jsx("p",{className:"text-gray-600",children:"Schedule and manage organization meetings."})]}),e.jsx(f,{onClick:()=>{g(null),n(!0)},children:"+ Schedule Meeting"})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-700 mb-4",children:"Upcoming Meetings"}),s?e.jsx("div",{className:"bg-white rounded-xl shadow p-8 text-center",children:"Loading..."}):S.length===0?e.jsx("div",{className:"bg-white rounded-xl shadow p-8 text-center text-gray-500",children:"No upcoming meetings scheduled."}):e.jsx("div",{className:"grid gap-4",children:S.map(a=>e.jsxs("div",{className:"bg-white rounded-xl shadow p-6 border-l-4 border-blue-500",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-lg text-wiria-blue-dark",children:a.title}),e.jsx("p",{className:"text-sm text-gray-500",children:E[a.meetingType]})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${A[a.status]}`,children:a.status.replace("_"," ")})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Date"}),e.jsx("p",{className:"font-semibold",children:M(a.date)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Time"}),e.jsx("p",{className:"font-semibold",children:a.startTime&&a.endTime?`${T(a.startTime)} - ${T(a.endTime)}`:"TBD"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Location"}),e.jsx("p",{className:"font-semibold",children:a.isVirtual?"Virtual":a.location})]}),a.virtualLink&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Virtual Link"}),e.jsx("a",{href:a.virtualLink,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline font-semibold",children:"Join Meeting"})]})]}),e.jsxs("div",{className:"mt-4 flex gap-3",children:[e.jsx("button",{onClick:()=>{g(a),n(!0)},className:"text-wiria-blue-dark hover:underline text-sm font-bold",children:"Edit"}),e.jsx("button",{onClick:()=>D(a.id),className:"text-red-600 hover:underline text-sm font-bold",children:"Cancel"})]})]},a.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-700 mb-4",children:"Past Meetings"}),k.length===0?e.jsx("div",{className:"bg-white rounded-xl shadow p-8 text-center text-gray-500",children:"No past meetings."}):e.jsx("div",{className:"bg-white rounded-xl shadow overflow-hidden",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"Meeting"}),e.jsx("th",{className:"px-6 py-4",children:"Type"}),e.jsx("th",{className:"px-6 py-4",children:"Date"}),e.jsx("th",{className:"px-6 py-4",children:"Attendance"}),e.jsx("th",{className:"px-6 py-4",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y",children:k.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 font-semibold",children:a.title}),e.jsx("td",{className:"px-6 py-4 text-sm",children:E[a.meetingType]}),e.jsx("td",{className:"px-6 py-4 text-sm",children:M(a.date)}),e.jsxs("td",{className:"px-6 py-4 text-sm",children:[a.attendanceCount||0," members"]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${A[a.status]}`,children:a.status.replace("_"," ")})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("button",{onClick:()=>C(a),className:"text-wiria-blue-dark hover:underline text-sm font-bold",children:"View Attendance"})})]},a.id))})]})})]}),b&&e.jsx(_,{meeting:y,onClose:()=>n(!1),onSuccess:()=>{n(!1),v()}}),w&&u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg",children:[e.jsxs("div",{className:"p-6 border-b flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Meeting Attendance"}),e.jsx("p",{className:"text-sm text-gray-500",children:u.title})]}),e.jsx("button",{onClick:()=>N(!1),className:"text-gray-500 hover:text-gray-700",children:"âœ•"})]}),e.jsx("div",{className:"p-6 max-h-96 overflow-y-auto",children:r.length===0?e.jsx("p",{className:"text-center text-gray-500 py-4",children:"No attendance records."}):e.jsx("ul",{className:"divide-y",children:r.map(a=>{var c,p,h;return e.jsxs("li",{className:"py-3 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold",children:[(c=a.member)==null?void 0:c.firstName," ",(p=a.member)==null?void 0:p.lastName]}),e.jsx("p",{className:"text-xs text-gray-500",children:(h=a.member)==null?void 0:h.email})]}),e.jsx("p",{className:"text-xs text-gray-400",children:new Date(a.checkedInAt).toLocaleTimeString()})]},a.id)})})}),e.jsx("div",{className:"p-6 border-t",children:e.jsx(f,{variant:"secondary",fullWidth:!0,onClick:()=>N(!1),children:"Close"})})]})})]})}function _({meeting:t,onClose:l,onSuccess:s}){var u;const[d,b]=i.useState(!1),[n,y]=i.useState((t==null?void 0:t.isVirtual)||!1),g=async x=>{x.preventDefault(),b(!0);const r=new FormData(x.currentTarget),j={title:r.get("title"),description:r.get("description"),meetingType:r.get("meetingType"),date:r.get("date"),startTime:r.get("startTime"),endTime:r.get("endTime"),location:r.get("location"),isVirtual:n,virtualLink:n?r.get("virtualLink"):void 0,agenda:r.get("agenda")};try{t?(await I(t.id,j),o.success("Meeting updated")):(await $(j),o.success("Meeting scheduled")),s()}catch{o.error("Failed to save meeting")}finally{b(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsx("h3",{className:"text-xl font-bold",children:t?"Edit Meeting":"Schedule New Meeting"})}),e.jsx("div",{className:"p-6 overflow-y-auto flex-1",children:e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"meetingTitle",className:"block text-sm font-bold mb-2",children:"Meeting Title *"}),e.jsx("input",{id:"meetingTitle",name:"title",defaultValue:t==null?void 0:t.title,className:"w-full border rounded-lg p-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"meetingType",className:"block text-sm font-bold mb-2",children:"Meeting Type *"}),e.jsxs("select",{id:"meetingType",name:"meetingType",defaultValue:t==null?void 0:t.meetingType,className:"w-full border rounded-lg p-3",required:!0,children:[e.jsx("option",{value:"",children:"Select type..."}),e.jsx("option",{value:"AGM",children:"Annual General Meeting"}),e.jsx("option",{value:"SGM",children:"Special General Meeting"}),e.jsx("option",{value:"COMMITTEE",children:"Committee Meeting"}),e.jsx("option",{value:"OTHER",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"meetingDate",className:"block text-sm font-bold mb-2",children:"Date *"}),e.jsx("input",{id:"meetingDate",type:"date",name:"date",defaultValue:(u=t==null?void 0:t.date)==null?void 0:u.split("T")[0],className:"w-full border rounded-lg p-3",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"meetingStartTime",className:"block text-sm font-bold mb-2",children:"Start Time *"}),e.jsx("input",{id:"meetingStartTime",type:"time",name:"startTime",defaultValue:t==null?void 0:t.startTime,className:"w-full border rounded-lg p-3",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"meetingEndTime",className:"block text-sm font-bold mb-2",children:"End Time *"}),e.jsx("input",{id:"meetingEndTime",type:"time",name:"endTime",defaultValue:t==null?void 0:t.endTime,className:"w-full border rounded-lg p-3",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"meetingLocation",className:"block text-sm font-bold mb-2",children:"Location *"}),e.jsx("input",{id:"meetingLocation",name:"location",defaultValue:t==null?void 0:t.location,className:"w-full border rounded-lg p-3",placeholder:"e.g. WIRIA CBO Office, Nairobi",required:!0})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"isVirtual",checked:n,onChange:x=>y(x.target.checked)}),e.jsx("label",{htmlFor:"isVirtual",className:"font-semibold",children:"This is a virtual/hybrid meeting"})]}),n&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"meetingVirtualLink",className:"block text-sm font-bold mb-2",children:"Virtual Meeting Link"}),e.jsx("input",{id:"meetingVirtualLink",name:"virtualLink",defaultValue:t==null?void 0:t.virtualLink,className:"w-full border rounded-lg p-3",placeholder:"https://zoom.us/..."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"meetingDescription",className:"block text-sm font-bold mb-2",children:"Description"}),e.jsx("textarea",{id:"meetingDescription",name:"description",defaultValue:t==null?void 0:t.description,className:"w-full border rounded-lg p-3 h-20"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"meetingAgenda",className:"block text-sm font-bold mb-2",children:"Agenda"}),e.jsx("textarea",{id:"meetingAgenda",name:"agenda",defaultValue:t==null?void 0:t.agenda,className:"w-full border rounded-lg p-3 h-24",placeholder:"Meeting agenda items..."})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(f,{type:"submit",fullWidth:!0,disabled:d,children:d?"Saving...":t?"Update Meeting":"Schedule Meeting"}),e.jsx(f,{type:"button",variant:"secondary",fullWidth:!0,onClick:l,disabled:d,children:"Cancel"})]})]})})]})})}export{W as default};
//# sourceMappingURL=MeetingManagementPage-B-HDr4oT.js.map
