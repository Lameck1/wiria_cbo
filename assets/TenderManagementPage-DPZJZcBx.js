import{b as D,j as e}from"./query-vendor-DD8i-cqI.js";import{r as u}from"./react-vendor-CPrm261X.js";import{a as v,n as x}from"./index-BCEghY_F.js";import{u as k}from"./resources.api-DCLguSsM.js";import{B as E}from"./Button-Bwbs8nAk.js";import{e as P,g as A}from"./apiUtils-BfmRaJyO.js";import"./animation-vendor-DKvKsx_2.js";const q=async(s={})=>{const i=new URLSearchParams;s.status&&i.append("status",s.status),s.category&&i.append("category",s.category),s.all&&i.append("all","true");const n=i.toString(),m=`/tenders${n?`?${n}`:""}`;return v.get(m)},V=async s=>v.post("/tenders",s),F=async(s,i)=>v.patch(`/tenders/${s}`,i),I=async s=>v.delete(`/tenders/${s}`);function H(){const s=D(),[i,n]=u.useState([]),[m,p]=u.useState(!0),[f,g]=u.useState(null),[j,c]=u.useState(!1),b=async()=>{p(!0);try{const l=await q({all:!0});n(P(l))}catch(l){console.error(l),x.error("Failed to load tenders")}finally{p(!1)}};u.useEffect(()=>{b()},[]);const N=async l=>{if(confirm("Are you sure you want to delete this tender?"))try{await I(l),x.success("Tender deleted successfully"),s.invalidateQueries({queryKey:["tenders"]}),b()}catch{x.error("Failed to delete tender")}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-wiria-blue-dark",children:"Tender Management"}),e.jsx(E,{onClick:()=>{g(null),c(!0)},children:"+ Advertise New Tender"})]}),e.jsx("div",{className:"bg-white rounded-xl shadow overflow-hidden",children:m?e.jsx("div",{className:"p-8 text-center",children:"Loading..."}):e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"Ref No"}),e.jsx("th",{className:"px-6 py-4",children:"Title"}),e.jsx("th",{className:"px-6 py-4",children:"Deadline"}),e.jsx("th",{className:"px-6 py-4",children:"Document"}),e.jsx("th",{className:"px-6 py-4",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y",children:[i.map(l=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 font-mono text-sm",children:l.refNo}),e.jsx("td",{className:"px-6 py-4 font-semibold",children:l.title}),e.jsx("td",{className:"px-6 py-4 text-sm",children:new Date(l.deadline).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4",children:l.downloadUrl?e.jsx("span",{className:"inline-flex items-center gap-1 text-xs font-semibold px-2 py-1 rounded bg-green-100 text-green-700",children:"✓ Uploaded"}):e.jsx("span",{className:"inline-flex items-center gap-1 text-xs font-semibold px-2 py-1 rounded bg-yellow-100 text-yellow-700",children:"⚠ Missing"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(L,{tender:l})}),e.jsxs("td",{className:"px-6 py-4 text-right",children:[e.jsx("button",{onClick:()=>{g(l),c(!0)},className:"text-wiria-blue-dark hover:underline text-sm font-bold mr-3",children:"Edit"}),e.jsx("button",{onClick:()=>N(l.id),className:"text-red-600 hover:underline text-sm font-bold",children:"Delete"})]})]},l.id)),i.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-gray-500",children:"No tenders advertised yet."})})]})]})}),j&&e.jsx(O,{tender:f,onClose:()=>c(!1),onSuccess:()=>{c(!1),b()}})]})}function L({tender:s}){const n=s.status==="OPEN"&&new Date(s.deadline)<new Date?"EXPIRED":s.status,m={OPEN:"bg-green-100 text-green-700",CLOSED:"bg-red-100 text-red-700",AWARDED:"bg-blue-100 text-blue-700",CANCELLED:"bg-gray-100 text-gray-700",EXPIRED:"bg-yellow-100 text-yellow-700"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${m[n]||"bg-gray-100"}`,children:n})}function O({tender:s,onClose:i,onSuccess:n}){const m=D(),[p,f]=u.useState((s==null?void 0:s.eligibility)||["Legal registration in Kenya","Tax compliance"]),[g,j]=u.useState((s==null?void 0:s.requiredDocuments)||["Certificate of Incorporation","KRA PIN/Tax Compliance"]),[c,b]=u.useState(!1),N=(r,t,o)=>{r(a=>{const d=[...a];return d[t]=o,d})},l=r=>r(t=>[...t,""]),w=(r,t)=>r(o=>o.filter((a,d)=>d!==t)),T=async r=>{var C;r.preventDefault(),b(!0);const t=r.currentTarget,o=new FormData(t),a=Object.fromEntries(o.entries()),d=t.querySelector("#tender-file-input");let S=a.downloadUrl;try{if((C=d==null?void 0:d.files)!=null&&C.length){x.info("Uploading document...");const h=d.files[0];h&&(S=(await k(h,"tenders")).data.url)}const y={title:a.title,refNo:a.refNo,category:a.category,estimatedValue:a.estimatedValue,deadline:new Date(a.deadline).toISOString(),status:a.status,submissionMethod:a.submissionMethod,submissionEmail:a.submissionEmail,contactPerson:a.contactPerson,contactPhone:a.contactPhone,description:a.description,eligibility:p.filter(h=>h.trim()),requiredDocuments:g.filter(h=>h.trim()),downloadUrl:S};s?(await F(s.id,y),x.success("Tender updated")):(await V(y),x.success("Tender advertised")),m.invalidateQueries({queryKey:["tenders"]}),n()}catch(y){x.error(A(y,"Operation failed"))}finally{b(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-5xl max-h-[90vh] flex flex-col",children:[e.jsx("div",{className:"p-8 pb-4 border-b",children:e.jsx("h3",{className:"text-2xl font-bold",children:s?"Edit Tender":"Advertise New Tender"})}),e.jsx("div",{className:"p-8 pt-4 overflow-y-auto flex-1",children:e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-bold text-wiria-blue-dark border-b pb-1",children:"Basic Information"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",htmlFor:"tender-title",children:"Tender Title *"}),e.jsx("input",{id:"tender-title",name:"title",defaultValue:s==null?void 0:s.title,className:"w-full border rounded-lg p-2.5",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",htmlFor:"tender-refNo",children:"Reference No *"}),e.jsx("input",{id:"tender-refNo",name:"refNo",defaultValue:s==null?void 0:s.refNo,className:"w-full border rounded-lg p-2.5",required:!0,placeholder:"WIRIA/2025/..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",htmlFor:"tender-category",children:"Category *"}),e.jsx("input",{id:"tender-category",name:"category",defaultValue:s==null?void 0:s.category,className:"w-full border rounded-lg p-2.5",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",htmlFor:"tender-deadline",children:"Deadline *"}),e.jsx("input",{id:"tender-deadline",type:"datetime-local",name:"deadline",defaultValue:s!=null&&s.deadline?new Date(s.deadline).toISOString().slice(0,16):"",className:"w-full border rounded-lg p-2.5",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",htmlFor:"tender-estimatedValue",children:"Est. Value"}),e.jsx("input",{id:"tender-estimatedValue",name:"estimatedValue",defaultValue:s==null?void 0:s.estimatedValue,className:"w-full border rounded-lg p-2.5"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",htmlFor:"tender-status",children:"Status"}),e.jsxs("select",{id:"tender-status",name:"status",defaultValue:(s==null?void 0:s.status)||"OPEN",className:"w-full border rounded-lg p-2.5",children:[e.jsx("option",{value:"OPEN",children:"Open"}),e.jsx("option",{value:"CLOSED",children:"Closed"}),e.jsx("option",{value:"AWARDED",children:"Awarded"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-bold text-wiria-blue-dark border-b pb-1",children:"Submission & Contact"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",htmlFor:"tender-submissionMethod",children:"Submission Method *"}),e.jsxs("select",{id:"tender-submissionMethod",name:"submissionMethod",defaultValue:(s==null?void 0:s.submissionMethod)||"ONLINE",className:"w-full border rounded-lg p-2.5",children:[e.jsx("option",{value:"ONLINE",children:"Online (Email)"}),e.jsx("option",{value:"PHYSICAL",children:"Physical (Seal Box)"}),e.jsx("option",{value:"BOTH",children:"Both"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",htmlFor:"tender-submissionEmail",children:"Submission Email *"}),e.jsx("input",{id:"tender-submissionEmail",type:"email",name:"submissionEmail",defaultValue:(s==null?void 0:s.submissionEmail)||"tenders@wiria.org",className:"w-full border rounded-lg p-2.5",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",htmlFor:"tender-contactPerson",children:"Contact Person *"}),e.jsx("input",{id:"tender-contactPerson",name:"contactPerson",defaultValue:s==null?void 0:s.contactPerson,className:"w-full border rounded-lg p-2.5",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",htmlFor:"tender-contactPhone",children:"Contact Phone *"}),e.jsx("input",{id:"tender-contactPhone",name:"contactPhone",defaultValue:s==null?void 0:s.contactPhone,className:"w-full border rounded-lg p-2.5",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",htmlFor:"tender-file-input",children:"Tender Document (PDF)"}),e.jsx("input",{type:"file",id:"tender-file-input",className:"w-full border rounded-lg p-2 text-sm",accept:".pdf,.doc,.docx"}),e.jsx("input",{type:"hidden",name:"downloadUrl",defaultValue:s==null?void 0:s.downloadUrl})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-2",children:"Eligibility Criteria"}),p.map((r,t)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{"aria-label":`Eligibility criteria ${t+1}`,value:r,onChange:o=>N(f,t,o.target.value),className:"flex-1 border rounded-lg p-2 text-sm",required:!0}),e.jsx("button",{type:"button",onClick:()=>w(f,t),className:"text-red-500",children:"✕"})]},t)),e.jsx("button",{type:"button",onClick:()=>l(f),className:"text-xs text-blue-600 font-bold",children:"+ Add Criteria"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-2",children:"Required Documents"}),g.map((r,t)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{"aria-label":`Required document ${t+1}`,value:r,onChange:o=>N(j,t,o.target.value),className:"flex-1 border rounded-lg p-2 text-sm",required:!0}),e.jsx("button",{type:"button",onClick:()=>w(j,t),className:"text-red-500",children:"✕"})]},t)),e.jsx("button",{type:"button",onClick:()=>l(j),className:"text-xs text-blue-600 font-bold",children:"+ Add Document"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",htmlFor:"tender-description",children:"Full Description *"}),e.jsx("textarea",{id:"tender-description",name:"description",defaultValue:s==null?void 0:s.description,className:"w-full border rounded-lg p-3 h-24 text-sm",required:!0})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(E,{type:"submit",fullWidth:!0,disabled:c,children:c?"Saving...":s?"Update Tender":"Advertise Tender"}),e.jsx(E,{type:"button",variant:"secondary",fullWidth:!0,onClick:i,disabled:c,children:"Cancel"})]})]})})]})})}export{H as default};
//# sourceMappingURL=TenderManagementPage-DPZJZcBx.js.map
