import{j as e}from"./query-vendor-CM55eWOT.js";import{r as d}from"./react-vendor-CXp26_Hx.js";import{D as j,u as f}from"./useAdminData-91Z-y-lf.js";import{B as u}from"./Button-JX_3oChN.js";import{S as N}from"./StatusBadge-DxoyjbSs.js";import{d as h,n as m}from"./index-Ck6qqv4n.js";import{S as y}from"./Spinner-CSB2ADVs.js";import{b as v}from"./dateUtils-CLm2GaNA.js";import{M as w}from"./Modal-BGjbfc1U.js";import{g as b}from"./apiUtils-0UX-zM9U.js";import{A as M}from"./AdminPageHeader-BTeP1u2j.js";import"./animation-vendor-Bcu85ETC.js";function k({members:s=[],isLoading:t,onViewDetails:r}){const o=[{header:"Member #",key:"memberNumber",className:"font-mono font-semibold"},{header:"Name",key:"name",render:a=>`${a.firstName} ${a.lastName}`},{header:"Type",key:"membershipType",render:a=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`rounded-md px-2 py-1 text-[10px] font-bold uppercase ${a.membershipType==="GROUP"?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700"}`,children:a.membershipType}),a.membershipType==="GROUP"&&e.jsx("div",{className:"mt-1 text-[10px] font-medium text-gray-500",children:a.groupName})]})},{header:"Contact",key:"contact",render:a=>e.jsxs(e.Fragment,{children:[e.jsx("div",{children:a.email}),e.jsx("div",{className:"text-xs text-gray-500",children:a.phone})]})},{header:"Status",key:"status",render:a=>e.jsx(N,{status:a.status})},{header:"Payment",key:"payment",render:a=>e.jsx(S,{payments:a.payments})},{header:"Join Date",key:"joinDate",render:a=>new Date(a.joinDate).toLocaleDateString()},{header:"Actions",key:"actions",align:"right",render:a=>e.jsx(u,{size:"sm",onClick:()=>r(a),children:"Review"})}];return e.jsx("div",{className:"overflow-hidden rounded-2xl bg-white shadow-xl",children:e.jsx(j,{columns:o,data:s,isLoading:t,rowKey:"id",emptyMessage:"No members found matching your criteria.",className:"rounded-none border-none shadow-none"})})}function S({payments:s}){if(!s||s.length===0)return e.jsx("span",{className:"text-xs text-gray-400",children:"No payments"});const t=s[0];if(!t)return e.jsx("span",{className:"text-xs text-gray-400",children:"No payments"});const r=t.status==="COMPLETED"?"text-green-600":t.status==="FAILED"?"text-red-600":"text-yellow-600";return e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:["KES ",(t.amount||0).toLocaleString()]}),e.jsx("div",{className:`text-xs ${r}`,children:t.status})]})}function C({currentFilter:s,onFilterChange:t,onSearch:r}){const o=[{id:"ALL",label:"All Members"},{id:"PENDING",label:"Pending"},{id:"ACTIVE",label:"Active"},{id:"CANCELLED",label:"Cancelled"},{id:"EXPIRED",label:"Expired"}];return e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsx("div",{className:"flex space-x-2 overflow-x-auto border-b",children:o.map(a=>e.jsx("button",{onClick:()=>t(a.id),className:`whitespace-nowrap border-b-2 px-6 py-3 font-semibold transition-all ${s===a.id?"border-wiria-blue-dark text-wiria-blue-dark":"border-transparent text-gray-600 hover:text-wiria-blue-dark"}`,children:a.label},a.id))}),e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:"Search by name, email, phone, or member number...",className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-transparent focus:ring-2 focus:ring-wiria-blue-dark md:w-96",onChange:a=>r(a.target.value)})})]})}const D=async(s={})=>{const t=new URLSearchParams;return s.status&&s.status!=="ALL"&&t.append("status",s.status),s.search&&t.append("search",s.search),await h.get(`/admin/members?${t.toString()}`)},A=async s=>await h.patch(`/admin/members/${s}/approve`),L=async(s,t)=>await h.patch(`/admin/members/${s}/reject`,{reason:t});function P({memberId:s}){const[t,r]=d.useState([]),[o,a]=d.useState(!0);return d.useEffect(()=>{(async()=>{try{const c=await h.get(`/admin/members/${s}/history`);r(c.data||[])}catch(c){console.error("Failed to fetch group history:",c)}finally{a(!1)}})()},[s]),o?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(y,{size:"sm"})}):t.length===0?e.jsx("div",{className:"py-4 text-center text-sm italic text-gray-500",children:"No group size history recorded."}):e.jsx("div",{className:"space-y-3",children:t.map(n=>e.jsxs("div",{className:"flex items-start gap-3 rounded-lg border border-gray-100 bg-gray-50 p-3",children:[e.jsx("div",{className:"rounded-full bg-blue-100 p-2 text-xs font-bold text-blue-700",children:n.newCount>n.oldCount?"↑":"↓"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-bold text-gray-900",children:[n.oldCount," → ",n.newCount," Members"]}),e.jsx("span",{className:"text-[10px] text-gray-500",children:v(n.createdAt)})]}),e.jsx("p",{className:"line-clamp-1 text-xs text-gray-600",children:n.reason||"Manual Update"})]})]},n.id))})}function E({member:s,onClose:t,onStatusChange:r}){var n,c,x,p;if(!s)return null;const o=async()=>{if(confirm(`Approve membership for ${s.firstName} ${s.lastName}?`))try{await A(s.id),m.success(`${s.firstName} has been approved!`),r(),t()}catch(i){m.error(b(i,"Failed to approve member"))}},a=async()=>{const i=prompt(`Reject ${s.firstName}? Please provide a reason:`);if(i)try{await L(s.id,i),m.success("Application rejected"),r(),t()}catch(g){m.error(b(g,"Failed to reject member"))}};return e.jsx(w,{isOpen:!0,onClose:t,title:"Member Application Review",size:"3xl",children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid gap-8 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{children:[e.jsx("h4",{className:"mb-3 text-xs font-bold uppercase tracking-wider text-gray-400",children:"Personal Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{label:"Full Name",value:`${s.firstName} ${s.lastName}`}),e.jsx(l,{label:"Gender",value:s.gender||"Not specified"}),e.jsx(l,{label:"National ID",value:s.nationalId||"Not provided"}),e.jsx(l,{label:"Date of Birth",value:s.dateOfBirth?new Date(s.dateOfBirth).toLocaleDateString():"Not provided"})]})]}),e.jsxs("section",{children:[e.jsx("h4",{className:"mb-3 text-xs font-bold uppercase tracking-wider text-gray-400",children:"Contact Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(l,{label:"Email Address",value:s.email}),e.jsx(l,{label:"Phone Number",value:s.phone}),e.jsx(l,{label:"Address / Location",value:`${s.address||""} ${s.ward?", "+s.ward:""}`})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{children:[e.jsx("h4",{className:"mb-3 text-xs font-bold uppercase tracking-wider text-gray-400",children:"Professional Background"}),e.jsx(l,{label:"Occupation",value:s.occupation||"Not specified"}),e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Skills"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-2",children:(n=s.skills)!=null&&n.length?s.skills.map(i=>e.jsx("span",{className:"rounded bg-blue-50 px-2 py-1 text-xs font-semibold text-blue-700",children:i},i)):e.jsx("span",{className:"text-sm text-gray-400",children:"None listed"})})]})]}),e.jsxs("section",{children:[e.jsx("h4",{className:"mb-3 text-xs font-bold uppercase tracking-wider text-gray-400",children:"Interests"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(c=s.interests)!=null&&c.length?s.interests.map(i=>e.jsx("span",{className:"rounded bg-wiria-yellow bg-opacity-20 px-2 py-1 text-xs font-semibold text-wiria-blue-dark",children:i},i)):e.jsx("span",{className:"text-sm text-gray-400",children:"None listed"})})]}),e.jsxs("section",{className:"mb-4 rounded-xl border border-blue-100 bg-blue-50/50 p-4",children:[e.jsx("h4",{className:"mb-3 text-xs font-bold uppercase tracking-wider text-blue-900",children:"Membership Context"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{label:"Type",value:s.membershipType}),s.membershipType==="GROUP"&&e.jsxs(e.Fragment,{children:[e.jsx(l,{label:"Group Name",value:s.groupName||"N/A"}),e.jsx(l,{label:"Current Count",value:((x=s.currentMemberCount)==null?void 0:x.toString())||"0"}),e.jsx(l,{label:"Max Members Reached",value:((p=s.maxMemberCountReached)==null?void 0:p.toString())||"0"}),e.jsxs("div",{className:"col-span-2 mt-4",children:[e.jsx("h5",{className:"mb-2 text-[10px] font-bold uppercase tracking-wider text-gray-400",children:"Group Size History"}),e.jsx(P,{memberId:s.id})]})]})]})]}),e.jsxs("section",{className:"rounded-xl border border-gray-100 bg-gray-50 p-4",children:[e.jsx("h4",{className:"mb-2 text-xs font-bold uppercase tracking-wider text-wiria-blue-dark",children:"Member Status"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Current Status"}),e.jsx("div",{className:"mt-1 font-bold",children:s.status})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Member Number"}),e.jsx("p",{className:"font-mono font-bold text-wiria-blue-dark",children:s.memberNumber})]})]})]})]})]}),e.jsxs("div",{className:"mt-8 flex flex-wrap items-center gap-4 border-t pt-6",children:[s.status==="PENDING"?e.jsxs(e.Fragment,{children:[e.jsx(u,{onClick:o,className:"flex-1 bg-green-600 hover:bg-green-700",children:"✓ Approve Membership"}),e.jsx(u,{onClick:a,className:"flex-1 bg-red-600 hover:bg-red-700",children:"✗ Reject Application"})]}):e.jsxs("div",{className:"flex-1 rounded-xl bg-gray-100 py-3 text-center font-bold text-gray-600",children:["Resolution: ",s.status," (Processed on"," ",new Date(s.updatedAt).toLocaleDateString(),")"]}),e.jsx(u,{variant:"outline",onClick:t,className:"flex-grow md:flex-none",children:"Close Review"})]})]})})}function l({label:s,value:t}){return e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:s}),e.jsx("p",{className:"font-semibold",children:t})]})}function K(){const[s,t]=d.useState("ALL"),[r,o]=d.useState(""),a=d.useDeferredValue(r),[n,c]=d.useState(null),{items:x,isLoading:p,refetch:i}=f(["admin","members",s,a],()=>D({status:s,search:a}),{arrayKey:"members"});return e.jsxs("div",{children:[e.jsx(M,{title:"Member Management",description:"View and manage member applications"}),e.jsx(C,{currentFilter:s,onFilterChange:t,onSearch:o}),e.jsx(k,{members:x,isLoading:p,onViewDetails:c}),e.jsx(E,{member:n,onClose:()=>c(null),onStatusChange:i})]})}export{K as default};
//# sourceMappingURL=MemberManagementPage-nzpJzFCU.js.map
