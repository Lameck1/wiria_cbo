import{j as e}from"./query-vendor-CM55eWOT.js";import{r as u}from"./react-vendor-CXp26_Hx.js";import{d as v}from"./index-Ck6qqv4n.js";import{a as D}from"./apiUtils-0UX-zM9U.js";import{u as T,a as R,D as A}from"./useAdminData-91Z-y-lf.js";import{B as h}from"./Button-JX_3oChN.js";import{f as L}from"./dateUtils-CLm2GaNA.js";import{A as O}from"./AdminPageHeader-BTeP1u2j.js";import{S as k}from"./StatusBadge-DxoyjbSs.js";import"./animation-vendor-Bcu85ETC.js";const P=async t=>{try{const a=new URLSearchParams;t!=null&&t.status&&a.append("status",t.status),t!=null&&t.priority&&a.append("priority",t.priority);const r=a.toString()?`?${a.toString()}`:"",l=await v.get(`/safeguarding${r}`);return D(l)}catch(a){return console.error("Failed to fetch safeguarding reports:",a),[]}},M=async(t,a)=>{try{return await v.patch(`/safeguarding/${t}`,a),!0}catch(r){throw console.error("Failed to update safeguarding report:",r),r}},F=async(t,a)=>{try{return await v.post(`/safeguarding/${t}/resolve`,{resolution:a}),!0}catch(r){throw console.error("Failed to resolve safeguarding report:",r),r}};function V({report:t,statusColors:a,priorityColors:r,incidentTypes:l,onClose:i,onResolve:o,onStatusChange:x}){const g=n=>new Date(n).toLocaleDateString("en-KE",{year:"numeric",month:"short",day:"numeric"});return e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 p-4",children:e.jsxs("div",{className:"flex max-h-[90vh] w-full max-w-3xl flex-col rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b p-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-mono text-xl font-bold",children:["Report: ",t.referenceNumber]}),e.jsxs("div",{className:"mt-1 flex gap-2",children:[e.jsx("span",{className:`rounded px-2 py-0.5 text-[10px] font-bold uppercase ${r[t.priority]}`,children:t.priority}),e.jsx("span",{className:`rounded-full px-2 py-0.5 text-[10px] font-bold uppercase ${a[t.status]}`,children:t.status.replace("_"," ")})]})]}),e.jsx("button",{onClick:i,className:"text-2xl text-gray-500 hover:text-gray-700",children:"Ã—"})]}),e.jsxs("div",{className:"flex-1 space-y-6 overflow-y-auto p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsx(c,{label:"Incident Type",value:l[t.incidentType]||t.incidentType}),e.jsx(c,{label:"Incident Date",value:g(t.incidentDate)}),e.jsx(c,{label:"Location",value:t.incidentLocation}),e.jsx(c,{label:"Reported On",value:g(t.createdAt)}),!t.isAnonymous&&e.jsxs(e.Fragment,{children:[e.jsx(c,{label:"Reporter Name",value:t.reporterName}),e.jsx(c,{label:"Reporter Contact",value:t.reporterEmail||t.reporterPhone||"N/A"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-[10px] font-bold uppercase tracking-widest text-gray-400",children:"Description"}),e.jsx("div",{className:"whitespace-pre-wrap rounded-xl border border-gray-100 bg-gray-50 p-4 leading-relaxed text-gray-700",children:t.description})]}),t.personsInvolved&&e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-[10px] font-bold uppercase tracking-widest text-gray-400",children:"Persons Involved"}),e.jsx("div",{className:"rounded-xl border border-gray-100 bg-gray-50 p-4 text-gray-700",children:t.personsInvolved})]}),t.resolution&&e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-[10px] font-bold uppercase tracking-widest text-green-600",children:"Final Resolution"}),e.jsx("div",{className:"rounded-xl border border-green-100 bg-green-50 p-4 font-medium text-green-800",children:t.resolution})]}),t.status!=="RESOLVED"&&t.status!=="CLOSED"&&e.jsxs("div",{children:[e.jsx("p",{className:"mb-3 text-[10px] font-bold uppercase tracking-widest text-gray-400",children:"Update Status"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["PENDING","UNDER_REVIEW","INVESTIGATING"].map(n=>e.jsx("button",{onClick:()=>x(n),className:`rounded-lg px-4 py-1.5 text-xs font-bold shadow-sm transition-all ${t.status===n?a[n]:"border border-gray-200 bg-white text-gray-500 hover:bg-gray-50"}`,children:n.replace("_"," ")},n))})]})]}),e.jsxs("div",{className:"flex gap-3 border-t p-6",children:[t.status!=="RESOLVED"&&t.status!=="CLOSED"&&e.jsx(h,{onClick:o,children:"Mark as Resolved"}),e.jsx(h,{variant:"secondary",onClick:i,className:"ml-auto",children:"Close"})]})]})})}function c({label:t,value:a}){return e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-gray-400",children:t}),e.jsx("p",{className:"font-semibold text-gray-900",children:a||"N/A"})]})}function G({report:t,resolution:a,isSubmitting:r,setResolution:l,onResolve:i,onCancel:o}){return e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black bg-opacity-50 p-4",children:e.jsxs("div",{className:"w-full max-w-lg rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"border-b p-6",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Resolve Report"}),e.jsxs("p",{className:"mt-1 font-mono text-sm text-gray-500",children:["Ref: ",t.referenceNumber]})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("label",{className:"mb-2 block text-sm font-bold text-gray-700",children:"Resolution Details *"}),e.jsx("textarea",{value:a,onChange:x=>l(x.target.value),className:"h-40 w-full rounded-xl border border-gray-200 p-4 outline-none transition-all focus:ring-2 focus:ring-wiria-blue-dark",placeholder:"Please describe how this concern was investigated and resolved in detail...",required:!0}),e.jsx("p",{className:"mt-2 text-[10px] font-medium italic text-gray-400",children:"This resolution will be permanently stored and used for audit purposes."})]}),e.jsxs("div",{className:"flex gap-3 border-t p-6",children:[e.jsx(h,{onClick:i,disabled:r||!a.trim(),className:"flex-1",children:r?"Saving Resolution...":"Confirm Resolution"}),e.jsx(h,{variant:"secondary",onClick:o,disabled:r,children:"Cancel"})]})]})})}const U={PENDING:"bg-yellow-100 text-yellow-700",UNDER_REVIEW:"bg-blue-100 text-blue-700",INVESTIGATING:"bg-orange-100 text-orange-700",RESOLVED:"bg-green-100 text-green-700",CLOSED:"bg-gray-100 text-gray-500"},S={CRITICAL:"bg-red-600 text-white",HIGH:"bg-orange-500 text-white",MEDIUM:"bg-yellow-500 text-white",LOW:"bg-green-500 text-white"},E={CHILD_PROTECTION:"Child Protection",SEXUAL_EXPLOITATION:"Sexual Exploitation",HARASSMENT:"Harassment",DISCRIMINATION:"Discrimination",FRAUD:"Fraud",OTHER:"Other"};function J(){const[t,a]=u.useState(""),[r,l]=u.useState(""),i={...t&&{status:t},...r&&{priority:r}},{items:o,isLoading:x}=T(["safeguarding",i],()=>P(Object.keys(i).length?i:void 0)),g=R(({id:s,status:j})=>M(s,{status:j}),[["safeguarding"]],{successMessage:"Report status updated"}),n=R(({id:s,resolution:j})=>F(s,j),[["safeguarding"]],{successMessage:"Report resolved successfully"}),[d,p]=u.useState(null),[N,m]=u.useState(!1),[f,b]=u.useState(""),I=()=>{!d||!f.trim()||n.mutate({id:d.id,resolution:f},{onSuccess:()=>{m(!1),b(""),p(null)}})},C=[{header:"Reference",key:"referenceNumber",className:"font-mono text-xs font-bold"},{header:"Type",key:"incidentType",render:s=>e.jsx("span",{className:"text-sm",children:E[s.incidentType]||s.incidentType})},{header:"Priority",key:"priority",render:s=>e.jsx("span",{className:`rounded px-2 py-0.5 text-[10px] font-bold uppercase ${S[s.priority]}`,children:s.priority})},{header:"Status",key:"status",render:s=>e.jsx(k,{status:s.status})},{header:"Date",key:"createdAt",render:s=>e.jsx("span",{className:"text-sm text-gray-500",children:L(s.createdAt)})},{header:"Actions",key:"actions",align:"right",render:s=>e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>p(s),className:"text-sm font-bold text-wiria-blue-dark hover:underline",children:"View"}),s.status!=="RESOLVED"&&s.status!=="CLOSED"&&e.jsx("button",{onClick:()=>{p(s),m(!0)},className:"text-sm font-bold text-green-600 hover:underline",children:"Resolve"})]})}],w=o.filter(s=>s.priority==="CRITICAL"&&s.status!=="RESOLVED"&&s.status!=="CLOSED").length,y=o.filter(s=>s.status!=="RESOLVED"&&s.status!=="CLOSED").length;return e.jsxs("div",{className:"space-y-8",children:[e.jsx(O,{title:"Safeguarding Reports",description:"Manage and respond to safeguarding concerns within the community.",children:e.jsxs("div",{className:"flex gap-3",children:[w>0&&e.jsxs("div",{className:"flex animate-pulse items-center gap-2 rounded-xl border border-red-100 bg-red-50 px-4 py-2 shadow-sm",children:[e.jsx("span",{className:"h-2 w-2 rounded-full bg-red-600"}),e.jsxs("span",{className:"text-sm font-bold text-red-700",children:[w," critical"]})]}),y>0&&e.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-yellow-100 bg-yellow-50 px-4 py-2 shadow-sm",children:[e.jsx("span",{className:"h-2 w-2 rounded-full bg-yellow-600"}),e.jsxs("span",{className:"text-sm font-bold text-yellow-700",children:[y," active case",y>1?"s":""]})]})]})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 rounded-xl border border-gray-100 bg-white p-4 shadow-sm",children:[e.jsx("span",{className:"px-2 text-xs font-bold uppercase tracking-widest text-gray-400",children:"Filters:"}),e.jsxs("select",{value:t,onChange:s=>a(s.target.value),className:"rounded-lg border-none bg-gray-50 px-4 py-2 text-sm font-medium outline-none transition-all focus:ring-2 focus:ring-wiria-blue-dark","aria-label":"Filter by Status",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"UNDER_REVIEW",children:"Under Review"}),e.jsx("option",{value:"INVESTIGATING",children:"Investigating"}),e.jsx("option",{value:"RESOLVED",children:"Resolved"}),e.jsx("option",{value:"CLOSED",children:"Closed"})]}),e.jsxs("select",{value:r,onChange:s=>l(s.target.value),className:"rounded-lg border-none bg-gray-50 px-4 py-2 text-sm font-medium outline-none transition-all focus:ring-2 focus:ring-wiria-blue-dark","aria-label":"Filter by Priority",children:[e.jsx("option",{value:"",children:"All Priorities"}),e.jsx("option",{value:"CRITICAL",children:"Critical"}),e.jsx("option",{value:"HIGH",children:"High"}),e.jsx("option",{value:"MEDIUM",children:"Medium"}),e.jsx("option",{value:"LOW",children:"Low"})]})]}),e.jsx(A,{columns:C,data:o,rowKey:"id",isLoading:x,emptyMessage:"No safeguarding reports found matching your criteria.",rowClassName:s=>s.priority==="CRITICAL"?"bg-red-50/50 hover:bg-red-50":""}),d&&!N&&e.jsx(V,{report:d,statusColors:U,priorityColors:S,incidentTypes:E,onClose:()=>p(null),onResolve:()=>m(!0),onStatusChange:s=>g.mutate({id:d.id,status:s})}),N&&d&&e.jsx(G,{report:d,resolution:f,isSubmitting:n.isPending,setResolution:b,onResolve:I,onCancel:()=>{m(!1),b("")}})]})}export{J as default};
//# sourceMappingURL=SafeguardingManagementPage-BFusBrCA.js.map
