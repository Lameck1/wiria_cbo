import{j as e}from"./query-vendor-frBnvHSF.js";import{r as b,u as A}from"./react-vendor-BdaLayic.js";import{C as F,a as O,b as K,F as U}from"./types-BwqQ6cFe.js";import{c as W,u as _}from"./index-ICA0O2oL.js";import{u as G,P as H,a as V,c as z,e as Y,d as y}from"./PaymentMethodToggle-DGzi79jd.js";import{u as q,P as E}from"./useMemberData-P6dvgI-k.js";import{A as N}from"./endpoints-Cofiu-EW.js";import{a as B}from"./validation-Dk4xCuuu.js";import{f as Q}from"./helpers-Brneqz2V.js";import{B as w}from"./Button-K8iFFe9S.js";import{C as x,a as u}from"./Card-DmlQfAyP.js";import{I as $}from"./Input-1n81zAKh.js";import{m as g,A as R}from"./animation-vendor-CrU7SSpu.js";import{F as T}from"./FormField-ys3L58kM.js";import"./validators-BLdh7FbM.js";function J(){const{apiClient:t}=W(),[r,a]=b.useState(null),s=G({flowType:"renewal",initiationEndpoint:N.MEMBERS_RENEW,statusEndpoint:N.PAYMENTS_STATUS,messages:{initiationSuccess:"Renewal successful!",paymentCompleted:"Payment completed! Your membership has been renewed.",stkPushSent:"STK push sent to your phone. Please complete the payment.",manualPaymentSubmitted:"Transaction submitted for verification."}}),n=b.useCallback(async o=>{try{const l=await t.post(N.MEMBERS_RENEW,o),{checkoutRequestId:h,transactionId:c,message:j}=l,m=h??c;return m&&a(m),{success:(await s.initiatePayment({...o,renewalId:m})).success,transactionId:m,message:j}}catch{return{success:!1}}},[t,s]),d=b.useCallback(()=>{a(null),s.resetPayment()},[s]);return{renewalId:r,isSubmitting:s.isSubmitting,paymentStatus:s.paymentStatus,transactionId:s.transactionId,submitRenewal:n,checkPaymentStatus:s.checkPaymentStatus,resetRenewal:d}}function X({onNavigate:t}){const r=A(),a=()=>{t?t():r("/member-portal")};return e.jsx("div",{className:"mx-auto max-w-2xl py-12",children:e.jsx(x,{className:"border-none bg-gradient-to-b from-white to-blue-50/30 p-12 text-center shadow-2xl",children:e.jsxs(u,{children:[e.jsx("div",{className:"mx-auto mb-8 flex h-24 w-24 items-center justify-center rounded-full bg-green-100 shadow-inner",children:e.jsx("svg",{className:"h-12 w-12 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),e.jsx("h2",{className:"mb-4 text-3xl font-bold text-gray-900",children:"Renewal Complete!"}),e.jsx("p",{className:"mb-10 text-lg leading-relaxed text-gray-600",children:"Thank you for renewing your WIRIA membership. Your account has been updated successfully."}),e.jsx(w,{size:"lg",className:"h-14 px-12 text-lg shadow-lg",onClick:a,children:"Return to Dashboard"})]})})})}function Z({maxCount:t,control:r}){return e.jsx(g.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},className:"mb-6 overflow-hidden",children:e.jsx(x,{className:"border-blue-100 bg-blue-50/30",children:e.jsx(u,{children:e.jsxs("div",{className:"flex flex-col justify-between gap-6 md:flex-row md:items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-1 text-lg font-bold text-blue-900",children:"Group Member Count"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Update your group size to include new members."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col items-end text-right",children:[e.jsx("span",{className:"text-xs font-bold uppercase text-gray-500",children:"Last Recorded"}),e.jsx("span",{className:"font-mono text-xl font-bold text-gray-800",children:t})]}),e.jsx("div",{className:"h-10 w-px bg-blue-200"}),e.jsx("div",{className:"w-32 text-center",children:e.jsx(F,{name:"memberCount",control:r,render:({field:a})=>e.jsx($,{...a,type:"number",className:"h-12 text-center text-xl font-bold",min:1,onChange:s=>a.onChange(Number(s.target.value))})})})]})]})})})})}function ee({feeBreakdown:t}){return e.jsx("div",{className:"mb-8",children:e.jsx(x,{className:"border-2 border-gray-100 bg-gray-50",children:e.jsxs(u,{children:[e.jsxs("h3",{className:"mb-6 flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-gray-900",children:[e.jsx("svg",{className:"h-4 w-4 text-wiria-blue-dark",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),"Fee Breakdown"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-dashed border-gray-200 py-2",children:[e.jsxs("div",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Subscription Renewal"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.renewal.count," ",t.renewal.count===1?"member":"members"," × KES"," ",t.renewal.rate.toLocaleString()]})]}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["KES ",t.renewal.subtotal.toLocaleString()]})]}),t.newRegistration.count>0&&e.jsxs("div",{className:"flex items-center justify-between border-b border-dashed border-gray-200 py-2",children:[e.jsxs("div",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium text-blue-700",children:"Incremental Registration"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.newRegistration.count," new"," ",t.newRegistration.count===1?"member":"members"," × KES"," ",t.newRegistration.rate.toLocaleString()]})]}),e.jsxs("span",{className:"font-bold text-blue-700",children:["KES ",t.newRegistration.subtotal.toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsx("span",{className:"text-lg font-bold text-gray-900",children:"Total Due"}),e.jsxs(g.span,{initial:{scale:1.1,color:"#1e40af"},animate:{scale:1,color:"#1e3a8a"},className:"font-mono text-2xl font-bold text-wiria-blue-dark",children:["KES ",t.total.toLocaleString()]},t.total)]})]})]})})})}function te({paymentMethod:t,isSubmitting:r,onRefresh:a}){return e.jsx(g.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"py-16 text-center",children:e.jsx(x,{className:"mx-auto max-w-md border-none p-12 shadow-2xl",children:e.jsxs(u,{children:[e.jsxs("div",{className:"relative mb-10",children:[e.jsx("div",{className:"mx-auto h-24 w-24 animate-spin rounded-full border-4 border-blue-100 border-t-wiria-blue-dark",role:"progressbar","aria-label":"Processing payment"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center font-bold text-wiria-blue-dark",children:t==="STK_PUSH"?"SMS":"Wait"})]}),e.jsx("h3",{className:"mb-4 text-2xl font-bold text-gray-900",children:"Processing Renewal"}),e.jsx("p",{className:"mb-8 text-gray-600",children:t==="STK_PUSH"?"Please complete the payment on your phone by entering your M-Pesa PIN.":"We are verifying your transaction. This may take a few moments."}),e.jsx(w,{variant:"outline",fullWidth:!0,size:"lg",onClick:a,disabled:r,children:"Refresh Status"})]})})},"pending")}function se({membershipType:t,expiresAt:r,daysUntilExpiry:a}){return e.jsxs(x,{className:"overflow-hidden border-none shadow-md",children:[e.jsx("div",{className:"h-1 bg-wiria-blue-dark","aria-hidden":"true"}),e.jsxs(u,{children:[e.jsx("h3",{className:"mb-4 text-sm font-bold uppercase tracking-wider text-gray-500",children:"Membership Status"}),e.jsxs("dl",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("dt",{className:"text-gray-600",children:"Member Type"}),e.jsx("dd",{className:"rounded-full bg-blue-50 px-3 py-1 text-xs font-bold text-blue-700",children:t||"INDIVIDUAL"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("dt",{className:"text-gray-600",children:"Expires On"}),e.jsx("dd",{className:"font-bold text-gray-900",children:r?new Date(r).toLocaleDateString():"--"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("dt",{className:"text-gray-600",children:"Days Remaining"}),e.jsx("dd",{className:`font-mono font-bold ${a!=null&&a<=30?"text-red-500":"text-green-600"}`,children:a??"--"})]})]})]})]})}function ae({total:t}){return e.jsxs("div",{className:"relative flex flex-col justify-center overflow-hidden rounded-2xl bg-gradient-to-br from-wiria-blue-dark to-blue-900 p-8 text-white shadow-xl",children:[e.jsx("div",{className:"absolute right-0 top-0 h-32 w-32 -translate-x-1/2 -translate-y-1/2 rounded-full bg-white/5","aria-hidden":"true"}),e.jsx("p",{className:"mb-2 text-sm font-bold uppercase tracking-widest text-blue-100",children:"Total Amount Due"}),e.jsxs("p",{className:"mb-2 text-5xl font-bold","aria-live":"polite",children:["KES ",t.toLocaleString()]}),e.jsx("p",{className:"text-xs italic text-blue-200",children:"Renewal for the next 12 months"})]})}function re({paymentMethod:t,setValue:r,register:a,errors:s,isSubmitting:n,amount:d,isSubmitDisabled:o,submitLabel:l,accountNumber:h}){return e.jsx(x,{className:"border-none shadow-lg",children:e.jsxs(u,{className:"p-8",children:[e.jsx("h2",{className:"mb-8 text-2xl font-bold text-wiria-blue-dark",children:"Payment Details"}),e.jsxs("div",{className:"mb-8 grid grid-cols-1 gap-8 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"mb-3 block text-sm font-bold text-gray-700",children:"Payment Method"}),e.jsx(H,{selected:t,onChange:c=>r("paymentMethod",c),disabled:n})]}),e.jsx("div",{children:t==="STK_PUSH"?e.jsx(T,{name:"phoneNumber",label:"M-Pesa Phone Number",type:"tel",placeholder:"254700000000",description:"You'll receive a prompt on your phone",disabled:n}):e.jsx(T,{name:"transactionCode",label:"Transaction Code",placeholder:"e.g. QWE123RTY",description:"Enter the code from the M-Pesa SMS",disabled:n})})]}),e.jsx("div",{className:"mb-8 rounded-2xl bg-gray-50 p-6",children:e.jsx(V,{paymentMethod:t,amount:d,submitLabel:l,accountNumber:h})}),e.jsxs("div",{className:"mb-8 space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",id:"agreedToDataProtection",...a("agreedToDataProtection"),className:"mt-1 h-5 w-5 rounded border-gray-300 text-wiria-blue-dark focus:ring-wiria-blue-dark",disabled:n}),e.jsx("label",{htmlFor:"agreedToDataProtection",className:"text-sm leading-tight text-gray-700",children:"I consent to the processing of my personal data under the Data Protection Policy. *"})]}),s.agreedToDataProtection&&e.jsx("p",{className:"ml-8 text-xs text-red-500",children:s.agreedToDataProtection.message}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",id:"agreedToCodeOfEthics",...a("agreedToCodeOfEthics"),className:"mt-1 h-5 w-5 rounded border-gray-300 text-wiria-blue-dark focus:ring-wiria-blue-dark",disabled:n}),e.jsx("label",{htmlFor:"agreedToCodeOfEthics",className:"text-sm leading-tight text-gray-700",children:"I agree to abide by the WIRIA Code of Ethics and Conduct. *"})]}),s.agreedToCodeOfEthics&&e.jsx("p",{className:"ml-8 text-xs text-red-500",children:s.agreedToCodeOfEthics.message})]}),e.jsxs(w,{type:"submit",fullWidth:!0,size:"lg",isLoading:n,disabled:o,className:"h-14 text-lg shadow-xl",children:[l," • KES ",d.toLocaleString()]})]})})}function ye(){_();const{profile:t,fetchProfile:r,daysUntilExpiry:a}=q(),s=(t==null?void 0:t.membershipType)==="GROUP",n=O({resolver:K(B),defaultValues:{paymentMethod:"STK_PUSH",memberCount:1,phoneNumber:"",transactionCode:"",agreedToDataProtection:!1,agreedToCodeOfEthics:!1}}),{handleSubmit:d,watch:o,setValue:l,formState:{errors:h}}=n,c=o("paymentMethod"),j=o("memberCount")??1,m=o("agreedToDataProtection"),v=o("agreedToCodeOfEthics"),M=o("transactionCode");b.useEffect(()=>{r()},[r]),b.useEffect(()=>{t&&(l("memberCount",t.currentMemberCount??1),l("phoneNumber",t.phone??""))},[t,l]);const{submitRenewal:I,checkPaymentStatus:k,isSubmitting:S,paymentStatus:f,transactionId:P}=J();z({donationId:P,isActive:!!P&&f===y.PENDING,onStatusCheck:k});const C=(t==null?void 0:t.maxMemberCountReached)??(t==null?void 0:t.currentMemberCount)??0,p=Y({membershipType:s?"GROUP":"INDIVIDUAL",memberCount:j,maxCount:C}),D=async i=>{await I({paymentMethod:i.paymentMethod,phoneNumber:Q(i.phoneNumber??""),transactionCode:i.paymentMethod==="MANUAL"?i.transactionCode:void 0,memberCount:s?i.memberCount:void 0,amount:p.total})},L=!m||!v||c==="MANUAL"&&!M;return f===y.COMPLETED?e.jsx(E,{title:"Renewal Successful",children:e.jsx(X,{})}):e.jsx(E,{title:"Renew Membership",children:e.jsx(U,{...n,children:e.jsx("div",{className:"mx-auto max-w-4xl px-4 py-8",children:e.jsx(R,{mode:"wait",children:f===y.PENDING?e.jsx(te,{paymentMethod:c,isSubmitting:S,onRefresh:()=>window.location.reload()}):e.jsxs(g.div,{initial:{opacity:0},animate:{opacity:1},children:[e.jsxs("div",{className:"mb-8 grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsx(se,{membershipType:(t==null?void 0:t.membershipType)??"INDIVIDUAL",expiresAt:t==null?void 0:t.membershipExpiresAt,daysUntilExpiry:a}),e.jsx(ae,{total:p.total})]}),e.jsxs("form",{onSubmit:i=>{i.preventDefault(),d(D)(i)},className:"space-y-8",children:[e.jsx(R,{children:s&&e.jsx(Z,{maxCount:C,control:n.control})}),e.jsx(ee,{feeBreakdown:p}),e.jsx(re,{paymentMethod:c,setValue:l,register:n.register,errors:h,isSubmitting:S,amount:p.total,isSubmitDisabled:L,submitLabel:"Complete Renewal",accountNumber:"MEMBERSHIP_RENEW"})]})]},"form")})})})})}export{ye as default};
//# sourceMappingURL=MemberRenewalPage-A6q53GnQ.js.map
