import{j as e}from"./query-vendor-frBnvHSF.js";import{r as l}from"./react-vendor-BdaLayic.js";import{A as j}from"./AdminPageHeader-CmCPoIZw.js";import{b as m,l as f,M as y,n as x,T as N}from"./index-ICA0O2oL.js";import{B as u}from"./Button-K8iFFe9S.js";import{M as v}from"./Modal-D8P6KMMh.js";import{g as h}from"./apiUtils-CDDJc0SC.js";import{S as w}from"./Spinner-DvzCBoUM.js";import{b as M}from"./dateUtils-D0Bnoiug.js";import{D as S}from"./DataTable-D2X_cuFs.js";import{S as C}from"./StatusBadge-DPX4J2hm.js";import{u as k}from"./useAdminData-B_72029o.js";import"./animation-vendor-CrU7SSpu.js";import"./helpers-Brneqz2V.js";const b=l.createContext(void 0);function D(){const s=l.useContext(b);if(s===void 0)throw new Error("useMember must be used within a MemberProvider");return s}const A=async(s={})=>{const t=new URLSearchParams;return s.status&&s.status!=="ALL"&&t.append("status",s.status),s.search&&t.append("search",s.search),await m.get(`/admin/members?${t.toString()}`)},E=async s=>await m.patch(`/admin/members/${s}/approve`),P=async(s,t)=>await m.patch(`/admin/members/${s}/reject`,{reason:t});function L({memberId:s}){const[t,n]=l.useState([]),[i,a]=l.useState(!0);return l.useEffect(()=>{(async()=>{try{const c=await m.get(`/admin/members/${s}/history`);n(c.data||[])}catch(c){f.error("Failed to fetch group history:",c)}finally{a(!1)}})()},[s]),i?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(w,{size:"sm"})}):t.length===0?e.jsx("div",{className:"py-4 text-center text-sm italic text-gray-500",children:"No group size history recorded."}):e.jsx("div",{className:"space-y-3",children:t.map(r=>e.jsxs("div",{className:"flex items-start gap-3 rounded-lg border border-gray-100 bg-gray-50 p-3",children:[e.jsx("div",{className:"rounded-full bg-blue-100 p-2 text-xs font-bold text-blue-700",children:r.newCount>r.oldCount?"↑":"↓"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-bold text-gray-900",children:[r.oldCount," → ",r.newCount," Members"]}),e.jsx("span",{className:"text-[10px] text-gray-500",children:M(r.createdAt)})]}),e.jsx("p",{className:"line-clamp-1 text-xs text-gray-600",children:r.reason??"Manual Update"})]})]},r.id))})}function T({member:s}){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{children:[e.jsx("h4",{className:"mb-3 text-xs font-bold uppercase tracking-wider text-gray-400",children:"Personal Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{label:"Full Name",value:`${s.firstName} ${s.lastName}`}),e.jsx(o,{label:"Gender",value:s.gender??"Not specified"}),e.jsx(o,{label:"National ID",value:s.nationalId??"Not provided"}),e.jsx(o,{label:"Date of Birth",value:s.dateOfBirth?new Date(s.dateOfBirth).toLocaleDateString():"Not provided"})]})]}),e.jsxs("section",{children:[e.jsx("h4",{className:"mb-3 text-xs font-bold uppercase tracking-wider text-gray-400",children:"Contact Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(o,{label:"Email Address",value:s.email}),e.jsx(o,{label:"Phone Number",value:s.phone}),e.jsx(o,{label:"Address / Location",value:`${s.address??""} ${s.ward?", "+s.ward:""}`})]})]})]})}function I({member:s}){var t,n,i,a;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{children:[e.jsx("h4",{className:"mb-3 text-xs font-bold uppercase tracking-wider text-gray-400",children:"Professional Background"}),e.jsx(o,{label:"Occupation",value:s.occupation??"Not specified"}),e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Skills"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-2",children:(t=s.skills)!=null&&t.length?s.skills.map(r=>e.jsx("span",{className:"rounded bg-blue-50 px-2 py-1 text-xs font-semibold text-blue-700",children:r},r)):e.jsx("span",{className:"text-sm text-gray-400",children:"None listed"})})]})]}),e.jsxs("section",{children:[e.jsx("h4",{className:"mb-3 text-xs font-bold uppercase tracking-wider text-gray-400",children:"Interests"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(n=s.interests)!=null&&n.length?s.interests.map(r=>e.jsx("span",{className:"rounded bg-wiria-yellow bg-opacity-20 px-2 py-1 text-xs font-semibold text-wiria-blue-dark",children:r},r)):e.jsx("span",{className:"text-sm text-gray-400",children:"None listed"})})]}),e.jsxs("section",{className:"mb-4 rounded-xl border border-blue-100 bg-blue-50/50 p-4",children:[e.jsx("h4",{className:"mb-3 text-xs font-bold uppercase tracking-wider text-blue-900",children:"Membership Context"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{label:"Type",value:s.membershipType}),s.membershipType==="GROUP"&&e.jsxs(e.Fragment,{children:[e.jsx(o,{label:"Group Name",value:s.groupName??"N/A"}),e.jsx(o,{label:"Current Count",value:((i=s.currentMemberCount)==null?void 0:i.toString())??"0"}),e.jsx(o,{label:"Max Members Reached",value:((a=s.maxMemberCountReached)==null?void 0:a.toString())??"0"}),e.jsxs("div",{className:"col-span-2 mt-4",children:[e.jsx("h5",{className:"mb-2 text-[10px] font-bold uppercase tracking-wider text-gray-400",children:"Group Size History"}),e.jsx(L,{memberId:s.id})]})]})]})]}),e.jsxs("section",{className:"rounded-xl border border-gray-100 bg-gray-50 p-4",children:[e.jsx("h4",{className:"mb-2 text-xs font-bold uppercase tracking-wider text-wiria-blue-dark",children:"Member Status"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Current Status"}),e.jsx("div",{className:"mt-1 font-bold",children:s.status})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Member Number"}),e.jsx("p",{className:"font-mono font-bold text-wiria-blue-dark",children:s.memberNumber})]})]})]})]})}function R({member:s,onClose:t,onStatusChange:n}){if(!s)return null;const i=async()=>{try{await E(s.id),x.success(`${s.firstName} has been approved!`),n(),t()}catch(r){x.error(h(r,"Failed to approve member"))}},a=async()=>{try{await P(s.id,"Rejected by admin"),x.success("Application rejected"),n(),t()}catch(r){x.error(h(r,"Failed to reject member"))}};return e.jsx(v,{isOpen:!0,onClose:t,title:"Member Application Review",size:"3xl",children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid gap-8 md:grid-cols-2",children:[e.jsx(T,{member:s}),e.jsx(I,{member:s})]}),e.jsxs("div",{className:"mt-8 flex flex-wrap items-center gap-4 border-t pt-6",children:[s.status===y.PENDING?e.jsxs(e.Fragment,{children:[e.jsx(u,{onClick:()=>void i(),className:"flex-1 bg-green-600 hover:bg-green-700",children:"✓ Approve Membership"}),e.jsx(u,{onClick:()=>void a(),className:"flex-1 bg-red-600 hover:bg-red-700",children:"✗ Reject Application"})]}):e.jsxs("div",{className:"flex-1 rounded-xl bg-gray-100 py-3 text-center font-bold text-gray-600",children:["Resolution: ",s.status," (Processed on"," ",new Date(s.updatedAt).toLocaleDateString(),")"]}),e.jsx(u,{variant:"outline",onClick:t,className:"flex-grow md:flex-none",children:"Close Review"})]})]})})}function o({label:s,value:t}){return e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:s}),e.jsx("p",{className:"font-semibold",children:t})]})}function F(s,t=300){const[n,i]=l.useState(s);return l.useEffect(()=>{const a=setTimeout(()=>{i(s)},t);return()=>{clearTimeout(a)}},[s,t]),n}function $({currentFilter:s,onFilterChange:t,onSearch:n}){const[i,a]=l.useState(""),r=F(i,N.DEBOUNCE_DEFAULT);l.useEffect(()=>{n(r)},[r,n]);const c=d=>{const g=d.target.value;a(g)},p=[{id:"ALL",label:"All Members"},{id:"PENDING",label:"Pending"},{id:"ACTIVE",label:"Active"},{id:"CANCELLED",label:"Cancelled"},{id:"EXPIRED",label:"Expired"}];return e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsx("div",{className:"flex space-x-2 overflow-x-auto border-b",children:p.map(d=>e.jsx("button",{onClick:()=>t(d.id),className:`whitespace-nowrap border-b-2 px-6 py-3 font-semibold transition-all ${s===d.id?"border-wiria-blue-dark text-wiria-blue-dark":"border-transparent text-gray-600 hover:text-wiria-blue-dark"}`,children:d.label},d.id))}),e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:"Search by name, email, phone, or member number...",className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-transparent focus:ring-2 focus:ring-wiria-blue-dark md:w-96",value:i,onChange:c})})]})}function G({members:s=[],isLoading:t,onViewDetails:n}){const i=[{header:"Member #",key:"memberNumber",className:"font-mono font-semibold"},{header:"Name",key:"name",render:a=>`${a.firstName} ${a.lastName}`},{header:"Type",key:"membershipType",render:a=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`rounded-md px-2 py-1 text-[10px] font-bold uppercase ${a.membershipType==="GROUP"?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700"}`,children:a.membershipType}),a.membershipType==="GROUP"&&e.jsx("div",{className:"mt-1 text-[10px] font-medium text-gray-500",children:a.groupName})]})},{header:"Contact",key:"contact",render:a=>e.jsxs(e.Fragment,{children:[e.jsx("div",{children:a.email}),e.jsx("div",{className:"text-xs text-gray-500",children:a.phone})]})},{header:"Status",key:"status",render:a=>e.jsx(C,{status:a.status})},{header:"Payment",key:"payment",render:a=>e.jsx(O,{payments:a.payments})},{header:"Join Date",key:"joinDate",render:a=>new Date(a.joinDate).toLocaleDateString()},{header:"Actions",key:"actions",align:"right",render:a=>e.jsx(u,{size:"sm",onClick:()=>n(a),children:"Review"})}];return e.jsx("div",{className:"overflow-hidden rounded-2xl bg-white shadow-xl",children:e.jsx(S,{columns:i,data:s,isLoading:t,rowKey:"id",emptyMessage:"No members found matching your criteria.",className:"rounded-none border-none shadow-none"})})}function O({payments:s}){if(!s||s.length===0)return e.jsx("span",{className:"text-xs text-gray-400",children:"No payments"});const t=s[0];if(!t)return e.jsx("span",{className:"text-xs text-gray-400",children:"No payments"});const n=t.status==="COMPLETED"?"text-green-600":t.status==="FAILED"?"text-red-600":"text-yellow-600";return e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:["KES ",(t.amount||0).toLocaleString()]}),e.jsx("div",{className:`text-xs ${n}`,children:t.status})]})}function V({filter:s,search:t,onFilterChange:n,onSearch:i,selectedMember:a,onSelectMember:r}){const{members:c,isLoading:p,refetch:d}=D();return e.jsxs(e.Fragment,{children:[e.jsx($,{currentFilter:s,onFilterChange:n,onSearch:i}),e.jsx(G,{members:c,isLoading:p,onViewDetails:r}),e.jsx(R,{member:a,onClose:()=>r(null),onStatusChange:()=>{d()}})]})}function B({children:s,filter:t,search:n}){const{items:i,isLoading:a,refetch:r}=k(["admin","members",t,n],()=>A({status:t,search:n}),{arrayKey:"members"});return e.jsx(b.Provider,{value:{members:i,isLoading:a,refetch:async()=>{await r()},filter:t,search:n},children:s})}function te(){const[s,t]=l.useState("ALL"),[n,i]=l.useState(""),a=l.useDeferredValue(n),[r,c]=l.useState(null);return e.jsxs("div",{children:[e.jsx(j,{title:"Member Management",description:"View and manage member applications"}),e.jsx(B,{filter:s,search:a,children:e.jsx(V,{filter:s,search:n,onFilterChange:t,onSearch:i,selectedMember:r,onSelectMember:c})})]})}export{te as default};
//# sourceMappingURL=MemberManagementPage-CIU1DiS1.js.map
