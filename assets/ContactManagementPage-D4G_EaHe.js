import{j as e}from"./query-vendor-CM55eWOT.js";import{h as A,r as m}from"./react-vendor-CXp26_Hx.js";import{d as N}from"./index-Ck6qqv4n.js";import{a as M}from"./apiUtils-0UX-zM9U.js";import{u as L,a as w,D as S}from"./useAdminData-91Z-y-lf.js";import{B as p}from"./Button-JX_3oChN.js";import{A as P}from"./AdminPageHeader-BTeP1u2j.js";import{S as _}from"./StatusBadge-DxoyjbSs.js";import"./animation-vendor-Bcu85ETC.js";const D=async t=>{try{const a=t!=null&&t.status?`?status=${t.status}`:"",r=await N.get(`/contact${a}`);return M(r)}catch(a){return console.error("Failed to fetch contacts:",a),[]}},H=async(t,a)=>{try{return await N.post(`/contact/${t}/respond`,{response:a}),!0}catch(r){throw console.error("Failed to respond to contact:",r),r}},I=async t=>{try{return await N.delete(`/contact/${t}`),!0}catch(a){throw console.error("Failed to archive contact:",a),a}};function Y({contact:t,onClose:a,onReply:r}){const i=l=>new Date(l).toLocaleDateString("en-KE",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 p-4",children:e.jsxs("div",{className:"flex max-h-[90vh] w-full max-w-2xl flex-col rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b p-6",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Message Details"}),e.jsx("button",{onClick:a,className:"text-2xl text-gray-500 hover:text-gray-700",children:"×"})]}),e.jsxs("div",{className:"flex-1 space-y-6 overflow-y-auto p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsx(g,{label:"From",value:t.name}),e.jsx(g,{label:"Email",value:t.email}),e.jsx(g,{label:"Phone",value:t.phone||"N/A"}),e.jsx(g,{label:"Received",value:i(t.createdAt)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-[10px] font-bold uppercase tracking-widest text-gray-400",children:"Subject"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:t.subject})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-[10px] font-bold uppercase tracking-widest text-gray-400",children:"Message Content"}),e.jsx("div",{className:"whitespace-pre-wrap rounded-xl border border-gray-100 bg-gray-50 p-5 leading-relaxed text-gray-700",children:t.message})]}),t.response&&e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-[10px] font-bold uppercase tracking-widest text-green-600",children:"Internal Response"}),e.jsx("div",{className:"rounded-xl border border-green-100 bg-green-50 p-5 text-green-700",children:t.response})]})]}),e.jsxs("div",{className:"flex gap-3 border-t p-6",children:[t.status==="NEW"&&e.jsx(p,{onClick:r,children:"Reply Now"}),e.jsx(p,{variant:"secondary",onClick:a,className:"ml-auto",children:"Close"})]})]})})}function g({label:t,value:a}){return e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-gray-400",children:t}),e.jsx("p",{className:"font-semibold text-gray-900",children:a})]})}function G({contact:t,replyText:a,isSubmitting:r,setReplyText:i,onReply:l,onCancel:o}){const d=a.trim().length>=10&&a.length<=1e3;return e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black bg-opacity-50 p-4",children:e.jsxs("div",{className:"w-full max-w-lg rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"border-b p-6",children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Reply to ",t.name]}),e.jsxs("p",{className:"mt-1 truncate text-sm text-gray-500",children:["Re: ",t.subject]})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("label",{className:"mb-2 block text-sm font-bold text-gray-700",children:"Your Response *"}),e.jsx("textarea",{value:a,onChange:n=>i(n.target.value),className:`h-40 w-full rounded-xl border p-4 outline-none transition-all focus:ring-2 ${a.trim().length>0&&!d?"border-red-300 focus:ring-red-100":"border-gray-200 focus:ring-wiria-blue-dark/10"}`,placeholder:"Type your reply here... This will be sent as an email response.",maxLength:1e3,required:!0}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsxs("div",{className:"text-[10px] font-bold uppercase tracking-wider",children:[a.trim().length>0&&a.trim().length<10&&e.jsxs("span",{className:"text-red-500",children:["Min ",10," chars required"]}),d&&e.jsx("span",{className:"text-green-600",children:"✓ Valid response"})]}),e.jsxs("span",{className:`text-[10px] font-bold ${a.length>1e3*.9?"text-orange-500":"text-gray-400"}`,children:[a.length," / ",1e3]})]})]}),e.jsxs("div",{className:"flex gap-3 border-t p-6",children:[e.jsx(p,{onClick:l,disabled:r||!d,className:"flex-1",children:r?"Sending Email...":"Send Reply"}),e.jsx(p,{variant:"secondary",onClick:o,disabled:r,children:"Cancel"})]})]})})}function z(){const[t,a]=A(),[r,i]=m.useState(""),l=t.get("highlight"),{items:o,isLoading:u}=L(["contacts",r],()=>D(r?{status:r}:void 0)),b=w(({id:s,text:c})=>H(s,c),[["contacts"]],{successMessage:"Reply sent successfully"}),d=w(s=>I(s),[["contacts"]],{successMessage:"Message archived"}),[n,x]=m.useState(null),[v,h]=m.useState(!1),[f,y]=m.useState("");m.useEffect(()=>{if(!u&&l){const s=o.find(c=>c.id===l);if(s){x(s);const c=new URLSearchParams(t);c.delete("highlight"),a(c,{replace:!0})}}},[l,o,u,t,a]);const E=()=>{!n||!f.trim()||b.mutate({id:n.id,text:f},{onSuccess:()=>{h(!1),y(""),x(null)}})},R=s=>{confirm("Are you sure you want to archive this message?")&&d.mutate(s)},k=s=>new Date(s).toLocaleDateString("en-KE",{year:"numeric",month:"short",day:"numeric"}),C=[{header:"Sender",key:"name",render:s=>e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"font-bold text-gray-900",children:s.name}),e.jsx("p",{className:"max-w-[150px] truncate font-mono text-[10px] text-gray-400",children:s.email})]})},{header:"Subject",key:"subject",className:"font-medium text-gray-700"},{header:"Date",key:"createdAt",render:s=>e.jsx("span",{className:"text-xs text-gray-500",children:k(s.createdAt)})},{header:"Status",key:"status",render:s=>e.jsx(_,{status:s.status})},{header:"Actions",key:"actions",align:"right",render:s=>e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>x(s),className:"text-xs font-bold text-wiria-blue-dark hover:underline",children:"Details"}),s.status==="NEW"&&e.jsx("button",{onClick:()=>{x(s),h(!0)},className:"text-xs font-bold text-green-600 hover:underline",children:"Reply"}),s.status!=="ARCHIVED"&&e.jsx("button",{onClick:()=>R(s.id),className:"text-xs font-bold text-gray-400 transition-colors hover:text-red-500",children:"Archive"})]})}],j=o.filter(s=>s.status==="NEW").length;return e.jsxs("div",{className:"space-y-8",children:[e.jsx(P,{title:"Contact Messages",description:"Manage and respond to community inquiries from the contact form.",children:j>0&&e.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-yellow-100 bg-yellow-50 px-4 py-2 shadow-sm",children:[e.jsx("span",{className:"h-2 w-2 animate-pulse rounded-full bg-yellow-600"}),e.jsxs("span",{className:"text-sm font-bold text-yellow-700",children:[j," new message",j>1?"s":""]})]})}),e.jsx("div",{className:"flex w-fit flex-wrap items-center gap-2 rounded-2xl border border-gray-100 bg-white p-2 shadow-sm",children:[{label:"All",value:""},{label:"New",value:"NEW"},{label:"Responded",value:"RESPONDED"},{label:"Archived",value:"ARCHIVED"}].map(s=>e.jsx("button",{onClick:()=>i(s.value),className:`rounded-xl px-6 py-2 text-sm font-bold transition-all ${r===s.value?"bg-wiria-blue-dark text-white shadow-md":"text-gray-500 hover:bg-gray-50 hover:text-wiria-blue-dark"}`,children:s.label},s.value))}),e.jsx(S,{columns:C,data:o,rowKey:"id",isLoading:u,emptyMessage:"No messages found for this category.",rowClassName:s=>s.status==="NEW"?"bg-yellow-50/30":""}),n&&!v&&e.jsx(Y,{contact:n,onClose:()=>x(null),onReply:()=>h(!0)}),v&&n&&e.jsx(G,{contact:n,replyText:f,isSubmitting:b.isPending,setReplyText:y,onReply:E,onCancel:()=>{h(!1),y("")}})]})}export{z as default};
//# sourceMappingURL=ContactManagementPage-D4G_EaHe.js.map
