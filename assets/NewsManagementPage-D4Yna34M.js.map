{"version":3,"file":"NewsManagementPage-D4Yna34M.js","sources":["../../src/features/admin/api/news.api.ts","../../src/pages/admin/NewsManagementPage.tsx"],"sourcesContent":["import { apiClient as client } from '@/shared/services/api/client';\n\nexport interface NewsUpdate {\n  id: string;\n  title: string;\n  imageUrl?: string;\n  category: 'GENERAL' | 'EVENT' | 'ANNOUNCEMENT' | 'STORY';\n  status: 'PUBLISHED' | 'DRAFT';\n  fullContent: string;\n  excerpt?: string;\n  createdAt: string;\n}\n\ninterface CreateNewsPayload {\n  title: string;\n  imageUrl?: string;\n  category: string;\n  status: string;\n  fullContent: string;\n  excerpt?: string;\n}\n\nexport const getAdminUpdates = async () => {\n  // For admin, fetch all updates (including drafts) with includeAll=true\n  return client.get<{ data: NewsUpdate[] }>('/updates?limit=100&includeAll=true');\n};\n\nexport const createUpdate = async (data: CreateNewsPayload) => {\n  return client.post<NewsUpdate>('/updates', data);\n};\n\nexport const updateUpdate = async (id: string, data: Partial<CreateNewsPayload>) => {\n  return client.patch<NewsUpdate>(`/updates/${id}`, data);\n};\n\nexport const deleteUpdate = async (id: string) => {\n  return client.delete(`/updates/${id}`);\n};\n","import { memo, useCallback, useState } from 'react';\n\nimport type { NewsUpdate } from '@/features/admin/api/news.api';\nimport {\n  createUpdate,\n  deleteUpdate,\n  getAdminUpdates,\n  updateUpdate,\n} from '@/features/admin/api/news.api';\nimport { ConfirmDialog } from '@/shared/components/modals/ConfirmDialog';\nimport { FormModal, type FieldConfig } from '@/shared/components/modals/FormModal';\nimport { Button } from '@/shared/components/ui/Button';\nimport { useAdminData } from '@/shared/hooks/useAdminData';\nimport { notificationService } from '@/shared/services/notification/notificationService';\nimport { getErrorMessage } from '@/shared/utils/apiUtils';\n\nexport default function NewsManagementPage() {\n  const [editingUpdate, setEditingUpdate] = useState<NewsUpdate | null>(null);\n  const [showModal, setShowModal] = useState(false);\n  const [statusFilter, setStatusFilter] = useState<string>('ALL');\n  const [updateIdToDelete, setUpdateIdToDelete] = useState<string | null>(null);\n\n  const {\n    items: updates,\n    isLoading,\n    refetch,\n  } = useAdminData<NewsUpdate>(['admin-news-updates'], getAdminUpdates);\n\n  const handleDelete = useCallback((id: string) => {\n    setUpdateIdToDelete(id);\n  }, []);\n\n  const handleConfirmDelete = async () => {\n    if (!updateIdToDelete) return;\n    try {\n      await deleteUpdate(updateIdToDelete);\n      notificationService.success('Update deleted successfully');\n      void refetch();\n    } catch {\n      notificationService.error('Failed to delete update');\n    } finally {\n      setUpdateIdToDelete(null);\n    }\n  };\n\n  const handleEdit = useCallback((update: NewsUpdate) => {\n    setEditingUpdate(update);\n    setShowModal(true);\n  }, []);\n\n  // Filter updates by status\n  const filteredUpdates =\n    statusFilter === 'ALL' ? updates : updates.filter((u) => u.status === statusFilter);\n\n  // Count drafts for badge\n  const draftCount = updates.filter((u) => u.status === 'DRAFT').length;\n\n  return (\n    <div>\n      <div className=\"mb-6 flex items-center justify-between\">\n        <h2 className=\"text-2xl font-bold text-wiria-blue-dark\">News & Updates Management</h2>\n        <Button\n          onClick={() => {\n            setEditingUpdate(null);\n            setShowModal(true);\n          }}\n        >\n          + Post New Update\n        </Button>\n      </div>\n\n      {/* Status Filter Tabs */}\n      <div className=\"mb-6 flex gap-2\">\n        <button\n          onClick={() => setStatusFilter('ALL')}\n          className={`rounded-lg px-4 py-2 font-semibold transition-colors ${statusFilter === 'ALL' ? 'bg-wiria-blue-dark text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}\n        >\n          All ({updates.length})\n        </button>\n        <button\n          onClick={() => setStatusFilter('PUBLISHED')}\n          className={`rounded-lg px-4 py-2 font-semibold transition-colors ${statusFilter === 'PUBLISHED' ? 'bg-green-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}\n        >\n          Published ({updates.filter((u) => u.status === 'PUBLISHED').length})\n        </button>\n        <button\n          onClick={() => setStatusFilter('DRAFT')}\n          className={`flex items-center gap-2 rounded-lg px-4 py-2 font-semibold transition-colors ${statusFilter === 'DRAFT' ? 'bg-yellow-500 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}\n        >\n          Drafts\n          {draftCount > 0 && (\n            <span\n              className={`rounded-full px-2 py-0.5 text-xs font-bold ${statusFilter === 'DRAFT' ? 'bg-white text-yellow-600' : 'bg-yellow-100 text-yellow-700'}`}\n            >\n              {draftCount}\n            </span>\n          )}\n        </button>\n      </div>\n\n      {isLoading ? (\n        <div className=\"py-12 text-center\">Loading...</div>\n      ) : (\n        <div className=\"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3\">\n          {filteredUpdates && Array.isArray(filteredUpdates) ? (\n            filteredUpdates.map((update) => (\n              <NewsCard\n                key={update.id}\n                update={update}\n                onEdit={handleEdit}\n                onDelete={(id) => void handleDelete(id)}\n              />\n            ))\n          ) : (\n            <div className=\"col-span-full text-red-500\">\n              Error: Updates data is corrupted. Please refresh.\n            </div>\n          )}\n          {filteredUpdates.length === 0 && (\n            <p className=\"col-span-full py-12 text-center text-gray-500\">\n              {statusFilter === 'DRAFT'\n                ? 'No draft updates. Create one by saving as Draft!'\n                : 'No updates found.'}\n            </p>\n          )}\n        </div>\n      )}\n\n      {showModal && (\n        <NewsModal\n          update={editingUpdate}\n          onClose={() => setShowModal(false)}\n          onSuccess={() => {\n            setShowModal(false);\n            void refetch();\n          }}\n        />\n      )}\n      <ConfirmDialog\n        isOpen={updateIdToDelete !== null}\n        title=\"Delete Update\"\n        message=\"Are you sure you want to delete this update?\"\n        confirmLabel=\"Delete\"\n        onConfirm={() => void handleConfirmDelete()}\n        onCancel={() => setUpdateIdToDelete(null)}\n      />\n    </div>\n  );\n}\n\nconst NewsCard = memo(function NewsCard({\n  update,\n  onEdit,\n  onDelete,\n}: {\n  update: NewsUpdate;\n  onEdit: (update: NewsUpdate) => void;\n  onDelete: (id: string) => void;\n}) {\n  return (\n    <div className=\"flex h-full flex-col overflow-hidden rounded-xl border-t-4 border-wiria-yellow bg-white shadow-lg\">\n      {update.imageUrl ? (\n        <img src={update.imageUrl} alt={update.title} className=\"h-32 w-full object-cover\" />\n      ) : (\n        <div className=\"flex h-32 w-full items-center justify-center bg-gray-100 text-gray-400\">\n          No Image\n        </div>\n      )}\n      <div className=\"flex-grow p-5\">\n        <div className=\"mb-2 flex items-start justify-between\">\n          <span className=\"rounded-full bg-blue-100 px-2 py-1 text-xs font-bold text-blue-700\">\n            {update.category}\n          </span>\n          <span className=\"text-xs text-gray-400\">\n            {new Date(update.createdAt).toLocaleDateString()}\n          </span>\n        </div>\n        <h3 className=\"mb-2 line-clamp-2 text-lg font-bold text-wiria-blue-dark\">{update.title}</h3>\n        <p className=\"line-clamp-3 text-sm text-gray-600\">\n          {update.excerpt ??\n            (update.fullContent\n              ? update.fullContent.slice(0, 150) + '...'\n              : 'No content available')}\n        </p>\n        <div className=\"mt-2\">\n          <span\n            className={`rounded px-2 py-1 text-xs font-bold ${update.status === 'PUBLISHED' ? 'bg-green-100 text-green-700' : 'bg-gray-200 text-gray-700'}`}\n          >\n            {update.status}\n          </span>\n        </div>\n      </div>\n      <div className=\"mt-auto flex justify-end gap-3 border-t bg-gray-50 p-4\">\n        <button\n          onClick={() => onEdit(update)}\n          className=\"text-sm font-bold text-wiria-blue-dark hover:underline\"\n        >\n          Edit\n        </button>\n        <button\n          onClick={() => onDelete(update.id)}\n          className=\"text-sm font-bold text-red-600 hover:underline\"\n        >\n          Delete\n        </button>\n      </div>\n    </div>\n  );\n});\n\nfunction NewsModal({\n  update,\n  onClose,\n  onSuccess,\n}: {\n  update: NewsUpdate | null;\n  onClose: () => void;\n  onSuccess: () => void;\n}) {\n  const handleSubmit = async (data: Record<string, unknown>) => {\n    try {\n      const payload = {\n        title: data['title'] as string,\n        imageUrl: data['imageUrl'] as string | undefined,\n        category: data['category'] as string,\n        status: data['status'] as string,\n        fullContent: data['fullContent'] as string,\n        excerpt: data['excerpt'] as string | undefined,\n      };\n      if (update) {\n        await updateUpdate(update.id, payload);\n        notificationService.success('Update modified successfully');\n      } else {\n        await createUpdate(payload);\n        notificationService.success('Update created successfully');\n      }\n      onSuccess();\n    } catch (error: unknown) {\n      notificationService.error(getErrorMessage(error, 'Operation failed'));\n      throw error;\n    }\n  };\n\n  const fields: FieldConfig[] = [\n    {\n      name: 'title',\n      label: 'Title',\n      type: 'text',\n      required: true,\n      placeholder: 'e.g. New Community Program Launch',\n    },\n    {\n      name: 'imageUrl',\n      label: 'Image URL (Optional)',\n      type: 'text',\n      placeholder: 'https://...',\n    },\n    {\n      name: 'category',\n      label: 'Category',\n      type: 'select',\n      required: true,\n      options: [\n        { value: 'GENERAL', label: 'General' },\n        { value: 'EVENT', label: 'Event' },\n        { value: 'ANNOUNCEMENT', label: 'Announcement' },\n        { value: 'STORY', label: 'Success Story' },\n      ],\n    },\n    {\n      name: 'status',\n      label: 'Status',\n      type: 'select',\n      required: true,\n      options: [\n        { value: 'PUBLISHED', label: 'Published' },\n        { value: 'DRAFT', label: 'Draft' },\n      ],\n    },\n    {\n      name: 'fullContent',\n      label: 'Content',\n      type: 'textarea',\n      required: true,\n      placeholder: 'Describe the update in detail...',\n      rows: 8,\n    },\n    {\n      name: 'excerpt',\n      label: 'Excerpt (Optional)',\n      type: 'textarea',\n      placeholder: 'Short summary...',\n      rows: 3,\n    },\n  ];\n\n  return (\n    <FormModal\n      isOpen={true}\n      onClose={onClose}\n      onSubmit={handleSubmit}\n      title={update ? 'Edit Update' : 'Post New Update'}\n      fields={fields}\n      initialData={update ? { ...update } : undefined}\n      submitLabel=\"Save Post\"\n    />\n  );\n}\n"],"names":["getAdminUpdates","client","createUpdate","data","updateUpdate","id","deleteUpdate","NewsManagementPage","editingUpdate","setEditingUpdate","useState","showModal","setShowModal","statusFilter","setStatusFilter","updateIdToDelete","setUpdateIdToDelete","updates","isLoading","refetch","useAdminData","handleDelete","useCallback","handleConfirmDelete","notificationService","handleEdit","update","filteredUpdates","u","draftCount","jsxs","jsx","Button","NewsCard","NewsModal","ConfirmDialog","memo","onEdit","onDelete","onClose","onSuccess","handleSubmit","payload","error","getErrorMessage","fields","FormModal"],"mappings":"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"}