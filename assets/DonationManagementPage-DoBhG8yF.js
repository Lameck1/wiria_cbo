import{j as e}from"./query-vendor-DD8i-cqI.js";import{h as w,r as l}from"./react-vendor-CPrm261X.js";import{a as j,n as D}from"./index-Bf3yYa_9.js";import"./animation-vendor-DKvKsx_2.js";const A=t=>Array.isArray(t)?t:t!=null&&t.data&&Array.isArray(t.data)?t.data:t!=null&&t.donations&&Array.isArray(t.donations)?t.donations:[],E=t=>t!=null&&t.data?t.data:t,S=async t=>{try{const n=t!=null&&t.status?`?status=${t.status}`:"",i=await j.get(`/donations${n}`);return A(i)}catch(n){return console.error("Failed to fetch donations:",n),[]}},C=async()=>{try{const t=await j.get("/donations/statistics");return E(t)}catch(t){return console.error("Failed to fetch donation statistics:",t),{total:0,totalAmount:0,completed:0,pending:0,failed:0,thisMonth:0,thisMonthAmount:0}}},g={COMPLETED:"bg-green-100 text-green-700",PENDING:"bg-yellow-100 text-yellow-700",PROCESSING:"bg-blue-100 text-blue-700",FAILED:"bg-red-100 text-red-700",CANCELLED:"bg-gray-100 text-gray-700",REFUNDED:"bg-purple-100 text-purple-700"};function R(){const[t,n]=w(),[i,y]=l.useState([]),[r,b]=l.useState(null),[N,m]=l.useState(!0),[d,f]=l.useState(""),[a,o]=l.useState(null),h=t.get("highlight"),u=l.useCallback(async()=>{m(!0);try{const[s,x]=await Promise.all([S(d?{status:d}:void 0),C()]);y(s),b(x)}catch(s){console.error(s),D.error("Failed to load donations")}finally{m(!1)}},[d]);l.useEffect(()=>{u()},[u]),l.useEffect(()=>{if(!h)return;const s=i.find(v=>v.id===h);if(!s)return;o(s);const x=new URLSearchParams(t);x.delete("highlight"),n(x,{replace:!0})},[i,h,t,n]);const c=s=>`KES ${s.toLocaleString()}`,p=s=>new Date(s).toLocaleDateString("en-KE",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-wiria-blue-dark mb-4",children:"Donation Management"}),e.jsx("p",{className:"text-gray-600",children:"View and manage all donations received by WIRIA CBO."})]}),r&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow border-l-4 border-green-500",children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase",children:"Total Raised"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c(r.totalAmount)}),e.jsxs("p",{className:"text-xs text-gray-400",children:[r.total," donations"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow border-l-4 border-blue-500",children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase",children:"This Month"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c(r.thisMonthAmount||0)}),e.jsxs("p",{className:"text-xs text-gray-400",children:[r.thisMonth||0," donations"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow border-l-4 border-yellow-500",children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r.pending})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow border-l-4 border-red-500",children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase",children:"Failed"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r.failed||0})]})]}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsx("label",{htmlFor:"donation-status-filter",className:"sr-only",children:"Filter donations by status"}),e.jsxs("select",{id:"donation-status-filter","aria-label":"Filter donations by status",value:d,onChange:s=>f(s.target.value),className:"border rounded-lg px-4 py-2",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"COMPLETED",children:"Completed"}),e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"PROCESSING",children:"Processing"}),e.jsx("option",{value:"FAILED",children:"Failed"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"}),e.jsx("option",{value:"REFUNDED",children:"Refunded"})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow overflow-hidden",children:N?e.jsx("div",{className:"p-8 text-center",children:"Loading donations..."}):i.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No donations found."}):e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"Donor"}),e.jsx("th",{className:"px-6 py-4",children:"Amount"}),e.jsx("th",{className:"px-6 py-4",children:"Method"}),e.jsx("th",{className:"px-6 py-4",children:"Date"}),e.jsx("th",{className:"px-6 py-4",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y",children:i.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-semibold",children:s.isAnonymous?"Anonymous":s.donorName}),!s.isAnonymous&&e.jsx("div",{className:"text-xs text-gray-500",children:s.donorEmail})]}),e.jsx("td",{className:"px-6 py-4 font-bold text-green-600",children:c(s.amount)}),e.jsx("td",{className:"px-6 py-4 text-sm capitalize",children:s.paymentMethod.replace("_"," ").toLowerCase()}),e.jsx("td",{className:"px-6 py-4 text-sm",children:p(s.createdAt)}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${g[s.status]||"bg-gray-100"}`,children:s.status})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("button",{onClick:()=>o(s),className:"text-wiria-blue-dark hover:underline text-sm font-bold",children:"View Details"})})]},s.id))})]})}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg",children:[e.jsxs("div",{className:"p-6 border-b flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Donation Details"}),e.jsx("button",{onClick:()=>o(null),className:"text-gray-500 hover:text-gray-700",children:"âœ•"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase",children:"Donor Name"}),e.jsx("p",{className:"font-semibold",children:a.isAnonymous?"Anonymous":a.donorName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase",children:"Amount"}),e.jsx("p",{className:"font-bold text-green-600 text-xl",children:c(a.amount)})]}),!a.isAnonymous&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase",children:"Email"}),e.jsx("p",{children:a.donorEmail})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase",children:"Phone"}),e.jsx("p",{children:a.donorPhone})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase",children:"Payment Method"}),e.jsx("p",{className:"capitalize",children:a.paymentMethod.replace("_"," ").toLowerCase()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase",children:"Status"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${g[a.status]}`,children:a.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase",children:"Date"}),e.jsx("p",{children:p(a.createdAt)})]}),a.mpesaReceiptNumber&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase",children:"M-Pesa Receipt"}),e.jsx("p",{className:"font-mono",children:a.mpesaReceiptNumber})]})]}),a.message&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase mb-1",children:"Message"}),e.jsx("p",{className:"bg-gray-50 p-3 rounded-lg text-sm",children:a.message})]})]}),e.jsx("div",{className:"p-6 border-t",children:e.jsx("button",{onClick:()=>o(null),className:"w-full bg-gray-100 text-gray-700 font-bold py-3 rounded-lg hover:bg-gray-200 transition-colors",children:"Close"})})]})})]})}export{R as default};
//# sourceMappingURL=DonationManagementPage-DoBhG8yF.js.map
