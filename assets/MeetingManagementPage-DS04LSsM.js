import{j as e}from"./query-vendor-frBnvHSF.js";import{r as o}from"./react-vendor-BdaLayic.js";import{b as x,l as j,n as m}from"./index-ICA0O2oL.js";import{e as T,a as k}from"./apiUtils-CDDJc0SC.js";import{B as p}from"./Button-K8iFFe9S.js";import{M as I}from"./Modal-D8P6KMMh.js";import{C as $}from"./ConfirmDialog-BLp-gmhy.js";import{D as P}from"./DataTable-D2X_cuFs.js";import{u as G,a as R}from"./useAdminData-B_72029o.js";import"./animation-vendor-CrU7SSpu.js";import"./helpers-Brneqz2V.js";const q=async t=>{try{const a=new URLSearchParams;t!=null&&t.status&&a.append("status",t.status),t!=null&&t.upcoming&&a.append("upcoming","true");const r=a.toString()?`?${a.toString()}`:"",n=await x.get(`/admin/meetings${r}`);return k(n)}catch(a){throw j.error("Failed to fetch meetings:",a),new Error("Failed to load meetings. Please try again.")}},U=async t=>{const a=await x.post("/admin/meetings",t);return T(a)},B=async(t,a)=>{const r=await x.put(`/admin/meetings/${t}`,a);return T(r)},_=async t=>{try{return await x.patch(`/admin/meetings/${t}`,{status:"CANCELLED"}),!0}catch(a){throw j.error("Failed to cancel meeting:",a),a}},H=async t=>{try{const a=await x.get(`/admin/meetings/${t}/attendance`);return k(a,"attendance")}catch(a){throw j.error("Failed to fetch meeting attendance:",a),new Error("Failed to load meeting attendance. Please try again.")}},S={SCHEDULED:"bg-blue-100 text-blue-700",IN_PROGRESS:"bg-green-100 text-green-700",COMPLETED:"bg-gray-100 text-gray-700",CANCELLED:"bg-red-100 text-red-700"},C={AGM:"Annual General Meeting",SGM:"Special General Meeting",COMMITTEE:"Committee Meeting",OTHER:"Other"};function D(t){return new Date(t).toLocaleDateString("en-KE",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}function M(t){const[a,r]=t.split(":"),n=Number.parseInt(a??"0"),s=n>=12?"PM":"AM";return`${n%12||12}:${r??"00"} ${s}`}const W=t=>[{header:"Meeting",key:"title",className:"font-semibold"},{header:"Type",key:"meetingType",render:a=>e.jsx("span",{className:"text-sm",children:C[a.meetingType]})},{header:"Date",key:"date",render:a=>e.jsx("span",{className:"text-sm",children:D(a.date)})},{header:"Attendance",key:"attendanceCount",render:a=>e.jsxs("span",{className:"text-sm",children:[a.attendanceCount??0," members"]})},{header:"Status",key:"status",render:a=>e.jsx("span",{className:`rounded-full px-2 py-1 text-xs font-bold ${S[a.status]}`,children:a.status.replace("_"," ")})},{header:"Actions",key:"actions",align:"right",render:a=>e.jsx("button",{onClick:()=>void t(a),className:"text-sm font-bold text-wiria-blue-dark hover:underline",children:"View Attendance"})}];function z({meeting:t,attendance:a,onClose:r}){return e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 p-4",children:e.jsxs("div",{className:"w-full max-w-lg rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b p-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Meeting Attendance"}),e.jsx("p",{className:"text-sm text-gray-500",children:t.title})]}),e.jsx("button",{onClick:r,className:"text-2xl text-gray-500 hover:text-gray-700",children:"Ã—"})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto p-6",children:a.length===0?e.jsx("p",{className:"py-4 text-center text-gray-500",children:"No attendance records."}):e.jsx("ul",{className:"divide-y",children:a.map(n=>{var s,d,c;return e.jsxs("li",{className:"flex items-center justify-between py-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold",children:[(s=n.member)==null?void 0:s.firstName," ",(d=n.member)==null?void 0:d.lastName]}),e.jsx("p",{className:"text-xs text-gray-500",children:(c=n.member)==null?void 0:c.email})]}),e.jsx("p",{className:"text-xs text-gray-400",children:new Date(n.checkedInAt).toLocaleTimeString()})]},n.id)})})}),e.jsx("div",{className:"border-t p-6",children:e.jsx(p,{variant:"secondary",fullWidth:!0,onClick:r,children:"Close"})})]})})}function K({meeting:t}){var a;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"meetingDate",className:"mb-2 block text-sm font-bold",children:"Date *"}),e.jsx("input",{id:"meetingDate",type:"date",name:"date",defaultValue:(a=t==null?void 0:t.date)==null?void 0:a.split("T")[0],className:"w-full rounded-lg border p-3",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"meetingType",className:"mb-2 block text-sm font-bold",children:"Meeting Type *"}),e.jsxs("select",{id:"meetingType",name:"meetingType",defaultValue:t==null?void 0:t.meetingType,className:"w-full rounded-lg border p-3",required:!0,children:[e.jsx("option",{value:"",children:"Select type..."}),e.jsx("option",{value:"AGM",children:"Annual General Meeting"}),e.jsx("option",{value:"SGM",children:"Special General Meeting"}),e.jsx("option",{value:"COMMITTEE",children:"Committee Meeting"}),e.jsx("option",{value:"OTHER",children:"Other"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"meetingStartTime",className:"mb-2 block text-sm font-bold",children:"Start Time *"}),e.jsx("input",{id:"meetingStartTime",type:"time",name:"startTime",defaultValue:t==null?void 0:t.startTime,className:"w-full rounded-lg border p-3",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"meetingEndTime",className:"mb-2 block text-sm font-bold",children:"End Time *"}),e.jsx("input",{id:"meetingEndTime",type:"time",name:"endTime",defaultValue:t==null?void 0:t.endTime,className:"w-full rounded-lg border p-3",required:!0})]})]})]})}function J({meeting:t,isVirtual:a,setIsVirtual:r}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"meetingTitle",className:"mb-2 block text-sm font-bold",children:"Meeting Title *"}),e.jsx("input",{id:"meetingTitle",name:"title",defaultValue:t==null?void 0:t.title,className:"w-full rounded-lg border p-3",required:!0})]}),e.jsx(K,{meeting:t}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"meetingLocation",className:"mb-2 block text-sm font-bold",children:"Location *"}),e.jsx("input",{id:"meetingLocation",name:"location",defaultValue:t==null?void 0:t.location,className:"w-full rounded-lg border p-3",placeholder:"e.g. WIRIA CBO Office, Nairobi",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"meetingCapacity",className:"mb-2 block text-sm font-bold",children:"Capacity (Optional)"}),e.jsx("input",{id:"meetingCapacity",type:"number",name:"capacity",defaultValue:(t==null?void 0:t.capacity)??"",className:"w-full rounded-lg border p-3",placeholder:"e.g. 50"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"isVirtual",checked:a,onChange:n=>r(n.target.checked)}),e.jsx("label",{htmlFor:"isVirtual",className:"cursor-pointer font-semibold",children:"This is a virtual/hybrid meeting"})]}),a&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"meetingVirtualLink",className:"mb-2 block text-sm font-bold",children:"Virtual Meeting Link"}),e.jsx("input",{id:"meetingVirtualLink",name:"virtualLink",defaultValue:t==null?void 0:t.virtualLink,className:"w-full rounded-lg border p-3",placeholder:"https://zoom.us/..."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"meetingDescription",className:"mb-2 block text-sm font-bold",children:"Description"}),e.jsx("textarea",{id:"meetingDescription",name:"description",defaultValue:t==null?void 0:t.description,className:"h-20 w-full rounded-lg border p-3"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"meetingAgenda",className:"mb-2 block text-sm font-bold",children:"Agenda"}),e.jsx("textarea",{id:"meetingAgenda",name:"agenda",defaultValue:t==null?void 0:t.agenda,className:"h-24 w-full rounded-lg border p-3",placeholder:"Meeting agenda items..."})]})]})}function Y({meeting:t,onClose:a,onSuccess:r}){const[n,s]=o.useState(!1),[d,c]=o.useState((t==null?void 0:t.isVirtual)??!1),h=async u=>{u.preventDefault(),s(!0);const i=new FormData(u.currentTarget),g={title:i.get("title"),description:i.get("description"),meetingType:i.get("meetingType"),date:i.get("date"),startTime:i.get("startTime"),endTime:i.get("endTime"),location:i.get("location"),isVirtual:d,virtualLink:d?i.get("virtualLink"):void 0,agenda:i.get("agenda"),capacity:i.get("capacity")?Number.parseInt(i.get("capacity")):void 0};try{t?(await B(t.id,g),m.success("Meeting updated")):(await U(g),m.success("Meeting scheduled")),r()}catch{m.error("Failed to save meeting")}finally{s(!1)}};return e.jsx(I,{isOpen:!0,onClose:a,title:t?"Edit Meeting":"Schedule New Meeting",size:"2xl",children:e.jsxs("form",{onSubmit:u=>void h(u),className:"space-y-4",children:[e.jsx(J,{meeting:t,isVirtual:d,setIsVirtual:c}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(p,{type:"submit",fullWidth:!0,disabled:n,children:n?"Saving...":t?"Update Meeting":"Schedule Meeting"}),e.jsx(p,{type:"button",variant:"secondary",fullWidth:!0,onClick:a,disabled:n,children:"Cancel"})]})]})})}function Q({meetings:t,isLoading:a,onEdit:r,onCancel:n}){return a?e.jsx("div",{className:"animate-pulse rounded-2xl border border-gray-100 bg-white p-12 text-center",children:"Loading meetings..."}):t.length===0?e.jsx("div",{className:"rounded-2xl border border-dashed border-gray-300 bg-white p-12 text-center italic text-gray-500",children:"No upcoming meetings scheduled."}):e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-1",children:t.map(s=>e.jsxs("div",{className:"group relative overflow-hidden rounded-2xl border border-gray-100 bg-white p-8 shadow-sm transition-shadow hover:shadow-md",children:[e.jsx("div",{className:"absolute left-0 top-0 h-full w-1.5 bg-blue-500"}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"text-xl font-bold text-gray-900 transition-colors group-hover:text-wiria-blue-dark",children:s.title}),e.jsx("p",{className:"text-sm font-semibold uppercase tracking-wider text-blue-600",children:C[s.meetingType]})]}),e.jsx("span",{className:`rounded-full px-3 py-1 text-xs font-bold shadow-sm ${S[s.status]}`,children:s.status.replace("_"," ")})]}),e.jsxs("div",{className:"mt-8 grid grid-cols-1 gap-8 md:grid-cols-3",children:[e.jsxs("div",{className:"rounded-xl border border-gray-100/50 bg-gray-50 p-4",children:[e.jsx("p",{className:"mb-1 text-xs font-bold uppercase text-gray-400",children:"Date & Time"}),e.jsx("p",{className:"font-bold text-gray-800",children:D(s.date)}),e.jsx("p",{className:"text-sm font-medium text-gray-600",children:s.startTime&&s.endTime?`${M(s.startTime)} - ${M(s.endTime)}`:"TBD"})]}),e.jsxs("div",{className:"rounded-xl border border-gray-100/50 bg-gray-50 p-4",children:[e.jsx("p",{className:"mb-1 text-xs font-bold uppercase text-gray-400",children:"Location"}),e.jsx("p",{className:"flex items-center gap-2 font-bold text-gray-800",children:s.isVirtual?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"h-2 w-2 animate-pulse rounded-full bg-green-500"})," Virtual"]}):s.location}),s.virtualLink&&e.jsxs("a",{href:s.virtualLink,target:"_blank",rel:"noopener noreferrer",className:"mt-1 flex items-center gap-1 text-xs font-bold text-blue-600 transition-colors hover:text-blue-800",children:["Join Meeting"," ",e.jsx("svg",{className:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})]}),e.jsxs("div",{className:"flex flex-col justify-end gap-2",children:[e.jsx("button",{onClick:()=>r(s),className:"flex w-full items-center justify-center gap-2 rounded-lg bg-wiria-blue-dark/5 py-2 text-sm font-bold text-wiria-blue-dark transition-all hover:bg-wiria-blue-dark hover:text-white",children:"Edit Details"}),e.jsx("button",{onClick:()=>n(s.id),className:"flex w-full items-center justify-center gap-2 rounded-lg bg-red-50 py-2 text-sm font-bold text-red-600 transition-all hover:bg-red-600 hover:text-white",children:"Cancel Meeting"})]})]})]},s.id))})}function oe(){const{items:t,isLoading:a}=G(["meetings"],q),r=R(l=>_(l),[["meetings"]],{onSuccess:()=>{m.success("Meeting cancelled")},onError:()=>{m.error("Failed to cancel meeting")}}),[n,s]=o.useState(!1),[d,c]=o.useState(null),[h,u]=o.useState(null),[i,g]=o.useState([]),[E,y]=o.useState(!1),[b,f]=o.useState(null),N=o.useMemo(()=>t.find(l=>l.id===h)??null,[t,h]),L=l=>{f(l)},A=()=>{b&&(r.mutate(b),f(null))},F=async l=>{u(l.id);try{const O=await H(l.id);g(O),y(!0)}catch{m.error("Failed to load attendance")}},v=t.filter(l=>l.status==="SCHEDULED"&&new Date(l.date)>=new Date),w=t.filter(l=>l.status==="COMPLETED"||new Date(l.date)<new Date),V=W(l=>void F(l));return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("header",{className:"flex items-start justify-between rounded-2xl border border-gray-100 bg-gray-50/50 p-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-gray-900",children:"Meeting Management"}),e.jsx("p",{className:"mt-1 font-medium text-gray-500",children:"Schedule and manage organization meetings."})]}),e.jsx(p,{onClick:()=>{c(null),s(!0)},children:"+ Schedule Meeting"})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"mb-4 flex items-center gap-2 text-xl font-bold text-gray-800",children:["Upcoming Meetings",e.jsx("span",{className:"rounded-full bg-blue-100 px-2 py-0.5 text-xs text-blue-700",children:v.length})]}),e.jsx(Q,{meetings:v,isLoading:a,onEdit:l=>{c(l),s(!0)},onCancel:L})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"mb-4 flex items-center gap-2 text-xl font-bold text-gray-800",children:["Past Meetings",e.jsx("span",{className:"rounded-full bg-gray-100 px-2 py-0.5 text-xs text-gray-600",children:w.length})]}),e.jsx(P,{columns:V,data:w,rowKey:"id",emptyMessage:"No past meetings found."})]}),n&&e.jsx(Y,{meeting:d,onClose:()=>s(!1),onSuccess:()=>s(!1)}),E&&N&&e.jsx(z,{meeting:N,attendance:i,onClose:()=>y(!1)}),e.jsx($,{isOpen:b!==null,title:"Cancel Meeting",message:"Are you sure you want to cancel this meeting?",confirmLabel:"Cancel Meeting",onConfirm:A,onCancel:()=>f(null)})]})}export{oe as default};
//# sourceMappingURL=MeetingManagementPage-DS04LSsM.js.map
