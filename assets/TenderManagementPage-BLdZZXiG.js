import{j as e,d as v,a as f}from"./query-vendor-DeB3i2OK.js";import{b as h,n as p}from"./index-8OXY4Dao.js";import{u as w}from"./resources.api-CBqAPuLl.js";import{B as g}from"./Button-DJTJFzQ2.js";import{M as D}from"./Modal-D-omMokM.js";import{g as C}from"./apiUtils-CDDJc0SC.js";import{C as E}from"./ConfirmDialog-DWJd0Pek.js";import{D as S}from"./DataTable-CG6a3mm-.js";import{u as T,a as k}from"./useAdminData-DA4gw9n3.js";import"./react-vendor-D3fc32Hw.js";import"./animation-vendor-JsFu8W7l.js";import"./helpers-CdcGZezW.js";const A=async(t={})=>{const s=new URLSearchParams;t.status&&s.append("status",t.status),t.category&&s.append("category",t.category),t.all&&s.append("all","true");const l=s.toString(),n=l?`/tenders?${l}`:"/tenders";return h.get(n)},P=async t=>h.post("/tenders",t),F=async(t,s)=>h.patch(`/tenders/${t}`,s),V=async t=>h.delete(`/tenders/${t}`);function j(t,s,l){t(n=>{const a=[...n];return a[s]=l,a})}function N(t){t(s=>[...s,""])}function y(t,s){t(l=>l.filter((n,a)=>a!==s))}function q({tender:t}){return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"border-b pb-1 font-bold text-wiria-blue-dark",children:"Basic Information"}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-title",children:"Tender Title *"}),e.jsx("input",{id:"tender-title",name:"title",defaultValue:t?.title,className:"w-full rounded-lg border p-2.5",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-refNo",children:"Reference No *"}),e.jsx("input",{id:"tender-refNo",name:"refNo",defaultValue:t?.refNo,className:"w-full rounded-lg border p-2.5",required:!0,placeholder:"WIRIA/2025/..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-category",children:"Category *"}),e.jsx("input",{id:"tender-category",name:"category",defaultValue:t?.category,className:"w-full rounded-lg border p-2.5",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-deadline",children:"Deadline *"}),e.jsx("input",{id:"tender-deadline",type:"datetime-local",name:"deadline",defaultValue:t?.deadline?new Date(t.deadline).toISOString().slice(0,16):"",className:"w-full rounded-lg border p-2.5",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-estimatedValue",children:"Est. Value"}),e.jsx("input",{id:"tender-estimatedValue",name:"estimatedValue",defaultValue:t?.estimatedValue,className:"w-full rounded-lg border p-2.5"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-status",children:"Status"}),e.jsxs("select",{id:"tender-status",name:"status",defaultValue:t?.status??"OPEN",className:"w-full rounded-lg border p-2.5",children:[e.jsx("option",{value:"OPEN",children:"Open"}),e.jsx("option",{value:"CLOSED",children:"Closed"}),e.jsx("option",{value:"AWARDED",children:"Awarded"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"})]})]})]})}function I({tender:t}){return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"border-b pb-1 font-bold text-wiria-blue-dark",children:"Submission & Contact"}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-submissionMethod",children:"Submission Method *"}),e.jsxs("select",{id:"tender-submissionMethod",name:"submissionMethod",defaultValue:t?.submissionMethod??"ONLINE",className:"w-full rounded-lg border p-2.5",children:[e.jsx("option",{value:"ONLINE",children:"Online (Email)"}),e.jsx("option",{value:"PHYSICAL",children:"Physical (Seal Box)"}),e.jsx("option",{value:"BOTH",children:"Both"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-submissionEmail",children:"Submission Email *"}),e.jsx("input",{id:"tender-submissionEmail",type:"email",name:"submissionEmail",defaultValue:t?.submissionEmail??"tenders@wiria.org",className:"w-full rounded-lg border p-2.5",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-contactPerson",children:"Contact Person *"}),e.jsx("input",{id:"tender-contactPerson",name:"contactPerson",defaultValue:t?.contactPerson,className:"w-full rounded-lg border p-2.5",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-contactPhone",children:"Contact Phone *"}),e.jsx("input",{id:"tender-contactPhone",name:"contactPhone",defaultValue:t?.contactPhone,className:"w-full rounded-lg border p-2.5",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-file-input",children:"Tender Document (PDF)"}),e.jsx("input",{type:"file",id:"tender-file-input",className:"w-full rounded-lg border p-2 text-sm",accept:".pdf,.doc,.docx"}),e.jsx("input",{type:"hidden",name:"downloadUrl",defaultValue:t?.downloadUrl})]})]})}function M({eligibility:t,requiredDocuments:s,setEligibility:l,setRequiredDocuments:n}){return e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-2 block text-sm font-bold",children:"Eligibility Criteria"}),t.map((a,i)=>e.jsxs("div",{className:"mb-2 flex gap-2",children:[e.jsx("input",{"aria-label":`Eligibility criteria ${i+1}`,value:a,onChange:o=>j(l,i,o.target.value),className:"flex-1 rounded-lg border p-2 text-sm",required:!0}),e.jsx("button",{type:"button",onClick:()=>y(l,i),className:"text-red-500",children:"✕"})]},i)),e.jsx("button",{type:"button",onClick:()=>N(l),className:"text-xs font-bold text-blue-600",children:"+ Add Criteria"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"mb-2 block text-sm font-bold",children:"Required Documents"}),s.map((a,i)=>e.jsxs("div",{className:"mb-2 flex gap-2",children:[e.jsx("input",{"aria-label":`Required document ${i+1}`,value:a,onChange:o=>j(n,i,o.target.value),className:"flex-1 rounded-lg border p-2 text-sm",required:!0}),e.jsx("button",{type:"button",onClick:()=>y(n,i),className:"text-red-500",children:"✕"})]},i)),e.jsx("button",{type:"button",onClick:()=>N(n),className:"text-xs font-bold text-blue-600",children:"+ Add Document"})]})]})}function O({tender:t,eligibility:s,requiredDocuments:l,queryClient:n,onSuccess:a,setIsSubmitting:i}){return async o=>{o.preventDefault(),i(!0);const u=o.currentTarget,c=new FormData(u),d=Object.fromEntries(c.entries()),m=u.querySelector("#tender-file-input");let x=d.downloadUrl||"";try{if(m?.files&&m.files.length>0){p.info("Uploading document...");const b=m.files[0];b&&(x=(await w(b,"tenders")).data.url)}const r={title:d.title,refNo:d.refNo,category:d.category,estimatedValue:d.estimatedValue,deadline:new Date(d.deadline).toISOString(),status:d.status,submissionMethod:d.submissionMethod,submissionEmail:d.submissionEmail,contactPerson:d.contactPerson,contactPhone:d.contactPhone,description:d.description,eligibility:s.filter(b=>b.trim()),requiredDocuments:l.filter(b=>b.trim()),downloadUrl:x};t?(await F(t.id,r),p.success("Tender updated")):(await P(r),p.success("Tender advertised")),n.invalidateQueries({queryKey:["tenders"]}),a()}catch(r){p.error(C(r,"Operation failed"))}finally{i(!1)}}}function L({tender:t,onClose:s,onSuccess:l}){const n=v(),[a,i]=f.useState(t?.eligibility??["Legal registration in Kenya","Tax compliance"]),[o,u]=f.useState(t?.requiredDocuments??["Certificate of Incorporation","KRA PIN/Tax Compliance"]),[c,d]=f.useState(!1),m=O({tender:t,eligibility:a,requiredDocuments:o,queryClient:n,onSuccess:l,setIsSubmitting:d});return e.jsx(D,{isOpen:!0,onClose:s,title:t?"Edit Tender":"Advertise New Tender",size:"3xl",children:e.jsxs("form",{onSubmit:x=>{m(x)},className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsx(q,{tender:t}),e.jsx(I,{tender:t})]}),e.jsx(M,{eligibility:a,requiredDocuments:o,setEligibility:i,setRequiredDocuments:u}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-description",children:"Full Description *"}),e.jsx("textarea",{id:"tender-description",name:"description",defaultValue:t?.description,className:"h-24 w-full rounded-lg border p-3 text-sm",required:!0})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(g,{type:"submit",fullWidth:!0,disabled:c,children:c?"Saving...":t?"Update Tender":"Advertise Tender"}),e.jsx(g,{type:"button",variant:"secondary",fullWidth:!0,onClick:s,disabled:c,children:"Cancel"})]})]})})}function Z(){const{items:t,isLoading:s}=T(["tenders",{all:!0}],()=>A({all:!0})),l=k(r=>V(r),[["tenders"]],{onSuccess:()=>{p.success("Tender deleted successfully")},onError:()=>{p.error("Failed to delete tender")}}),[n,a]=f.useState(null),[i,o]=f.useState(!1),[u,c]=f.useState(null),d=r=>{c(r)},m=()=>{u&&(l.mutate(u),c(null))},x=[{header:"Ref No",key:"refNo",className:"font-mono text-xs"},{header:"Title",key:"title",className:"font-semibold"},{header:"Deadline",key:"deadline",render:r=>e.jsx("span",{className:"text-sm",children:new Date(r.deadline).toLocaleDateString()})},{header:"Document",key:"downloadUrl",render:r=>r.downloadUrl?e.jsx("span",{className:"inline-flex items-center gap-1 rounded bg-green-100 px-2 py-0.5 text-[10px] font-bold uppercase text-green-700",children:"✓ Uploaded"}):e.jsx("span",{className:"inline-flex items-center gap-1 rounded bg-yellow-100 px-2 py-0.5 text-[10px] font-bold uppercase text-yellow-700",children:"⚠ Missing"})},{header:"Status",key:"status",render:r=>e.jsx(R,{tender:r})},{header:"Actions",key:"actions",align:"right",render:r=>e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{a(r),o(!0)},className:"text-sm font-bold text-wiria-blue-dark hover:underline",children:"Edit"}),e.jsx("button",{onClick:()=>d(r.id),className:"text-sm font-bold text-red-600 hover:underline",children:"Delete"})]})}];return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("header",{className:"flex items-center justify-between rounded-2xl border border-gray-100 bg-gray-50/50 p-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-gray-900",children:"Tender Management"}),e.jsx("p",{className:"mt-1 font-medium text-gray-500",children:"Advertise and manage organization procurement opportunities."})]}),e.jsx(g,{onClick:()=>{a(null),o(!0)},children:"+ Advertise New Tender"})]}),e.jsx(S,{columns:x,data:t,rowKey:"id",isLoading:s,emptyMessage:"No tenders advertised yet."}),i&&e.jsx(L,{tender:n,onClose:()=>o(!1),onSuccess:()=>o(!1)}),e.jsx(E,{isOpen:u!==null,title:"Delete Tender",message:"Are you sure you want to delete this tender?",confirmLabel:"Delete",onConfirm:m,onCancel:()=>c(null)})]})}function R({tender:t}){const l=t.status==="OPEN"&&new Date(t.deadline)<new Date?"EXPIRED":t.status,n={OPEN:"bg-green-100 text-green-700",CLOSED:"bg-red-100 text-red-700",AWARDED:"bg-blue-100 text-blue-700",CANCELLED:"bg-gray-100 text-gray-700",EXPIRED:"bg-yellow-100 text-yellow-700"};return e.jsx("span",{className:`rounded-full px-2 py-1 text-[10px] font-bold uppercase tracking-wider ${n[l]??"bg-gray-100"}`,children:l})}export{Z as default};
//# sourceMappingURL=TenderManagementPage-BLdZZXiG.js.map
