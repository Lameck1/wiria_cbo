import{a as m,j as e}from"./query-vendor-DeB3i2OK.js";import{T as I,c as M,m as v}from"./index-8OXY4Dao.js";import{C as p,a as g}from"./Card-DSTnzHyU.js";import{m as f}from"./animation-vendor-JsFu8W7l.js";function F({donationId:s,isActive:a,onStatusCheck:t,interval:n=I.PAYMENT_POLL_INTERVAL}){const r=m.useRef(null),i=m.useRef(t);m.useEffect(()=>{i.current=t},[t]),m.useEffect(()=>{if(!a||!s){r.current&&(clearInterval(r.current),r.current=null);return}const l=async()=>{const o=i.current;if(!o)return;const c=await o(s);(c==="COMPLETED"||c==="FAILED")&&r.current&&(clearInterval(r.current),r.current=null)};return l(),r.current=setInterval(()=>{l()},n),()=>{r.current&&(clearInterval(r.current),r.current=null)}},[s,a,n])}var u=(s=>(s.PENDING="PENDING",s.COMPLETED="COMPLETED",s.FAILED="FAILED",s.CANCELLED="CANCELLED",s))(u||{});function k(s,a){const t=s.checkoutRequestId??s.transactionId??s.data?.checkoutRequestId??s.data?.transactionId,n=s.message??s.data?.message??a?.initiationSuccess;return{requestId:t,message:n}}function L({paymentMethod:s,requestId:a,message:t,config:n,setCheckoutRequestId:r,setTransactionId:i,setPaymentStatus:l,notifySuccess:o}){if(s==="STK_PUSH"&&a){r(a),i(a),l(u.PENDING);const c=n.messages?.stkPushSent??t??"STK push sent to your phone. Please complete the payment.";o(c);return}if(s==="MANUAL"){l(u.PENDING);const c=n.messages?.manualPaymentSubmitted??n.messages?.initiationSuccess??"Payment submitted for verification.";o(c);return}l(u.COMPLETED),o(t??"Payment initiated successfully!")}function D({apiClient:s,config:a,notificationService:t,setIsSubmitting:n,setPaymentStatus:r,setCheckoutRequestId:i,setTransactionId:l}){return async o=>v("payment_initiation",async()=>{n(!0),r(null);try{const c=await s.post(a.initiationEndpoint,o),{requestId:d,message:x}=k(c,a.messages);return L({paymentMethod:o.paymentMethod,requestId:d,message:x,config:a,setCheckoutRequestId:i,setTransactionId:l,setPaymentStatus:r,notifySuccess:h=>t.success(h)}),{success:!0,checkoutRequestId:d,transactionId:d,message:x}}catch(c){const d=c instanceof Error?c.message:"Payment initiation failed";return t.error(`${d}. Please try again.`),{success:!1}}finally{n(!1)}})()}function S({apiClient:s,config:a,notificationService:t,setPaymentStatus:n}){return async r=>{try{const i=await s.get(`${a.statusEndpoint}/${r}`);let l=null;if("status"in i&&i.status?l=i.status:"data"in i&&i.data?.status&&(l=i.data.status),!l)return u.PENDING;switch(n(l),l){case u.COMPLETED:return t.success(a.messages?.paymentCompleted??"Payment completed successfully!"),u.COMPLETED;case u.FAILED:return t.error("Payment failed. Please try again."),u.FAILED;case u.CANCELLED:return t.warning("Payment was cancelled."),u.CANCELLED;default:return u.PENDING}}catch{return u.PENDING}}}function A({apiClient:s,config:a,notificationService:t,setIsVerifying:n,setIsManualPaymentVerified:r,setPaymentStatus:i}){return async(l,o,c)=>{if(!a.manualVerificationEndpoint)return t.error("Manual payment verification not configured."),{success:!1};n(!0),r(!1);try{const d=await s.post(a.manualVerificationEndpoint,{phone:l,amount:o,accountReference:c??a.flowType.toUpperCase()});return d.verified===!0||d.status==="CONFIRMED"?(r(!0),i(u.COMPLETED),t.success("Payment verified successfully!"),{success:!0,verified:!0}):(t.error("Payment not found yet. Please wait a moment and try again."),{success:!1,verified:!1})}catch{return t.error("Verification failed. Please try again."),{success:!1}}finally{n(!1)}}}function C({setCheckoutRequestId:s,setTransactionId:a,setPaymentStatus:t,setIsSubmitting:n,setIsVerifying:r,setIsManualPaymentVerified:i}){s(null),a(null),t(null),n(!1),r(!1),i(!1)}function K(s){const{apiClient:a,notificationService:t}=M(),[n,r]=m.useState(!1),[i,l]=m.useState(!1),[o,c]=m.useState(null),[d,x]=m.useState(null),[h,b]=m.useState(null),[w,y]=m.useState(!1),P=D({apiClient:a,config:s,notificationService:t,setIsSubmitting:r,setPaymentStatus:c,setCheckoutRequestId:x,setTransactionId:b}),j=S({apiClient:a,config:s,notificationService:t,setPaymentStatus:c}),E=A({apiClient:a,config:s,notificationService:t,setIsVerifying:l,setIsManualPaymentVerified:y,setPaymentStatus:c});return{isSubmitting:n,isVerifying:i,paymentStatus:o,checkoutRequestId:d,transactionId:h,isManualPaymentVerified:w,initiatePayment:P,checkPaymentStatus:j,verifyManualPayment:E,resetPayment:()=>{C({setCheckoutRequestId:x,setTransactionId:b,setPaymentStatus:c,setIsSubmitting:r,setIsVerifying:l,setIsManualPaymentVerified:y})}}}const N={INDIVIDUAL:{registration:500,subscription:1e3},GROUP:{registration:250,subscription:500}};function V({membershipType:s,memberCount:a}){return m.useMemo(()=>{const t=N[s],n=t.registration,r=t.subscription,i=s==="INDIVIDUAL"?1:Math.max(1,a),l={rate:n,count:i,subtotal:n*i},o={rate:r,count:i,subtotal:r*i};return{registration:l,subscription:o,total:l.subtotal+o.subtotal}},[s,a])}function _({membershipType:s,memberCount:a,maxCount:t}){return m.useMemo(()=>{const n=N[s],{subscription:r,registration:i}=n,l=s==="GROUP"?Math.max(1,a):1,o=s==="GROUP"?Math.max(0,a-t):0,c=l*r,d=o*i;return{renewal:{count:l,rate:r,subtotal:c},newRegistration:{count:o,rate:i,subtotal:d},total:c+d}},[s,a,t])}function H({paymentMethod:s,amount:a,submitLabel:t="Submit Donation",accountNumber:n="DONATION"}){return s==="STK_PUSH"?e.jsx(p,{className:"border-2 border-blue-200 bg-blue-50",children:e.jsxs(g,{children:[e.jsxs("h3",{className:"mb-3 flex items-center gap-2 font-semibold text-wiria-blue-dark",children:[e.jsx("span",{className:"text-2xl",children:"üì±"}),"M-Pesa STK Push Instructions"]}),e.jsxs("ol",{className:"space-y-2 text-sm text-gray-700",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-semibold text-wiria-blue-dark",children:"1."}),e.jsx("span",{children:"Enter your M-Pesa registered phone number"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-semibold text-wiria-blue-dark",children:"2."}),e.jsxs("span",{children:['Click "',t,'"']})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-semibold text-wiria-blue-dark",children:"3."}),e.jsx("span",{children:"Check your phone for an M-Pesa prompt"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-semibold text-wiria-blue-dark",children:"4."}),e.jsx("span",{children:"Enter your M-Pesa PIN to complete the payment"})]})]})]})}):e.jsx(p,{className:"border-2 border-green-200 bg-green-50",children:e.jsxs(g,{children:[e.jsxs("h3",{className:"mb-3 flex items-center gap-2 font-semibold text-wiria-blue-dark",children:[e.jsx("span",{className:"text-2xl",children:"üè¶"}),"Manual Paybill Instructions"]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"rounded-lg border border-green-200 bg-white p-3",children:[e.jsx("p",{className:"mb-2 text-gray-600",children:"Pay via M-Pesa Paybill:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Business Number:"}),e.jsx("p",{className:"text-lg font-bold text-wiria-blue-dark",children:"123456"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Account Number:"}),e.jsx("p",{className:"text-lg font-bold text-wiria-blue-dark",children:n})]})]})]}),e.jsxs("ol",{className:"space-y-2 text-gray-700",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-semibold text-wiria-blue-dark",children:"1."}),e.jsx("span",{children:"Go to M-Pesa menu on your phone"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-semibold text-wiria-blue-dark",children:"2."}),e.jsx("span",{children:'Select "Lipa na M-Pesa" then "Paybill"'})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-semibold text-wiria-blue-dark",children:"3."}),e.jsxs("span",{children:["Enter Business Number: ",e.jsx("strong",{children:"123456"})]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-semibold text-wiria-blue-dark",children:"4."}),e.jsxs("span",{children:["Enter Account Number: ",e.jsx("strong",{children:n})]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-semibold text-wiria-blue-dark",children:"5."}),e.jsxs("span",{children:["Enter Amount: ",e.jsxs("strong",{children:["KES ",a.toLocaleString()]})]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-semibold text-wiria-blue-dark",children:"6."}),e.jsx("span",{children:"Enter your M-Pesa PIN and confirm"})]})]}),e.jsx("p",{className:"mt-3 text-xs italic text-gray-600",children:"After payment, you'll receive an M-Pesa confirmation SMS. Your payment will be processed within 24 hours."})]})]})})}function $({selected:s,onChange:a,disabled:t}){return e.jsxs("div",{children:[e.jsxs("span",{className:"mb-4 block text-sm font-semibold text-wiria-blue-dark",children:["Payment Method ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(f.button,{type:"button",disabled:t,whileHover:{y:-2},whileTap:{scale:.98},onClick:()=>a("STK_PUSH"),className:`relative cursor-pointer rounded-2xl border-2 p-5 text-center transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-wiria-yellow/50 ${s==="STK_PUSH"?"border-wiria-yellow bg-wiria-yellow/5 shadow-lg shadow-wiria-yellow/10":"border-gray-100 bg-white shadow-sm hover:border-wiria-yellow/30 hover:bg-gray-50"} ${t?"cursor-not-allowed opacity-50":""}`,children:[e.jsx("div",{className:"mb-3 text-4xl",children:"üì±"}),e.jsx("div",{className:"font-bold text-wiria-blue-dark",children:"M-Pesa STK Push"}),e.jsx("div",{className:"mt-1 text-xs font-medium text-gray-500",children:"Instant & Secure"}),s==="STK_PUSH"&&e.jsx(f.div,{layoutId:"activePayment",className:"absolute -right-2 -top-2 flex h-6 w-6 items-center justify-center rounded-full border-2 border-white bg-wiria-yellow text-xs text-white shadow-md",initial:{scale:0},animate:{scale:1},children:"‚úì"})]}),e.jsxs(f.button,{type:"button",disabled:t,whileHover:{y:-2},whileTap:{scale:.98},onClick:()=>a("MANUAL"),className:`relative cursor-pointer rounded-2xl border-2 p-5 text-center transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-wiria-yellow/50 ${s==="MANUAL"?"border-wiria-yellow bg-wiria-yellow/5 shadow-lg shadow-wiria-yellow/10":"border-gray-100 bg-white shadow-sm hover:border-wiria-yellow/30 hover:bg-gray-50"} ${t?"cursor-not-allowed opacity-50":""}`,children:[e.jsx("div",{className:"mb-3 text-4xl",children:"üè¶"}),e.jsx("div",{className:"font-bold text-wiria-blue-dark",children:"Manual Paybill"}),e.jsx("div",{className:"mt-1 text-xs font-medium text-gray-500",children:"Direct Bank/M-Pesa"}),s==="MANUAL"&&e.jsx(f.div,{layoutId:"activePayment",className:"absolute -right-2 -top-2 flex h-6 w-6 items-center justify-center rounded-full border-2 border-white bg-wiria-yellow text-xs text-white shadow-md",initial:{scale:0},animate:{scale:1},children:"‚úì"})]})]})]})}export{$ as P,H as a,V as b,F as c,u as d,_ as e,K as u};
//# sourceMappingURL=PaymentMethodToggle-Bw2KXKRT.js.map
