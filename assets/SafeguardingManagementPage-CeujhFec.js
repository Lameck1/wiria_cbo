import{j as e}from"./query-vendor-DHwl1fd7.js";import{r as l}from"./react-vendor-Bq_hyp-_.js";import{a as N,n as c}from"./index-CpgmhssD.js";import{B as g}from"./Button-CR-7xgY1.js";import"./animation-vendor-DqiKO7jm.js";const A=s=>Array.isArray(s)?s:s!=null&&s.data&&Array.isArray(s.data)?s.data:s!=null&&s.reports&&Array.isArray(s.reports)?s.reports:[],T=async s=>{try{const a=new URLSearchParams;s!=null&&s.status&&a.append("status",s.status),s!=null&&s.priority&&a.append("priority",s.priority);const i=a.toString()?`?${a.toString()}`:"",o=await N.get(`/safeguarding${i}`);return A(o)}catch(a){return console.error("Failed to fetch safeguarding reports:",a),[]}},k=async(s,a)=>{try{return await N.patch(`/safeguarding/${s}`,a),!0}catch(i){throw console.error("Failed to update safeguarding report:",i),i}},F=async(s,a)=>{try{return await N.post(`/safeguarding/${s}/resolve`,{resolution:a}),!0}catch(i){throw console.error("Failed to resolve safeguarding report:",i),i}},b={PENDING:"bg-yellow-100 text-yellow-700",UNDER_REVIEW:"bg-blue-100 text-blue-700",INVESTIGATING:"bg-orange-100 text-orange-700",RESOLVED:"bg-green-100 text-green-700",CLOSED:"bg-gray-100 text-gray-500"},I={CRITICAL:"bg-red-600 text-white",HIGH:"bg-orange-500 text-white",MEDIUM:"bg-yellow-500 text-white",LOW:"bg-green-500 text-white"},w={CHILD_PROTECTION:"Child Protection",SEXUAL_EXPLOITATION:"Sexual Exploitation",HARASSMENT:"Harassment",DISCRIMINATION:"Discrimination",FRAUD:"Fraud",OTHER:"Other"};function $(){const[s,a]=l.useState([]),[i,o]=l.useState(!0),[d,C]=l.useState(""),[x,D]=l.useState(""),[r,n]=l.useState(null),[v,p]=l.useState(!1),[h,m]=l.useState(""),[S,R]=l.useState(!1),u=l.useCallback(async()=>{o(!0);try{const t={};d&&(t.status=d),x&&(t.priority=x);const f=await T(Object.keys(t).length?t:void 0);a(f)}catch(t){console.error(t),c.error("Failed to load reports")}finally{o(!1)}},[d,x]);l.useEffect(()=>{u()},[u]);const L=async(t,f)=>{try{await k(t,{status:f}),c.success("Status updated"),u()}catch{c.error("Failed to update status")}},O=async()=>{if(!(!r||!h.trim())){R(!0);try{await F(r.id,h),c.success("Report resolved"),p(!1),m(""),n(null),u()}catch{c.error("Failed to resolve report")}finally{R(!1)}}},j=t=>new Date(t).toLocaleDateString("en-KE",{year:"numeric",month:"short",day:"numeric"}),E=s.filter(t=>t.priority==="CRITICAL"&&t.status!=="RESOLVED"&&t.status!=="CLOSED").length,y=s.filter(t=>t.status!=="RESOLVED"&&t.status!=="CLOSED").length;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-wiria-blue-dark mb-2",children:"Safeguarding Reports"}),e.jsx("p",{className:"text-gray-600",children:"Manage and respond to safeguarding concerns."}),e.jsxs("div",{className:"flex gap-3 mt-2",children:[E>0&&e.jsxs("span",{className:"inline-block bg-red-100 text-red-700 px-3 py-1 rounded-full text-sm font-bold",children:[E," critical"]}),y>0&&e.jsxs("span",{className:"inline-block bg-yellow-100 text-yellow-700 px-3 py-1 rounded-full text-sm font-bold",children:[y," open case",y>1?"s":""]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status-filter",className:"sr-only",children:"Filter reports by status"}),e.jsxs("select",{id:"status-filter",value:d,onChange:t=>C(t.target.value),className:"border rounded-lg px-4 py-2",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"UNDER_REVIEW",children:"Under Review"}),e.jsx("option",{value:"INVESTIGATING",children:"Investigating"}),e.jsx("option",{value:"RESOLVED",children:"Resolved"}),e.jsx("option",{value:"CLOSED",children:"Closed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"priority-filter",className:"sr-only",children:"Filter reports by priority"}),e.jsxs("select",{id:"priority-filter",value:x,onChange:t=>D(t.target.value),className:"border rounded-lg px-4 py-2",children:[e.jsx("option",{value:"",children:"All Priorities"}),e.jsx("option",{value:"CRITICAL",children:"Critical"}),e.jsx("option",{value:"HIGH",children:"High"}),e.jsx("option",{value:"MEDIUM",children:"Medium"}),e.jsx("option",{value:"LOW",children:"Low"})]})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow overflow-hidden",children:i?e.jsx("div",{className:"p-8 text-center",children:"Loading reports..."}):s.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No reports found."}):e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"Reference"}),e.jsx("th",{className:"px-6 py-4",children:"Type"}),e.jsx("th",{className:"px-6 py-4",children:"Priority"}),e.jsx("th",{className:"px-6 py-4",children:"Status"}),e.jsx("th",{className:"px-6 py-4",children:"Date"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y",children:s.map(t=>e.jsxs("tr",{className:`hover:bg-gray-50 ${t.priority==="CRITICAL"?"bg-red-50":""}`,children:[e.jsx("td",{className:"px-6 py-4 font-mono text-sm",children:t.referenceNumber}),e.jsx("td",{className:"px-6 py-4 text-sm",children:w[t.incidentType]||t.incidentType}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold ${I[t.priority]}`,children:t.priority})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${b[t.status]}`,children:t.status.replace("_"," ")})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:j(t.createdAt)}),e.jsxs("td",{className:"px-6 py-4 text-right",children:[e.jsx("button",{onClick:()=>n(t),className:"text-wiria-blue-dark hover:underline text-sm font-bold mr-3",children:"View"}),t.status!=="RESOLVED"&&t.status!=="CLOSED"&&e.jsx("button",{onClick:()=>{n(t),p(!0)},className:"text-green-600 hover:underline text-sm font-bold",children:"Resolve"})]})]},t.id))})]})}),r&&!v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Report: ",r.referenceNumber]}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold ${I[r.priority]}`,children:r.priority}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${b[r.status]}`,children:r.status.replace("_"," ")})]})]}),e.jsx("button",{onClick:()=>n(null),className:"text-gray-500 hover:text-gray-700",children:"âœ•"})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-1 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase",children:"Incident Type"}),e.jsx("p",{className:"font-semibold",children:w[r.incidentType]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase",children:"Incident Date"}),e.jsx("p",{children:j(r.incidentDate)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase",children:"Location"}),e.jsx("p",{children:r.incidentLocation})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase",children:"Reported"}),e.jsx("p",{children:j(r.createdAt)})]}),!r.isAnonymous&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase",children:"Reporter Name"}),e.jsx("p",{children:r.reporterName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase",children:"Reporter Contact"}),e.jsx("p",{children:r.reporterEmail})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase mb-1",children:"Description"}),e.jsx("p",{className:"bg-gray-50 p-4 rounded-lg whitespace-pre-wrap",children:r.description})]}),r.personsInvolved&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase mb-1",children:"Persons Involved"}),e.jsx("p",{className:"bg-gray-50 p-4 rounded-lg",children:r.personsInvolved})]}),r.resolution&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-green-600 font-bold uppercase mb-1",children:"Resolution"}),e.jsx("p",{className:"bg-green-50 p-4 rounded-lg text-green-700",children:r.resolution})]}),r.status!=="RESOLVED"&&r.status!=="CLOSED"&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase mb-2",children:"Update Status"}),e.jsx("div",{className:"flex gap-2",children:["PENDING","UNDER_REVIEW","INVESTIGATING"].map(t=>e.jsx("button",{onClick:()=>L(r.id,t),className:`px-3 py-1 rounded text-sm font-bold ${r.status===t?b[t]:"bg-gray-100 text-gray-600"}`,children:t.replace("_"," ")},t))})]})]}),e.jsxs("div",{className:"p-6 border-t flex gap-3",children:[r.status!=="RESOLVED"&&r.status!=="CLOSED"&&e.jsx(g,{onClick:()=>p(!0),children:"Mark as Resolved"}),e.jsx(g,{variant:"secondary",onClick:()=>n(null),children:"Close"})]})]})}),v&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[70] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg",children:[e.jsxs("div",{className:"p-6 border-b",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Resolve Report"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Report: ",r.referenceNumber]})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("label",{className:"block text-sm font-bold mb-2",children:"Resolution Details *"}),e.jsx("textarea",{value:h,onChange:t=>m(t.target.value),className:"w-full border rounded-lg p-3 h-40",placeholder:"Describe how this issue was resolved...",required:!0})]}),e.jsxs("div",{className:"p-6 border-t flex gap-3",children:[e.jsx(g,{onClick:O,disabled:S||!h.trim(),children:S?"Saving...":"Confirm Resolution"}),e.jsx(g,{variant:"secondary",onClick:()=>{p(!1),m("")},children:"Cancel"})]})]})})]})}export{$ as default};
//# sourceMappingURL=SafeguardingManagementPage-CeujhFec.js.map
