import{j as e,d as A}from"./query-vendor-CM55eWOT.js";import{c as b,r as x}from"./react-vendor-CXp26_Hx.js";import{d as m,U as y,R as i,f as g,E as u}from"./index-Ck6qqv4n.js";import{a as C,b as p}from"./dateUtils-CLm2GaNA.js";import{e as M,a as j}from"./apiUtils-0UX-zM9U.js";import{S as N}from"./StatusBadge-DxoyjbSs.js";import"./animation-vendor-Bcu85ETC.js";function w({data:s,title:n,color:t="bg-blue-500",formatValue:a=o=>o.toString(),height:r=120}){if(s.length===0)return e.jsxs("div",{className:"rounded-xl bg-white p-4 shadow",children:[e.jsx("h3",{className:"mb-2 text-sm font-bold text-gray-700",children:n}),e.jsx("div",{className:"py-8 text-center text-gray-400",children:"No data available"})]});const o=Math.max(...s.map(l=>l.value),1);return e.jsxs("div",{className:"rounded-xl bg-white p-4 shadow",children:[e.jsx("h3",{className:"mb-4 text-sm font-bold text-gray-700",children:n}),e.jsx("div",{className:"flex items-end gap-2",style:{height:r},children:s.map((l,d)=>{const S=l.value/o*100;return e.jsxs("div",{className:"flex flex-1 flex-col items-center",children:[e.jsxs("div",{className:"flex w-full flex-col items-center justify-end",style:{height:r-30},children:[e.jsx("span",{className:"mb-1 text-xs font-semibold text-gray-600",children:a(l.value)}),e.jsx("div",{className:`w-full ${t} rounded-t transition-all duration-300`,style:{height:`${Math.max(S,5)}%`}})]}),e.jsx("span",{className:"mt-1 w-full truncate text-center text-xs text-gray-500",children:l.label||C(l.month)})]},l.month+"-"+d)})})]})}function R({donationData:s=[],memberData:n=[]}){const t=a=>a>=1e3?`${(a/1e3).toFixed(0)}K`:a.toString();return e.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(w,{data:(s||[]).map(a=>({month:a.month,value:a.amount})),title:"ðŸ“ˆ Donations Trend (Last 6 Months)",color:"bg-green-500",formatValue:t}),e.jsx(w,{data:(n||[]).map(a=>({month:a.month,value:a.count})),title:"ðŸ‘¥ New Members (Last 6 Months)",color:"bg-blue-500"})]})}function I(){return e.jsxs("div",{className:"animate-pulse rounded-2xl border-t-4 border-gray-200 bg-white p-6 shadow-lg",children:[e.jsx("div",{className:"mb-3 h-3 w-24 rounded bg-gray-200"}),e.jsx("div",{className:"h-8 w-16 rounded bg-gray-200"})]})}function k(){return e.jsx("div",{className:"space-y-3",children:[1,2,3].map(s=>e.jsxs("div",{className:"animate-pulse rounded-lg bg-gray-50 p-3",children:[e.jsx("div",{className:"mb-2 h-4 w-3/4 rounded bg-gray-200"}),e.jsx("div",{className:"h-3 w-1/2 rounded bg-gray-200"})]},s))})}function E(){return e.jsxs("div",{className:"animate-pulse rounded-2xl bg-white p-6 shadow-xl",children:[e.jsx("div",{className:"mb-6 h-6 w-48 rounded bg-gray-200"}),e.jsx("div",{className:"h-64 rounded bg-gray-100"})]})}function c({title:s,value:n,subtitle:t,borderColor:a="border-blue-600",onClick:r,icon:o}){const l=!!r;return e.jsxs("div",{className:`rounded-2xl border-t-4 ${a} bg-white p-6 shadow-lg transition-shadow ${l?"cursor-pointer hover:shadow-xl":""}`,onClick:r,role:l?"button":void 0,tabIndex:l?0:void 0,onKeyDown:d=>{l&&(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),r())},"aria-label":l?`View ${s}`:void 0,children:[o&&e.jsx("div",{className:"mb-2 text-2xl",children:o}),e.jsx("p",{className:"mb-1 text-xs font-bold uppercase text-gray-500",children:s}),e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:n}),t&&e.jsx("p",{className:"mt-1 text-xs text-gray-400",children:t})]})}const T=async(s=5)=>{try{const n=await m.get("/admin/applications");return j(n).slice(0,s).map(a=>{var r,o;return{id:a.id,name:`${a.firstName} ${a.lastName}`,type:a.type,position:((r=a.career)==null?void 0:r.title)||((o=a.opportunity)==null?void 0:o.title)||"N/A",date:a.createdAt,status:a.status}})}catch(n){return console.error("Failed to fetch recent applications:",n),[]}},_=async(s=5)=>{try{const n=await m.get("/donations");return j(n).slice(0,s).map(a=>({id:a.id,donor:a.donorName||"Anonymous",amount:Number(a.amount),date:a.createdAt,status:a.status}))}catch(n){return console.error("Failed to fetch recent donations:",n),[]}},$=async(s=5)=>{try{const n=await m.get("/contact");return j(n).slice(0,s).map(a=>({id:a.id,name:a.name,subject:a.subject,date:a.createdAt,status:a.status}))}catch(n){return console.error("Failed to fetch recent messages:",n),[]}},O=async()=>{try{const[s,n,t,a]=await Promise.all([m.get("/admin/statistics"),T(),_(),$()]),r=M(s);if(!r)throw new Error("Missing dashboard statistics data");return{members:r.members,donations:r.donations,contacts:r.contacts,safeguarding:r.safeguarding,applications:r.applications,tenders:r.tenders,news:r.news,recentApplications:n,recentDonations:t,recentMessages:a}}catch(s){return console.error("Failed to fetch consolidated dashboard stats:",s),{members:{total:0,active:0,pending:0,expired:0},donations:{total:0,totalAmount:0,completed:0,pending:0,thisMonth:0,thisMonthAmount:0},contacts:{total:0,unread:0,responded:0,pending:0},safeguarding:{total:0,open:0,investigating:0,resolved:0,critical:0},applications:{total:0,pending:0,underReview:0,shortlisted:0,accepted:0,rejected:0},tenders:{total:0,open:0,closed:0},news:{total:0,published:0,draft:0},recentApplications:[],recentDonations:[],recentMessages:[]}}},h={all:["admin","dashboard"],stats:()=>[...h.all,"stats"],trends:()=>[...h.all,"trends"]};function f(){return A({queryKey:h.stats(),queryFn:O,staleTime:1e3*60*5})}function F(){return A({queryKey:h.trends(),queryFn:async()=>{const s=await m.get("/admin/trends");return M(s)||{donations:[],members:[]}},staleTime:1e3*60*10})}const B=["members","users","safeguarding"];function D(s,n){return s?s===y.SUPER_ADMIN||s===y.ADMIN?!0:!B.includes(n):!1}function H(s){return`KES ${s.toLocaleString()}`}const U=[{label:"Manage News",icon:"ðŸ“°",route:i.ADMIN_NEWS,hoverColor:"hover:bg-wiria-blue-dark"},{label:"Manage Tenders",icon:"ðŸ“œ",route:i.ADMIN_TENDERS,hoverColor:"hover:bg-wiria-yellow"},{label:"Review Applications",icon:"ðŸ’¼",route:`${i.ADMIN_HR}?tab=applications`,hoverColor:"hover:bg-green-500"},{label:"Reply to Messages",icon:"âœ‰ï¸",route:i.ADMIN_CONTACTS,hoverColor:"hover:bg-indigo-500"},{label:"Schedule Meeting",icon:"ðŸ“…",route:i.ADMIN_MEETINGS,hoverColor:"hover:bg-purple-500"},{label:"Manage Opportunities",icon:"ðŸ¤",route:`${i.ADMIN_HR}?tab=opportunities`,hoverColor:"hover:bg-teal-500"}];function K({canAccessMembers:s}){const n=b();return e.jsxs("div",{className:"rounded-2xl bg-white p-6 shadow-lg",children:[e.jsx("h2",{className:"mb-4 text-lg font-bold text-wiria-blue-dark",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-3",children:[U.map(t=>e.jsxs("button",{onClick:()=>n(t.route),className:`flex w-full items-center rounded-xl bg-gray-50 p-3 text-left font-semibold transition-all ${t.hoverColor} hover:text-white`,children:[e.jsx("span",{className:"mr-3",children:t.icon})," ",t.label]},t.label)),s&&e.jsxs("button",{onClick:()=>n(i.ADMIN_MEMBERS),className:"flex w-full items-center rounded-xl bg-gray-50 p-3 text-left font-semibold transition-all hover:bg-blue-500 hover:text-white",children:[e.jsx("span",{className:"mr-3",children:"ðŸ‘¤"})," View Members"]})]})]})}function v({title:s,viewAllRoute:n,isLoading:t=!1,isEmpty:a,emptyMessage:r,children:o}){const l=b();return e.jsxs("div",{className:"rounded-2xl bg-white p-6 shadow-lg",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-bold text-wiria-blue-dark",children:s}),e.jsx("button",{onClick:()=>l(n),className:"text-sm text-wiria-blue-dark hover:underline",children:"View All â†’"})]}),t?e.jsx(k,{}):a?e.jsx("p",{className:"py-4 text-center text-gray-500",children:r}):e.jsx("div",{className:"space-y-3",children:o})]})}function L({applications:s,isLoading:n=!1}){const t=b();return e.jsx(v,{title:"Recent Applications",viewAllRoute:`${i.ADMIN_HR}?tab=applications`,isLoading:n,isEmpty:!s.length,emptyMessage:"No recent applications",children:s.map(a=>e.jsxs("button",{type:"button",onClick:()=>t(`${i.ADMIN_HR}?tab=applications&appId=${a.id}`),className:"flex w-full cursor-pointer items-center justify-between rounded-lg bg-gray-50 p-3 text-left transition-colors hover:bg-gray-100",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:a.name}),e.jsx("p",{className:"text-sm text-gray-500",children:a.position})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(N,{status:a.status}),e.jsx("p",{className:"mt-1 text-xs text-gray-400",children:p(a.date)})]})]},a.id))})}function P({donations:s,isLoading:n=!1}){return e.jsx(v,{title:"Recent Donations",viewAllRoute:i.ADMIN_DONATIONS,isLoading:n,isEmpty:!s.length,emptyMessage:"No recent donations",children:s.map(t=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg bg-gray-50 p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.donor}),e.jsx("p",{className:"text-sm font-bold text-green-600",children:H(t.amount)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(N,{status:t.status}),e.jsx("p",{className:"mt-1 text-xs text-gray-400",children:p(t.date)})]})]},t.id))})}function Q({messages:s,isLoading:n=!1}){return e.jsx(v,{title:"Recent Messages",viewAllRoute:i.ADMIN_CONTACTS,isLoading:n,isEmpty:!s.length,emptyMessage:"No recent messages",children:s.map(t=>e.jsxs("div",{className:"rounded-lg bg-gray-50 p-3",children:[e.jsxs("div",{className:"mb-1 flex items-start justify-between",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t.name}),e.jsx(N,{status:t.status})]}),e.jsx("p",{className:"truncate text-xs text-gray-500",children:t.subject}),e.jsx("p",{className:"mt-1 text-xs text-gray-400",children:p(t.date)})]},t.id))})}function W({stats:s,isLoading:n=!1}){return e.jsxs("div",{className:"rounded-2xl bg-gradient-to-br from-wiria-blue-dark to-blue-900 p-6 text-white shadow-lg",children:[e.jsx("h2",{className:"mb-4 text-lg font-bold",children:"Quick Stats"}),n?e.jsxs("div",{className:"animate-pulse space-y-3",children:[e.jsx("div",{className:"h-4 w-3/4 rounded bg-white bg-opacity-20"}),e.jsx("div",{className:"h-4 w-1/2 rounded bg-white bg-opacity-20"}),e.jsx("div",{className:"h-4 w-2/3 rounded bg-white bg-opacity-20"})]}):s?e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Total Members"}),e.jsx("span",{className:"font-bold",children:s.members.total})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Total Applications"}),e.jsx("span",{className:"font-bold",children:s.applications.total})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Published News"}),e.jsx("span",{className:"font-bold",children:s.news.published})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Total Tenders"}),e.jsx("span",{className:"font-bold",children:s.tenders.total})]})]}):null]})}function V(){const{user:s}=g(),n=b(),{data:t}=f(),a=r=>D(s==null?void 0:s.role,r);return e.jsxs("div",{className:"mb-8 grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6",children:[a("members")&&e.jsx(c,{title:"Active Members",value:t.members.active,subtitle:`${t.members.pending} pending`,borderColor:"border-blue-600",onClick:()=>n(i.ADMIN_MEMBERS)}),e.jsx(c,{title:"Applications",value:t.applications.pending,subtitle:`${t.applications.total} total`,borderColor:"border-yellow-500",onClick:()=>n(`${i.ADMIN_HR}?tab=applications`)}),e.jsx(c,{title:"Unread Messages",value:t.contacts.unread,subtitle:`${t.contacts.total} total`,borderColor:"border-indigo-500",onClick:()=>n(i.ADMIN_CONTACTS)}),a("safeguarding")&&e.jsx(c,{title:"Open Cases",value:t.safeguarding.open,subtitle:`${t.safeguarding.critical} critical`,borderColor:"border-red-500",onClick:()=>n(i.ADMIN_SAFEGUARDING)}),e.jsx(c,{title:"Active Tenders",value:t.tenders.open,subtitle:`${t.tenders.total} total`,borderColor:"border-green-500",onClick:()=>n(i.ADMIN_TENDERS)}),e.jsx(c,{title:"Published News",value:t.news.published,subtitle:`${t.news.total} total`,borderColor:"border-purple-500",onClick:()=>n(i.ADMIN_NEWS)})]})}function q(){const{data:s}=F();return e.jsx(R,{donationData:s.donations,memberData:s.members})}function G(){const{data:s}=f();return e.jsxs("div",{className:"space-y-6 lg:col-span-2",children:[e.jsx(L,{applications:s.recentApplications||[]}),e.jsx(P,{donations:s.recentDonations||[]})]})}function Y(){const{user:s}=g(),{data:n}=f(),t=a=>D(s==null?void 0:s.role,a);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(K,{canAccessMembers:t("members")}),e.jsx(Q,{messages:n.recentMessages||[]}),e.jsx(W,{stats:n})]})}function ae(){const{user:s}=g();return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:"Admin Dashboard | WIRIA CBO"}),e.jsx("meta",{name:"description",content:"Overview of WIRIA CBO administrative activities, statistics, and trends."}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-wiria-blue-dark",children:"Dashboard Overview"}),e.jsxs("p",{className:"text-gray-600",children:["Welcome back, ",(s==null?void 0:s.firstName)||"Admin",". Here's what's happening at WIRIA CBO."]})]}),e.jsx(u,{children:e.jsx(x.Suspense,{fallback:e.jsx("div",{className:"mb-8 grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6",children:Array.from({length:6}).map((n,t)=>e.jsx(I,{},t))}),children:e.jsx(V,{})})}),e.jsx(u,{children:e.jsx(x.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(q,{})})}),e.jsxs("div",{className:"grid grid-cols-1 gap-8 lg:grid-cols-3",children:[e.jsx(u,{children:e.jsx(x.Suspense,{fallback:e.jsx("div",{className:"lg:col-span-2 space-y-6",children:"Loading activity..."}),children:e.jsx(G,{})})}),e.jsx(u,{children:e.jsx(x.Suspense,{fallback:e.jsx("div",{className:"space-y-6",children:"Loading actions..."}),children:e.jsx(Y,{})})})]})]})}export{ae as default};
//# sourceMappingURL=AdminDashboardPage-BwdNjc8v.js.map
