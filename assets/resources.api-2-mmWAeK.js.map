{"version":3,"file":"resources.api-2-mmWAeK.js","sources":["../../src/features/admin/api/resources.api.ts"],"sourcesContent":["import { apiClient as client } from '@/shared/services/api/client';\nimport { STORAGE_KEYS, storageService } from '@/shared/services/storage/storageService';\n\nexport interface Resource {\n  id: string;\n  title: string;\n  category: string;\n  fileType: string;\n  fileSize: string;\n  isPublic: boolean;\n  downloadUrl?: string | null;\n  description: string;\n  summary?: string;\n  keyPoints?: string[];\n  downloads: number;\n  createdAt: string;\n}\n\ninterface CreateResourcePayload {\n  title: string;\n  category: string;\n  fileType: string;\n  fileSize: string;\n  isPublic: boolean;\n  downloadUrl?: string | null;\n  description: string;\n  summary?: string;\n  keyPoints?: string[];\n}\n\nexport const getAdminResources = async () => {\n  return client.get<{ data: Resource[] }>('/resources');\n};\n\nexport const createResource = async (data: CreateResourcePayload) => {\n  return client.post<Resource>('/resources', data);\n};\n\nexport const updateResource = async (id: string, data: Partial<CreateResourcePayload>) => {\n  return client.patch<Resource>(`/resources/${id}`, data);\n};\n\nexport const deleteResource = async (id: string) => {\n  return client.delete(`/resources/${id}`);\n};\n\nfunction validateFileSize(file: File) {\n  const maxSize = 10 * 1024 * 1024;\n  if (file.size > maxSize) {\n    const sizeMb = (file.size / (1024 * 1024)).toFixed(2);\n    throw new Error(\n      `File size exceeds 10MB limit. Your file is ${sizeMb}MB. Please choose a smaller file.`\n    );\n  }\n}\n\nfunction getAuthTokenOrThrow(): string {\n  const token = storageService.get<string>(STORAGE_KEYS.AUTH_TOKEN);\n  if (!token) {\n    throw new Error('Authentication required. Please log in to upload files.');\n  }\n  return token;\n}\n\nfunction buildFormData(file: File, folder: string): FormData {\n  const formData = new FormData();\n  formData.append('file', file);\n  formData.append('folder', folder);\n  return formData;\n}\n\nfunction getApiBaseUrl(): string {\n  const envValue = String(import.meta.env['VITE_API_BASE_URL'] ?? '');\n  const base = envValue.length > 0 ? envValue : 'http://localhost:5001/api';\n  return `${base}/uploads`;\n}\n\nasync function parseErrorMessage(response: Response): Promise<string> {\n  const data = (await response.json().catch(() => null)) as { error?: { message?: string } } | null;\n  if (response.status === 413 || data?.error?.message?.includes('too large')) {\n    return 'File is too large. Maximum size is 10MB. Please compress your file or choose a smaller one.';\n  }\n  if (response.status === 401) {\n    return 'Authentication failed. Please log in again.';\n  }\n  if (response.status === 403) {\n    return 'You do not have permission to upload files.';\n  }\n  return data?.error?.message ?? `Upload failed (${response.status}). Please try again.`;\n}\n\nfunction isNetworkFetchError(error: { message?: string; name?: string }): boolean {\n  return error.name === 'TypeError' && (error.message?.includes('fetch') ?? false);\n}\n\nexport const uploadFile = async (\n  file: File,\n  folder = 'resources'\n): Promise<{ data: { url: string } }> => {\n  validateFileSize(file);\n  const token = getAuthTokenOrThrow();\n  const formData = buildFormData(file, folder);\n  const url = getApiBaseUrl();\n\n  try {\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: { Authorization: `Bearer ${token}` },\n      body: formData,\n    });\n\n    if (!response.ok) {\n      const message = await parseErrorMessage(response);\n      throw new Error(message);\n    }\n\n    const result = (await response.json()) as { url: string };\n    return { data: result };\n  } catch (error: unknown) {\n    const error_ = error as { message?: string; name?: string };\n    if (\n      (error_.message?.includes('10MB') ?? false) ||\n      (error_.message?.includes('Authentication') ?? false) ||\n      (error_.message?.includes('permission') ?? false)\n    ) {\n      throw error;\n    }\n    if (isNetworkFetchError(error_)) {\n      throw new Error('Network error. Please check your connection and try again.');\n    }\n    throw new Error(error_.message ?? 'File upload failed. Please try again.');\n  }\n};\n"],"names":["getAdminResources","client","createResource","data","updateResource","id","deleteResource","validateFileSize","file","sizeMb","getAuthTokenOrThrow","token","storageService","STORAGE_KEYS","buildFormData","folder","formData","getApiBaseUrl","envValue","parseErrorMessage","response","_b","_a","_c","isNetworkFetchError","error","uploadFile","url","message","error_"],"mappings":"sDA8BO,MAAMA,EAAoB,SACxBC,EAAO,IAA0B,YAAY,EAGzCC,EAAiB,MAAOC,GAC5BF,EAAO,KAAe,aAAcE,CAAI,EAGpCC,EAAiB,MAAOC,EAAYF,IACxCF,EAAO,MAAgB,cAAcI,CAAE,GAAIF,CAAI,EAG3CG,EAAiB,MAAOD,GAC5BJ,EAAO,OAAO,cAAcI,CAAE,EAAE,EAGzC,SAASE,EAAiBC,EAAY,CAEpC,GAAIA,EAAK,KAAO,SAAS,CACvB,MAAMC,GAAUD,EAAK,KAAQ,SAAc,QAAQ,CAAC,EACpD,MAAM,IAAI,MACR,8CAA8CC,CAAM,mCAAA,CAExD,CACF,CAEA,SAASC,GAA8B,CACrC,MAAMC,EAAQC,EAAe,IAAYC,EAAa,UAAU,EAChE,GAAI,CAACF,EACH,MAAM,IAAI,MAAM,yDAAyD,EAE3E,OAAOA,CACT,CAEA,SAASG,EAAcN,EAAYO,EAA0B,CAC3D,MAAMC,EAAW,IAAI,SACrB,OAAAA,EAAS,OAAO,OAAQR,CAAI,EAC5BQ,EAAS,OAAO,SAAUD,CAAM,EACzBC,CACT,CAEA,SAASC,GAAwB,CAC/B,MAAMC,EAAkB,4BAExB,MAAO,GADMA,EAAS,OAAS,EAAIA,EAAW,2BAChC,UAChB,CAEA,eAAeC,EAAkBC,EAAqC,WACpE,MAAMjB,EAAQ,MAAMiB,EAAS,OAAO,MAAM,IAAM,IAAI,EACpD,OAAIA,EAAS,SAAW,MAAOC,GAAAC,EAAAnB,GAAA,YAAAA,EAAM,QAAN,YAAAmB,EAAa,UAAb,MAAAD,EAAsB,SAAS,aACrD,8FAELD,EAAS,SAAW,IACf,8CAELA,EAAS,SAAW,IACf,gDAEFG,EAAApB,GAAA,YAAAA,EAAM,QAAN,YAAAoB,EAAa,UAAW,kBAAkBH,EAAS,MAAM,sBAClE,CAEA,SAASI,EAAoBC,EAAqD,OAChF,OAAOA,EAAM,OAAS,gBAAgBH,EAAAG,EAAM,UAAN,YAAAH,EAAe,SAAS,WAAY,GAC5E,CAEO,MAAMI,EAAa,MACxBlB,EACAO,EAAS,cAC8B,WACvCR,EAAiBC,CAAI,EACrB,MAAMG,EAAQD,EAAA,EACRM,EAAWF,EAAcN,EAAMO,CAAM,EACrCY,EAAMV,EAAA,EAEZ,GAAI,CACF,MAAMG,EAAW,MAAM,MAAMO,EAAK,CAChC,OAAQ,OACR,QAAS,CAAE,cAAe,UAAUhB,CAAK,EAAA,EACzC,KAAMK,CAAA,CACP,EAED,GAAI,CAACI,EAAS,GAAI,CAChB,MAAMQ,EAAU,MAAMT,EAAkBC,CAAQ,EAChD,MAAM,IAAI,MAAMQ,CAAO,CACzB,CAGA,MAAO,CAAE,KADO,MAAMR,EAAS,KAAA,CAChB,CACjB,OAASK,EAAgB,CACvB,MAAMI,EAASJ,EACf,QACGH,EAAAO,EAAO,UAAP,YAAAP,EAAgB,SAAS,UAAW,QACpCD,EAAAQ,EAAO,UAAP,YAAAR,EAAgB,SAAS,oBAAqB,QAC9CE,EAAAM,EAAO,UAAP,YAAAN,EAAgB,SAAS,gBAAiB,IAErCE,EAEJD,EAAoBK,CAAM,EACtB,IAAI,MAAM,4DAA4D,EAExE,IAAI,MAAMA,EAAO,SAAW,uCAAuC,CAC3E,CACF"}