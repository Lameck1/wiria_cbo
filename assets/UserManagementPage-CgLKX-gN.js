import{j as e}from"./query-vendor-DHwl1fd7.js";import{r as i}from"./react-vendor-Bq_hyp-_.js";import{a as m,n as l,U as p}from"./index-CpgmhssD.js";import{B as b}from"./Button-CR-7xgY1.js";import{e as g}from"./apiUtils-BfmRaJyO.js";import"./animation-vendor-DqiKO7jm.js";const I=async()=>m.get("/admin/users"),w=async t=>m.post("/admin/users/invite",t),E=async(t="PENDING")=>m.get(`/admin/users/invitations?status=${t}`),S=async t=>m.delete(`/admin/users/invitations/${t}`),A=async(t,n)=>m.patch(`/admin/users/${t}/status`,{status:n});function L(){const[t,n]=i.useState("ACTIVE"),[a,s]=i.useState([]),[o,h]=i.useState([]),[c,x]=i.useState(!0),[N,d]=i.useState(!1),u=async()=>{x(!0);try{if(t==="ACTIVE"){const r=await I();s(g(r))}else{const r=await E();h(g(r))}}catch(r){console.error(r),l.error("Failed to load data")}finally{x(!1)}};i.useEffect(()=>{u()},[t]);const v=async(r,j)=>{const f=j==="ACTIVE"?"SUSPENDED":"ACTIVE";if(confirm(`Are you sure you want to change status to ${f}?`))try{await A(r,f),l.success("User status updated"),u()}catch{l.error("Failed to update status")}},y=async r=>{if(confirm("Cancel this invitation?"))try{await S(r),l.success("Invitation cancelled"),u()}catch{l.error("Failed to cancel invitation")}};return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-wiria-blue-dark",children:"Staff & Admin Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage staff accounts, roles, and permissions"})]}),e.jsxs(b,{onClick:()=>d(!0),children:[e.jsx("span",{className:"mr-2",children:"+"})," Invite New User"]})]}),e.jsxs("div",{className:"flex gap-4 mb-6 border-b",children:[e.jsx("button",{className:`px-4 py-2 font-semibold border-b-2 transition-colors ${t==="ACTIVE"?"border-wiria-blue-dark text-wiria-blue-dark":"border-transparent text-gray-600 hover:text-wiria-blue-dark"}`,onClick:()=>n("ACTIVE"),children:"Active Users"}),e.jsx("button",{className:`px-4 py-2 font-semibold border-b-2 transition-colors ${t==="PENDING"?"border-wiria-blue-dark text-wiria-blue-dark":"border-transparent text-gray-600 hover:text-wiria-blue-dark"}`,onClick:()=>n("PENDING"),children:"Pending Invitations"})]}),e.jsx("div",{className:"bg-white rounded-xl shadow overflow-hidden",children:c?e.jsx("div",{className:"p-8 text-center",children:"Loading..."}):t==="ACTIVE"?e.jsx(C,{users:a,onStatusChange:v}):e.jsx(T,{invitations:o,onCancel:y})}),N&&e.jsx(k,{onClose:()=>d(!1),onSuccess:()=>{d(!1),t==="PENDING"?u():n("PENDING")}})]})}function C({users:t,onStatusChange:n}){if(t.length===0)return e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No users found."});const a=s=>{const o={SUPER_ADMIN:"bg-purple-100 text-purple-700",ADMIN:"bg-blue-100 text-blue-700",STAFF:"bg-green-100 text-green-700",VOLUNTEER:"bg-orange-100 text-orange-700"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${o[s]||"bg-gray-100"}`,children:s})};return e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"Name"}),e.jsx("th",{className:"px-6 py-4",children:"Email"}),e.jsx("th",{className:"px-6 py-4",children:"Role"}),e.jsx("th",{className:"px-6 py-4",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y",children:t.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4",children:[s.firstName," ",s.lastName]}),e.jsx("td",{className:"px-6 py-4",children:s.email}),e.jsx("td",{className:"px-6 py-4",children:a(s.role)}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-2 ${s.status==="ACTIVE"?"text-green-600":"text-red-600"}`,children:[e.jsx("span",{className:`h-2 w-2 rounded-full ${s.status==="ACTIVE"?"bg-green-500":"bg-red-500"}`}),s.status]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("button",{onClick:()=>n(s.email,s.status),className:`text-sm font-semibold hover:underline ${s.status==="ACTIVE"?"text-red-600":"text-green-600"}`,children:s.status==="ACTIVE"?"Deactivate":"Activate"})})]},s.id))})]})}function T({invitations:t,onCancel:n}){return t.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No pending invitations."}):e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"Email"}),e.jsx("th",{className:"px-6 py-4",children:"Role"}),e.jsx("th",{className:"px-6 py-4",children:"Invited By"}),e.jsx("th",{className:"px-6 py-4",children:"Expires"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y",children:t.map(a=>{var s;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:a.email}),e.jsx("td",{className:"px-6 py-4",children:a.role}),e.jsx("td",{className:"px-6 py-4",children:((s=a.inviter)==null?void 0:s.email)||"N/A"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:new Date(a.expiresAt).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("button",{onClick:()=>n(a.id),className:"text-red-600 hover:text-red-800 text-sm font-semibold",children:"Cancel"})})]},a.id)})})]})}function k({onClose:t,onSuccess:n}){const[a,s]=i.useState(!1),o=async h=>{h.preventDefault(),s(!0);const c=new FormData(h.currentTarget),x={email:c.get("email"),role:c.get("role"),firstName:c.get("firstName"),lastName:c.get("lastName")};try{await w(x),l.success(`Invitation sent to ${x.email}`),n()}catch(N){const d=N.message||"Failed to send invitation";d.includes("session is no longer valid")?l.error("Session expired: Please log out and back in."):l.error(d)}finally{s(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsx("h3",{className:"text-xl font-bold",children:"Invite New User"})}),e.jsxs("form",{onSubmit:o,className:"p-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",htmlFor:"invite-email",children:"Email *"}),e.jsx("input",{id:"invite-email",name:"email",type:"email",required:!0,className:"w-full border rounded-lg p-2",disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",htmlFor:"invite-firstName",children:"First Name"}),e.jsx("input",{id:"invite-firstName",name:"firstName",className:"w-full border rounded-lg p-2",disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",htmlFor:"invite-lastName",children:"Last Name"}),e.jsx("input",{id:"invite-lastName",name:"lastName",className:"w-full border rounded-lg p-2",disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",htmlFor:"invite-role",children:"Role *"}),e.jsxs("select",{id:"invite-role",name:"role",required:!0,className:"w-full border rounded-lg p-2",disabled:a,children:[e.jsx("option",{value:"",children:"Select a role..."}),e.jsx("option",{value:p.STAFF,children:"Staff"}),e.jsx("option",{value:p.ADMIN,children:"Admin"}),e.jsx("option",{value:p.VOLUNTEER,children:"Volunteer"}),e.jsx("option",{value:p.SUPER_ADMIN,children:"Super Admin"})]})]})]}),e.jsxs("div",{className:"mt-6 flex gap-3",children:[e.jsx(b,{type:"submit",fullWidth:!0,disabled:a,children:a?"Sending...":"Send Invitation"}),e.jsx(b,{type:"button",variant:"secondary",fullWidth:!0,onClick:t,disabled:a,children:"Cancel"})]})]})]})})}export{L as default};
//# sourceMappingURL=UserManagementPage-CgLKX-gN.js.map
