var E=Object.defineProperty;var C=(t,a,s)=>a in t?E(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s;var v=(t,a,s)=>C(t,typeof a!="symbol"?a+"":a,s);import{j as e}from"./query-vendor-DHwl1fd7.js";import{r as m,u as k}from"./react-vendor-Bq_hyp-_.js";import{a as u,b as S,R as i}from"./index-COHeWt4J.js";import{f as R,a as I}from"./dateFormat-IzS6Qn-3.js";import"./animation-vendor-DqiKO7jm.js";const T=(t,a={})=>t?t.data?t.data:t:a,y=t=>{var a;return Array.isArray(t)?t:t!=null&&t.data&&Array.isArray(t.data)?t.data:t!=null&&t.members&&Array.isArray(t.members)?t.members:(a=t==null?void 0:t.data)!=null&&a.data&&Array.isArray(t.data.data)?t.data.data:[]},_=async(t=5)=>{try{const a=await u.get("/admin/applications");return y(a).slice(0,t).map(r=>{var l,c;return{id:r.id,name:`${r.firstName} ${r.lastName}`,type:r.type,position:((l=r.career)==null?void 0:l.title)||((c=r.opportunity)==null?void 0:c.title)||"N/A",date:r.createdAt,status:r.status}})}catch(a){return console.error("Failed to fetch recent applications:",a),[]}},F=async(t=5)=>{try{const a=await u.get("/donations");return y(a).slice(0,t).map(r=>({id:r.id,donor:r.donorName||"Anonymous",amount:Number(r.amount),date:r.createdAt,status:r.status}))}catch(a){return console.error("Failed to fetch recent donations:",a),[]}},L=async(t=5)=>{try{const a=await u.get("/contact");return y(a).slice(0,t).map(r=>({id:r.id,name:r.name,subject:r.subject,date:r.createdAt,status:r.status}))}catch(a){return console.error("Failed to fetch recent messages:",a),[]}},O=async()=>{try{const[t,a,s,r]=await Promise.all([u.get("/admin/statistics"),_(),F(),L()]),l=T(t);return{members:l.members,donations:l.donations,contacts:l.contacts,safeguarding:l.safeguarding,applications:l.applications,tenders:l.tenders,news:l.news,recentApplications:a,recentDonations:s,recentMessages:r}}catch(t){return console.error("Failed to fetch consolidated dashboard stats:",t),{members:{total:0,active:0,pending:0,expired:0},donations:{total:0,totalAmount:0,completed:0,pending:0,thisMonth:0,thisMonthAmount:0},contacts:{total:0,unread:0,responded:0,pending:0},safeguarding:{total:0,open:0,investigating:0,resolved:0,critical:0},applications:{total:0,pending:0,underReview:0,shortlisted:0,accepted:0,rejected:0},tenders:{total:0,open:0,closed:0},news:{total:0,published:0,draft:0},recentApplications:[],recentDonations:[],recentMessages:[]}}};function A({data:t,title:a,color:s="bg-blue-500",formatValue:r=c=>c.toString(),height:l=120}){if(t.length===0)return e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-700 mb-2",children:a}),e.jsx("div",{className:"text-center text-gray-400 py-8",children:"No data available"})]});const c=Math.max(...t.map(o=>o.value),1);return e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-700 mb-4",children:a}),e.jsx("div",{className:"flex items-end gap-2",style:{height:l},children:t.map((o,g)=>{const h=o.value/c*100;return e.jsxs("div",{className:"flex-1 flex flex-col items-center",children:[e.jsxs("div",{className:"w-full flex flex-col items-center justify-end",style:{height:l-30},children:[e.jsx("span",{className:"text-xs font-semibold text-gray-600 mb-1",children:r(o.value)}),e.jsx("div",{className:`w-full ${s} rounded-t transition-all duration-300`,style:{height:`${Math.max(h,5)}%`}})]}),e.jsx("span",{className:"text-xs text-gray-500 mt-1 truncate w-full text-center",children:o.label||R(o.month)})]},g)})})]})}function $({donationData:t,memberData:a}){const s=r=>r>=1e3?`${(r/1e3).toFixed(0)}K`:r.toString();return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsx(A,{data:t.map(r=>({month:r.month,value:r.amount})),title:"ðŸ“ˆ Donations Trend (Last 6 Months)",color:"bg-green-500",formatValue:s}),e.jsx(A,{data:a.map(r=>({month:r.month,value:r.count})),title:"ðŸ‘¥ New Members (Last 6 Months)",color:"bg-blue-500"})]})}class P extends m.Component{constructor(s){super(s);v(this,"handleReset",()=>{this.setState({hasError:!1,error:null})});this.state={hasError:!1,error:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,r){var l,c;console.error("ErrorBoundary caught error:",s,r),(c=(l=this.props).onError)==null||c.call(l,s,r)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"p-6 bg-red-50 rounded-lg border border-red-200",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("h3",{className:"text-sm font-bold text-red-800",children:"Something went wrong"}),e.jsxs("div",{className:"mt-2 text-sm text-red-700",children:[e.jsx("p",{children:"We encountered an error loading this section. Please try again."}),this.state.error&&!1]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:this.handleReset,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-semibold",children:"Try Again"})})]})]})}):this.props.children}}function x(){return e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-lg border-t-4 border-gray-200 animate-pulse",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded w-24 mb-3"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-16"})]})}function j(){return e.jsx("div",{className:"space-y-3",children:[1,2,3].map(t=>e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]},t))})}function f({status:t,type:a}){const s={success:"bg-green-100 text-green-700",warning:"bg-yellow-100 text-yellow-700",danger:"bg-red-100 text-red-700",info:"bg-blue-100 text-blue-700"},r=a?s[a]:s.info;return e.jsx("span",{className:`text-xs font-bold px-2 py-1 rounded-full ${r}`,children:t})}function K(){const{user:t}=S(),a=k(),[s,r]=m.useState(null),[l,c]=m.useState(!0),[o,g]=m.useState(null),[h,D]=m.useState(null);m.useEffect(()=>{(async()=>{c(!0),g(null);try{const d=await O();r(d)}catch(d){console.error("Failed to fetch dashboard stats:",d),g("Failed to load dashboard data. Please try again.")}finally{c(!1)}})(),(async()=>{try{const d=await u.get("/admin/trends");D(d)}catch(d){console.error("Failed to fetch trends:",d)}})()},[]);const b=n=>(t==null?void 0:t.role)==="SUPER_ADMIN"||(t==null?void 0:t.role)==="ADMIN"?!0:!["members","users","safeguarding"].includes(n),M=n=>`KES ${n.toLocaleString()}`,p=n=>I(n),N=n=>({COMPLETED:"success",ACTIVE:"success",ACCEPTED:"success",RESOLVED:"success",RESPONDED:"success",PENDING:"warning",UNDER_REVIEW:"warning",INVESTIGATING:"warning",REJECTED:"danger",FAILED:"danger",CRITICAL:"danger",SHORTLISTED:"info"})[n]||"info";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-wiria-blue-dark",children:"Dashboard Overview"}),e.jsxs("p",{className:"text-gray-600",children:["Welcome back, ",(t==null?void 0:t.firstName)||"Admin",". Here's what's happening at WIRIA CBO."]})]}),o&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-xl text-red-700 flex items-center justify-between",children:[e.jsx("span",{children:o}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Retry"})]}),e.jsx(P,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4 mb-8",children:l?e.jsxs(e.Fragment,{children:[e.jsx(x,{}),e.jsx(x,{}),e.jsx(x,{}),e.jsx(x,{}),e.jsx(x,{}),e.jsx(x,{})]}):s?e.jsxs(e.Fragment,{children:[b("members")&&e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-lg border-t-4 border-blue-600 cursor-pointer hover:shadow-xl transition-shadow",onClick:()=>a(i.ADMIN_MEMBERS),children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase mb-1",children:"Active Members"}),e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:s.members.active}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[s.members.pending," pending"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-lg border-t-4 border-yellow-500 cursor-pointer hover:shadow-xl transition-shadow",onClick:()=>a(`${i.ADMIN_HR}?tab=applications`),children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase mb-1",children:"Applications"}),e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:s.applications.pending}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[s.applications.total," total"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-lg border-t-4 border-indigo-500 cursor-pointer hover:shadow-xl transition-shadow",onClick:()=>a(i.ADMIN_CONTACTS),children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase mb-1",children:"Unread Messages"}),e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:s.contacts.unread}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[s.contacts.total," total"]})]}),b("safeguarding")&&e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-lg border-t-4 border-red-500 cursor-pointer hover:shadow-xl transition-shadow",onClick:()=>a(i.ADMIN_SAFEGUARDING),children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase mb-1",children:"Open Cases"}),e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:s.safeguarding.open}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[s.safeguarding.critical," critical"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-lg border-t-4 border-green-500 cursor-pointer hover:shadow-xl transition-shadow",onClick:()=>a(i.ADMIN_TENDERS),children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase mb-1",children:"Active Tenders"}),e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:s.tenders.open}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[s.tenders.total," total"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-lg border-t-4 border-purple-500 cursor-pointer hover:shadow-xl transition-shadow",onClick:()=>a(i.ADMIN_NEWS),children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase mb-1",children:"Published News"}),e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:s.news.published}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[s.news.total," total"]})]})]}):null})}),h&&e.jsx($,{donationData:h.donations,memberData:h.members}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-wiria-blue-dark",children:"Recent Applications"}),e.jsx("button",{onClick:()=>a(`${i.ADMIN_HR}?tab=applications`),className:"text-sm text-wiria-blue-dark hover:underline",children:"View All â†’"})]}),l?e.jsx(j,{}):s!=null&&s.recentApplications.length?e.jsx("div",{className:"space-y-3",children:s.recentApplications.map(n=>e.jsxs("div",{onClick:()=>a(`${i.ADMIN_HR}?tab=applications&appId=${n.id}`),className:"p-3 bg-gray-50 rounded-lg flex items-center justify-between cursor-pointer hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:n.name}),e.jsx("p",{className:"text-sm text-gray-500",children:n.position})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(f,{status:n.status,type:N(n.status)}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:p(n.date)})]})]},n.id))}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No recent applications"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-wiria-blue-dark",children:"Recent Donations"}),e.jsx("button",{onClick:()=>a(i.ADMIN_DONATIONS),className:"text-sm text-wiria-blue-dark hover:underline",children:"View All â†’"})]}),l?e.jsx(j,{}):s!=null&&s.recentDonations.length?e.jsx("div",{className:"space-y-3",children:s.recentDonations.map(n=>e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:n.donor}),e.jsx("p",{className:"text-sm text-green-600 font-bold",children:M(n.amount)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(f,{status:n.status,type:N(n.status)}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:p(n.date)})]})]},n.id))}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No recent donations"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-lg",children:[e.jsx("h2",{className:"text-lg font-bold text-wiria-blue-dark mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>a(i.ADMIN_NEWS),className:"w-full p-3 bg-gray-50 rounded-xl hover:bg-wiria-blue-dark hover:text-white transition-all text-left font-semibold flex items-center",children:[e.jsx("span",{className:"mr-3",children:"ðŸ“°"})," Manage News"]}),e.jsxs("button",{onClick:()=>a(i.ADMIN_TENDERS),className:"w-full p-3 bg-gray-50 rounded-xl hover:bg-wiria-yellow hover:text-white transition-all text-left font-semibold flex items-center",children:[e.jsx("span",{className:"mr-3",children:"ðŸ“œ"})," Manage Tenders"]}),e.jsxs("button",{onClick:()=>a(`${i.ADMIN_HR}?tab=applications`),className:"w-full p-3 bg-gray-50 rounded-xl hover:bg-green-500 hover:text-white transition-all text-left font-semibold flex items-center",children:[e.jsx("span",{className:"mr-3",children:"ðŸ’¼"})," Review Applications"]}),e.jsxs("button",{onClick:()=>a(i.ADMIN_CONTACTS),className:"w-full p-3 bg-gray-50 rounded-xl hover:bg-indigo-500 hover:text-white transition-all text-left font-semibold flex items-center",children:[e.jsx("span",{className:"mr-3",children:"âœ‰ï¸"})," Reply to Messages"]}),b("members")&&e.jsxs("button",{onClick:()=>a(i.ADMIN_MEMBERS),className:"w-full p-3 bg-gray-50 rounded-xl hover:bg-blue-500 hover:text-white transition-all text-left font-semibold flex items-center",children:[e.jsx("span",{className:"mr-3",children:"ðŸ‘¤"})," View Members"]}),e.jsxs("button",{onClick:()=>a(i.ADMIN_MEETINGS),className:"w-full p-3 bg-gray-50 rounded-xl hover:bg-purple-500 hover:text-white transition-all text-left font-semibold flex items-center",children:[e.jsx("span",{className:"mr-3",children:"ðŸ“…"})," Schedule Meeting"]}),e.jsxs("button",{onClick:()=>a(`${i.ADMIN_HR}?tab=opportunities`),className:"w-full p-3 bg-gray-50 rounded-xl hover:bg-teal-500 hover:text-white transition-all text-left font-semibold flex items-center",children:[e.jsx("span",{className:"mr-3",children:"ðŸ¤"})," Manage Opportunities"]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-wiria-blue-dark",children:"Recent Messages"}),e.jsx("button",{onClick:()=>a(i.ADMIN_CONTACTS),className:"text-sm text-wiria-blue-dark hover:underline",children:"View All â†’"})]}),l?e.jsx(j,{}):s!=null&&s.recentMessages.length?e.jsx("div",{className:"space-y-3",children:s.recentMessages.map(n=>e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm",children:n.name}),e.jsx(f,{status:n.status,type:N(n.status)})]}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:n.subject}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:p(n.date)})]},n.id))}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No recent messages"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-wiria-blue-dark to-blue-900 p-6 rounded-2xl shadow-lg text-white",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Quick Stats"}),l?e.jsxs("div",{className:"space-y-3 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-white bg-opacity-20 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-white bg-opacity-20 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-white bg-opacity-20 rounded w-2/3"})]}):s?e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Total Members"}),e.jsx("span",{className:"font-bold",children:s.members.total})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Total Applications"}),e.jsx("span",{className:"font-bold",children:s.applications.total})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Published News"}),e.jsx("span",{className:"font-bold",children:s.news.published})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Total Tenders"}),e.jsx("span",{className:"font-bold",children:s.tenders.total})]})]}):null]})]})]})]})}export{K as default};
//# sourceMappingURL=AdminDashboardPage-ljlxuHXq.js.map
