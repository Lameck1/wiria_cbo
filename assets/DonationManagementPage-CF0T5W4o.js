import{j as e}from"./query-vendor-CM55eWOT.js";import{h as D,r as x}from"./react-vendor-CXp26_Hx.js";import{d as N,v as m}from"./index-Ck6qqv4n.js";import{a as C,e as M}from"./apiUtils-0UX-zM9U.js";import{A as S}from"./AdminPageHeader-BTeP1u2j.js";import{u,D as P}from"./useAdminData-91Z-y-lf.js";import{S as g}from"./StatusBadge-DxoyjbSs.js";import{C as l,a as i}from"./Card-C-jJKiAv.js";import{S as k}from"./Spinner-CSB2ADVs.js";import{c as j}from"./dateUtils-CLm2GaNA.js";import"./animation-vendor-Bcu85ETC.js";import"./Button-JX_3oChN.js";const E=async a=>{try{const r=a!=null&&a.status?`?status=${a.status}`:"",o=await N.get(`/donations${r}`);return C(o)}catch(r){return console.error("Failed to fetch donations:",r),[]}},L=async()=>{try{const a=await N.get("/donations/statistics");return M(a)??{total:0,totalAmount:0,completed:0,pending:0,failed:0,thisMonth:0,thisMonthAmount:0}}catch(a){return console.error("Failed to fetch donation statistics:",a),{total:0,totalAmount:0,completed:0,pending:0,failed:0,thisMonth:0,thisMonthAmount:0}}};function q(){const[a,r]=D(),[o,b]=x.useState(""),[t,d]=x.useState(null),h=a.get("highlight"),{items:c,isLoading:y}=u(["donations",o],()=>E(o?{status:o}:void 0)),{items:f,isLoading:v}=u(["donation-stats"],async()=>[await L()]),n=f[0]||null;x.useEffect(()=>{if(!h||c.length===0)return;const s=c.find(A=>A.id===h);if(!s)return;d(s);const p=new URLSearchParams(a);p.delete("highlight"),r(p,{replace:!0})},[c,h,a,r]);const w=x.useMemo(()=>[{header:"Donor",key:"donorName",render:s=>e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.isAnonymous?"Anonymous":s.donorName}),!s.isAnonymous&&e.jsx("div",{className:"text-xs text-gray-500",children:s.donorEmail})]})},{header:"Amount",key:"amount",render:s=>e.jsx("span",{className:"font-bold text-green-600",children:m(s.amount)})},{header:"Method",key:"paymentMethod",render:s=>e.jsx("span",{className:"text-sm capitalize",children:s.paymentMethod.replace("_"," ").toLowerCase()})},{header:"Date",key:"createdAt",render:s=>e.jsx("span",{className:"text-sm",children:j(s.createdAt)})},{header:"Status",key:"status",render:s=>e.jsx(g,{status:s.status})},{header:"Actions",key:"actions",align:"right",render:s=>e.jsx("button",{onClick:()=>d(s),className:"text-sm font-bold text-wiria-blue-dark hover:underline",children:"View Details"})}],[]);return e.jsxs("div",{className:"space-y-8",children:[e.jsx(S,{title:"Donation Management",description:"View and manage all donations received by WIRIA CBO."}),v?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(k,{})}):n&&e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(l,{className:"border-l-4 border-l-green-500 shadow-sm",children:e.jsxs(i,{className:"p-6",children:[e.jsx("p",{className:"text-xs font-bold uppercase text-gray-500",children:"Total Raised"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m(n.totalAmount)}),e.jsxs("p",{className:"text-xs text-gray-400",children:[n.total," donations"]})]})}),e.jsx(l,{className:"border-l-4 border-l-blue-500 shadow-sm",children:e.jsxs(i,{className:"p-6",children:[e.jsx("p",{className:"text-xs font-bold uppercase text-gray-500",children:"This Month"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m(n.thisMonthAmount||0)}),e.jsxs("p",{className:"text-xs text-gray-400",children:[n.thisMonth||0," donations"]})]})}),e.jsx(l,{className:"border-l-4 border-l-yellow-500 shadow-sm",children:e.jsxs(i,{className:"p-6",children:[e.jsx("p",{className:"text-xs font-bold uppercase text-gray-500",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.pending})]})}),e.jsx(l,{className:"border-l-4 border-l-red-500 shadow-sm",children:e.jsxs(i,{className:"p-6",children:[e.jsx("p",{className:"text-xs font-bold uppercase text-gray-500",children:"Failed"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.failed||0})]})})]}),e.jsx(l,{className:"overflow-hidden border-none shadow-sm",children:e.jsxs(i,{className:"p-0",children:[e.jsx("div",{className:"border-b p-4",children:e.jsxs("select",{title:"Filter by status","aria-label":"Filter donations by status",value:o,onChange:s=>b(s.target.value),className:"rounded-lg border px-4 py-2 text-sm outline-none focus:ring-2 focus:ring-wiria-blue-dark/20",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"COMPLETED",children:"Completed"}),e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"PROCESSING",children:"Processing"}),e.jsx("option",{value:"FAILED",children:"Failed"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"}),e.jsx("option",{value:"REFUNDED",children:"Refunded"})]})}),e.jsx(P,{columns:w,data:c,isLoading:y,emptyMessage:"No donations found.",rowKey:"id"})]})}),t&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"w-full max-w-lg rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-wiria-blue-dark",children:"Donation Details"}),e.jsx("button",{onClick:()=>d(null),className:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-600 transition-colors",children:"✕"})]}),e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold uppercase text-gray-500",children:"Donor Name"}),e.jsx("p",{className:"font-semibold",children:t.isAnonymous?"Anonymous":t.donorName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold uppercase text-gray-500",children:"Amount"}),e.jsx("p",{className:"text-xl font-bold text-green-600",children:m(t.amount)})]}),!t.isAnonymous&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-xs font-bold uppercase text-gray-500",children:"Email & Phone"}),e.jsxs("p",{className:"text-sm",children:[t.donorEmail," • ",t.donorPhone]})]})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold uppercase text-gray-500",children:"Payment Method"}),e.jsx("p",{className:"text-sm capitalize",children:t.paymentMethod.replace("_"," ").toLowerCase()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold uppercase text-gray-500",children:"Status"}),e.jsx(g,{status:t.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold uppercase text-gray-500",children:"Date"}),e.jsx("p",{className:"text-sm",children:j(t.createdAt)})]}),t.mpesaReceiptNumber&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold uppercase text-gray-500",children:"M-Pesa Receipt"}),e.jsx("p",{className:"font-mono text-xs",children:t.mpesaReceiptNumber})]})]}),t.message&&e.jsxs("div",{className:"rounded-xl bg-gray-50 p-4",children:[e.jsx("p",{className:"mb-2 text-xs font-bold uppercase text-gray-500",children:"Message"}),e.jsxs("p",{className:"text-sm italic text-gray-600",children:['"',t.message,'"']})]})]}),e.jsx("div",{className:"border-t p-6",children:e.jsx("button",{onClick:()=>d(null),className:"w-full rounded-xl bg-gray-900 py-3 font-bold text-white shadow-lg transition-all hover:bg-black",children:"Close"})})]})})]})}export{q as default};
//# sourceMappingURL=DonationManagementPage-CF0T5W4o.js.map
