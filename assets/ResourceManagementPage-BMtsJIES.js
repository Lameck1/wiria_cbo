import{b as k,j as e}from"./query-vendor-DD8i-cqI.js";import{r}from"./react-vendor-CPrm261X.js";import{g as C,d as P,u as T,a as E,c as A}from"./resources.api-CBo7GjEc.js";import{B as v}from"./Button-CoxkiBvY.js";import{n}from"./index-82T4QowL.js";import{e as z,g as I}from"./apiUtils-BfmRaJyO.js";import"./animation-vendor-DKvKsx_2.js";const F=["GOVERNANCE","STRATEGIC","FINANCIAL","REPORTS","POLICIES","PUBLICATIONS","OTHER"];function K(){const l=k(),[x,j]=r.useState([]),[g,o]=r.useState(!0),[u,d]=r.useState(null),[N,c]=r.useState(!1),m=async()=>{o(!0);try{const s=await C();j(z(s))}catch(s){console.error(s),n.error("Failed to load resources")}finally{o(!1)}};r.useEffect(()=>{m()},[]);const p=async s=>{if(confirm("Are you sure you want to delete this resource?"))try{await P(s),n.success("Resource deleted successfully"),l.invalidateQueries({queryKey:["resources"]}),m()}catch{n.error("Failed to delete resource")}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-wiria-blue-dark",children:"Resource Management"}),e.jsx(v,{onClick:()=>{d(null),c(!0)},children:"+ Add New Resource"})]}),e.jsx("div",{className:"bg-white rounded-xl shadow overflow-hidden",children:g?e.jsx("div",{className:"p-8 text-center",children:"Loading..."}):e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"Title"}),e.jsx("th",{className:"px-6 py-4",children:"Category"}),e.jsx("th",{className:"px-6 py-4",children:"Type"}),e.jsx("th",{className:"px-6 py-4",children:"Public"}),e.jsx("th",{className:"px-6 py-4",children:"Downloads"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y",children:[x.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 font-semibold",children:s.title}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 rounded text-xs uppercase",children:s.category})}),e.jsxs("td",{className:"px-6 py-4 text-sm",children:[s.fileType," (",s.fileSize,")"]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${s.isPublic?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:s.isPublic?"Yes":"No"})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:s.downloads||0}),e.jsxs("td",{className:"px-6 py-4 text-right",children:[e.jsx("button",{onClick:()=>{d(s),c(!0)},className:"text-wiria-blue-dark hover:underline text-sm font-bold mr-3",children:"Edit"}),e.jsx("button",{onClick:()=>p(s.id),className:"text-red-600 hover:underline text-sm font-bold",children:"Delete"})]})]},s.id)),x.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-gray-500",children:"No resources found."})})]})]})}),N&&e.jsx(O,{resource:u,onClose:()=>c(!1),onSuccess:()=>{c(!1),m()}})]})}function O({resource:l,onClose:x,onSuccess:j}){var p,s;const g=k(),[o,u]=r.useState(!1),[d,N]=r.useState(null),c=a=>{var h;const f=(h=a.target.files)==null?void 0:h[0];N(f||null)},m=async a=>{var S,R;a.preventDefault(),u(!0);const f=a.currentTarget,h=new FormData(f),i=Object.fromEntries(h.entries()),b=f.querySelector("#resource-file-input");let w=i.downloadUrl;try{if((S=b==null?void 0:b.files)!=null&&S.length){n.info("Uploading file...");const t=b.files[0];t&&(w=(await T(t,"resources")).data.url),!i.fileSize&&t&&(i.fileSize=`${(t.size/(1024*1024)).toFixed(2)} MB`),!i.fileType&&t&&(i.fileType=((R=t.name.split(".").pop())==null?void 0:R.toUpperCase())||"FILE")}const y={...i,downloadUrl:w,isPublic:i.isPublic==="true",keyPoints:i.keyPoints?i.keyPoints.split(",").map(t=>t.trim()).filter(t=>t!==""):[]};l?(await E(l.id,y),n.success("Resource updated successfully")):(await A(y),n.success("Resource added successfully")),g.invalidateQueries({queryKey:["resources"]}),j()}catch(y){n.error(I(y,"Operation failed"))}finally{u(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsx("h3",{className:"text-2xl font-bold",children:l?"Edit Resource":"Add New Resource"})}),e.jsx("div",{className:"p-6 overflow-y-auto flex-1",children:e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",htmlFor:"resource-title",children:"Title"}),e.jsx("input",{id:"resource-title",name:"title",defaultValue:l==null?void 0:l.title,className:"w-full border rounded-lg p-2.5",required:!0,placeholder:"e.g. Annual Strategic Report 2024"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",htmlFor:"resource-category",children:"Category"}),e.jsx("select",{id:"resource-category",name:"category",defaultValue:(l==null?void 0:l.category)||F[0],className:"w-full border rounded-lg p-2.5",children:F.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",htmlFor:"resource-fileType",children:"File Type"}),e.jsx("input",{id:"resource-fileType",name:"fileType",value:d?((p=d.name.split(".").pop())==null?void 0:p.toUpperCase())||"FILE":(l==null?void 0:l.fileType)||"PDF",className:"w-full border rounded-lg p-2.5 bg-gray-50",readOnly:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Automatically detected from file"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",htmlFor:"resource-fileSize",children:"File Size"}),e.jsx("input",{id:"resource-fileSize",name:"fileSize",value:d?`${(d.size/(1024*1024)).toFixed(2)} MB`:(l==null?void 0:l.fileSize)||"",className:"w-full border rounded-lg p-2.5 bg-gray-50",placeholder:"Auto-filled from upload",readOnly:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Automatically calculated from file upload"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",htmlFor:"resource-visibility",children:"Visibility"}),e.jsxs("select",{id:"resource-visibility",name:"isPublic",defaultValue:(l==null?void 0:l.isPublic)===!1?"false":"true",className:"w-full border rounded-lg p-2.5",children:[e.jsx("option",{value:"true",children:"Public"}),e.jsx("option",{value:"false",children:"Private (Internal Only)"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",htmlFor:"resource-file-input",children:"Resource File"}),e.jsx("input",{type:"file",id:"resource-file-input",onChange:c,className:"w-full border rounded-lg p-2.5 text-sm",accept:".pdf,.doc,.docx,.xls,.xlsx"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Maximum size: 10MB. File type and size will be detected automatically."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",htmlFor:"resource-downloadUrl",children:"Download URL"}),e.jsx("input",{id:"resource-downloadUrl",name:"downloadUrl",defaultValue:(l==null?void 0:l.downloadUrl)??"",className:"w-full border rounded-lg p-2.5",placeholder:"Or provide direct URL"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",htmlFor:"resource-description",children:"Description"}),e.jsx("textarea",{id:"resource-description",name:"description",defaultValue:l==null?void 0:l.description,className:"w-full border rounded-lg p-2.5 h-20",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",htmlFor:"resource-summary",children:"Summary"}),e.jsx("textarea",{id:"resource-summary",name:"summary",defaultValue:l==null?void 0:l.summary,className:"w-full border rounded-lg p-2.5 h-24"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"Key Points (comma separated)"}),e.jsx("input",{"aria-label":"Key points",name:"keyPoints",defaultValue:(s=l==null?void 0:l.keyPoints)==null?void 0:s.join(", "),className:"w-full border rounded-lg p-2.5",placeholder:"e.g. Governance, Transparency, Impact"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(v,{type:"submit",fullWidth:!0,disabled:o,children:o?"Processing...":"Save Resource"}),e.jsx(v,{type:"button",variant:"secondary",fullWidth:!0,onClick:x,disabled:o,children:"Cancel"})]})]})})]})})}export{K as default};
//# sourceMappingURL=ResourceManagementPage-BMtsJIES.js.map
