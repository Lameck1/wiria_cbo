import{j as e}from"./query-vendor-frBnvHSF.js";import{g as M,r}from"./react-vendor-BdaLayic.js";import{b as g,l as j}from"./index-ICA0O2oL.js";import{a as P,e as k}from"./apiUtils-CDDJc0SC.js";import{S as N}from"./StatusBadge-DPX4J2hm.js";import{c as f}from"./dateUtils-D0Bnoiug.js";import{a as c}from"./helpers-Brneqz2V.js";import{C as l,a as i}from"./Card-DmlQfAyP.js";import{S as L}from"./Spinner-DvzCBoUM.js";import{A as F}from"./AdminPageHeader-CmCPoIZw.js";import{D as R}from"./DataTable-D2X_cuFs.js";import{u}from"./useAdminData-B_72029o.js";import"./animation-vendor-CrU7SSpu.js";import"./Button-K8iFFe9S.js";const I=async s=>{try{const t=s!=null&&s.status?`?status=${s.status}`:"",n=await g.get(`/donations${t}`);return P(n)}catch(t){throw j.error("Failed to fetch donations:",t),new Error("Failed to load donations. Please try again.")}},T=async()=>{try{const s=await g.get("/donations/statistics"),t=k(s);if(!t)throw new Error("Invalid donation statistics data received");return t}catch(s){throw j.error("Failed to fetch donation statistics:",s),new Error("Failed to load donation statistics. Please try again.")}};function z({donation:s,onClose:t}){return s?e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"w-full max-w-lg rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-wiria-blue-dark",children:"Donation Details"}),e.jsx("button",{onClick:t,className:"rounded-lg p-2 text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-600",children:"✕"})]}),e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold uppercase text-gray-500",children:"Donor Name"}),e.jsx("p",{className:"font-semibold",children:s.isAnonymous?"Anonymous":s.donorName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold uppercase text-gray-500",children:"Amount"}),e.jsx("p",{className:"text-xl font-bold text-green-600",children:c(s.amount)})]}),!s.isAnonymous&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-xs font-bold uppercase text-gray-500",children:"Email & Phone"}),e.jsxs("p",{className:"text-sm",children:[s.donorEmail," • ",s.donorPhone]})]})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold uppercase text-gray-500",children:"Payment Method"}),e.jsx("p",{className:"text-sm capitalize",children:s.paymentMethod.replace("_"," ").toLowerCase()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold uppercase text-gray-500",children:"Status"}),e.jsx(N,{status:s.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold uppercase text-gray-500",children:"Date"}),e.jsx("p",{className:"text-sm",children:f(s.createdAt)})]}),s.mpesaReceiptNumber&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold uppercase text-gray-500",children:"M-Pesa Receipt"}),e.jsx("p",{className:"font-mono text-xs",children:s.mpesaReceiptNumber})]})]}),s.message&&e.jsxs("div",{className:"rounded-xl bg-gray-50 p-4",children:[e.jsx("p",{className:"mb-2 text-xs font-bold uppercase text-gray-500",children:"Message"}),e.jsxs("p",{className:"text-sm italic text-gray-600",children:['"',s.message,'"']})]})]}),e.jsx("div",{className:"border-t p-6",children:e.jsx("button",{onClick:t,className:"w-full rounded-xl bg-gray-900 py-3 font-bold text-white shadow-lg transition-all hover:bg-black",children:"Close"})})]})}):null}function B({statistics:s,isLoading:t}){return t?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(L,{})}):s?e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(l,{className:"border-l-4 border-l-green-500 shadow-sm",children:e.jsxs(i,{className:"p-6",children:[e.jsx("p",{className:"text-xs font-bold uppercase text-gray-500",children:"Total Raised"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c(s.totalAmount)}),e.jsxs("p",{className:"text-xs text-gray-400",children:[s.total," donations"]})]})}),e.jsx(l,{className:"border-l-4 border-l-blue-500 shadow-sm",children:e.jsxs(i,{className:"p-6",children:[e.jsx("p",{className:"text-xs font-bold uppercase text-gray-500",children:"This Month"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c(s.thisMonthAmount||0)}),e.jsxs("p",{className:"text-xs text-gray-400",children:[s.thisMonth||0," donations"]})]})}),e.jsx(l,{className:"border-l-4 border-l-yellow-500 shadow-sm",children:e.jsxs(i,{className:"p-6",children:[e.jsx("p",{className:"text-xs font-bold uppercase text-gray-500",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.pending})]})}),e.jsx(l,{className:"border-l-4 border-l-red-500 shadow-sm",children:e.jsxs(i,{className:"p-6",children:[e.jsx("p",{className:"text-xs font-bold uppercase text-gray-500",children:"Failed"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.failed||0})]})})]}):null}const G=s=>[{header:"Donor",key:"donorName",render:t=>e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:t.isAnonymous?"Anonymous":t.donorName}),!t.isAnonymous&&e.jsx("div",{className:"text-xs text-gray-500",children:t.donorEmail})]})},{header:"Amount",key:"amount",render:t=>e.jsx("span",{className:"font-bold text-green-600",children:c(t.amount)})},{header:"Method",key:"paymentMethod",render:t=>e.jsx("span",{className:"text-sm capitalize",children:t.paymentMethod.replace("_"," ").toLowerCase()})},{header:"Date",key:"createdAt",render:t=>e.jsx("span",{className:"text-sm",children:f(t.createdAt)})},{header:"Status",key:"status",render:t=>e.jsx(N,{status:t.status})},{header:"Actions",key:"actions",align:"right",render:t=>e.jsx("button",{onClick:()=>s(t),className:"text-sm font-bold text-wiria-blue-dark hover:underline",children:"View Details"})}];function ee(){const[s,t]=M(),[n,b]=r.useState(""),[m,x]=r.useState(null),d=s.get("highlight"),{items:o,isLoading:y}=u(["donations",n],()=>I(n?{status:n}:void 0)),{items:v,isLoading:w}=u(["donation-stats"],async()=>[await T()]),D=v[0]??null,C=r.useMemo(()=>o.find(a=>a.id===m)??null,[o,m]),h=r.useCallback(a=>{x(a.id)},[]),A=r.useCallback(()=>{x(null)},[]);r.useEffect(()=>{if(!d||o.length===0||!o.some(E=>E.id===d))return;x(d);const p=new URLSearchParams(s);p.delete("highlight"),t(p,{replace:!0})},[o,d,s,t]);const S=r.useMemo(()=>G(h),[h]);return e.jsxs("div",{className:"space-y-8",children:[e.jsx(F,{title:"Donation Management",description:"View and manage all donations received by WIRIA CBO."}),e.jsx(B,{statistics:D,isLoading:w}),e.jsx(l,{className:"overflow-hidden border-none shadow-sm",children:e.jsxs(i,{className:"p-0",children:[e.jsx("div",{className:"border-b p-4",children:e.jsxs("select",{title:"Filter by status","aria-label":"Filter donations by status",value:n,onChange:a=>b(a.target.value),className:"rounded-lg border px-4 py-2 text-sm outline-none focus:ring-2 focus:ring-wiria-blue-dark/20",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"COMPLETED",children:"Completed"}),e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"PROCESSING",children:"Processing"}),e.jsx("option",{value:"FAILED",children:"Failed"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"}),e.jsx("option",{value:"REFUNDED",children:"Refunded"})]})}),e.jsx(R,{columns:S,data:o,isLoading:y,emptyMessage:"No donations found.",rowKey:"id"})]})}),e.jsx(z,{donation:C,onClose:A})]})}export{ee as default};
//# sourceMappingURL=DonationManagementPage-DbC8DnNj.js.map
