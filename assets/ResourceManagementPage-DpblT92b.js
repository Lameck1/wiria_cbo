import{b as F,j as e,u as P,c as T}from"./query-vendor-CM55eWOT.js";import{r as b}from"./react-vendor-CXp26_Hx.js";import{u as C,a as E,c as A,d as z,g as M}from"./resources.api-R4KhCyJj.js";import{B as j}from"./Button-JX_3oChN.js";import{n}from"./index-Ck6qqv4n.js";import{g as O,a as I}from"./apiUtils-0UX-zM9U.js";import{M as U}from"./Modal-BGjbfc1U.js";import"./animation-vendor-Bcu85ETC.js";const R=["GOVERNANCE","STRATEGIC","FINANCIAL","REPORTS","POLICIES","PUBLICATIONS","OTHER"];function D({resource:l,onClose:c,onSuccess:m}){var N,w;const h=F(),[i,o]=b.useState(!1),[d,y]=b.useState(null),g=r=>{var x;const u=(x=r.target.files)==null?void 0:x[0];y(u||null)},t=async r=>{var S,k;r.preventDefault(),o(!0);const u=r.currentTarget,x=new FormData(u),s=Object.fromEntries(x.entries()),p=u.querySelector("#resource-file-input");let v=s.downloadUrl||"";try{if((S=p==null?void 0:p.files)!=null&&S.length){n.info("Uploading file...");const a=p.files[0];a&&(v=(await C(a,"resources")).data.url),!s.fileSize&&a&&(s.fileSize=`${(a.size/(1024*1024)).toFixed(2)} MB`),!s.fileType&&a&&(s.fileType=((k=a.name.split(".").pop())==null?void 0:k.toUpperCase())||"FILE")}const f={title:s.title||"",category:s.category||"",fileType:s.fileType||"",fileSize:s.fileSize||"",description:s.description||"",summary:s.summary,downloadUrl:v,isPublic:s.isPublic==="true",keyPoints:s.keyPoints?s.keyPoints.split(",").map(a=>a.trim()).filter(a=>a!==""):[]};l?(await E(l.id,f),n.success("Resource updated successfully")):(await A(f),n.success("Resource added successfully")),h.invalidateQueries({queryKey:["admin","resources"]}),m()}catch(f){n.error(O(f,"Operation failed"))}finally{o(!1)}};return e.jsx(U,{isOpen:!0,onClose:c,title:l?"Edit Resource":"Add New Resource",size:"3xl",children:e.jsxs("form",{onSubmit:t,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"resource-title",children:"Title"}),e.jsx("input",{id:"resource-title",name:"title",defaultValue:l==null?void 0:l.title,className:"w-full rounded-lg border p-2.5",required:!0,placeholder:"e.g. Annual Strategic Report 2024"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"resource-category",children:"Category"}),e.jsx("select",{id:"resource-category",name:"category",defaultValue:(l==null?void 0:l.category)||R[0],className:"w-full rounded-lg border p-2.5",children:R.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"resource-fileType",children:"File Type"}),e.jsx("input",{id:"resource-fileType",name:"fileType",value:d?((N=d.name.split(".").pop())==null?void 0:N.toUpperCase())||"FILE":(l==null?void 0:l.fileType)||"PDF",className:"w-full rounded-lg border bg-gray-50 p-2.5",readOnly:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Automatically detected from file"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"resource-fileSize",children:"File Size"}),e.jsx("input",{id:"resource-fileSize",name:"fileSize",value:d?`${(d.size/(1024*1024)).toFixed(2)} MB`:(l==null?void 0:l.fileSize)||"",className:"w-full rounded-lg border bg-gray-50 p-2.5",placeholder:"Auto-filled from upload",readOnly:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Automatically calculated from file upload"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"resource-visibility",children:"Visibility"}),e.jsxs("select",{id:"resource-visibility",name:"isPublic",defaultValue:(l==null?void 0:l.isPublic)===!1?"false":"true",className:"w-full rounded-lg border p-2.5",children:[e.jsx("option",{value:"true",children:"Public"}),e.jsx("option",{value:"false",children:"Private (Internal Only)"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"resource-file-input",children:"Resource File"}),e.jsx("input",{type:"file",id:"resource-file-input",onChange:g,className:"w-full rounded-lg border p-2.5 text-sm",accept:".pdf,.doc,.docx,.xls,.xlsx"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Maximum size: 10MB. File type and size will be detected automatically."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"resource-downloadUrl",children:"Download URL"}),e.jsx("input",{id:"resource-downloadUrl",name:"downloadUrl",defaultValue:(l==null?void 0:l.downloadUrl)??"",className:"w-full rounded-lg border p-2.5",placeholder:"Or provide direct URL"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"resource-description",children:"Description"}),e.jsx("textarea",{id:"resource-description",name:"description",defaultValue:l==null?void 0:l.description,className:"h-20 w-full rounded-lg border p-2.5",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"resource-summary",children:"Summary"}),e.jsx("textarea",{id:"resource-summary",name:"summary",defaultValue:l==null?void 0:l.summary,className:"h-24 w-full rounded-lg border p-2.5"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"resource-keyPoints",className:"mb-1 block text-sm font-bold",children:"Key Points (comma separated)"}),e.jsx("input",{id:"resource-keyPoints",name:"keyPoints",defaultValue:(w=l==null?void 0:l.keyPoints)==null?void 0:w.join(", "),className:"w-full rounded-lg border p-2.5",placeholder:"e.g. Governance, Transparency, Impact"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(j,{type:"submit",fullWidth:!0,disabled:i,children:i?"Processing...":"Save Resource"}),e.jsx(j,{type:"button",variant:"secondary",fullWidth:!0,onClick:c,disabled:i,children:"Cancel"})]})]})})}function H(){const l=F(),[c,m]=b.useState(null),[h,i]=b.useState(!1),{data:o=[],isLoading:d}=P({queryKey:["admin","resources"],queryFn:async()=>{const t=await M();return I(t)}}),y=T({mutationFn:z,onSuccess:()=>{n.success("Resource deleted successfully"),l.invalidateQueries({queryKey:["admin","resources"]})},onError:()=>{n.error("Failed to delete resource")}}),g=async t=>{confirm("Are you sure you want to delete this resource?")&&y.mutate(t)};return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-wiria-blue-dark",children:"Resource Management"}),e.jsx(j,{onClick:()=>{m(null),i(!0)},children:"+ Add New Resource"})]}),e.jsx("div",{className:"overflow-hidden rounded-xl bg-white shadow",children:d?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx("div",{className:"mx-auto mb-2 h-8 w-8 animate-spin rounded-full border-4 border-gray-300 border-t-wiria-blue-dark"}),"Loading resources..."]}):e.jsxs("table",{className:"w-full border-collapse text-left",children:[e.jsx("thead",{className:"border-b bg-gray-50 text-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 font-semibold uppercase tracking-wider",children:"Title"}),e.jsx("th",{className:"px-6 py-4 font-semibold uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"px-6 py-4 font-semibold uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-4 font-semibold uppercase tracking-wider",children:"Public"}),e.jsx("th",{className:"px-6 py-4 font-semibold uppercase tracking-wider",children:"Downloads"}),e.jsx("th",{className:"px-6 py-4 text-right font-semibold uppercase tracking-wider",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y text-slate-600",children:[o.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 font-semibold text-slate-900",children:t.title}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"rounded bg-blue-50 px-2.5 py-1 text-xs font-bold uppercase text-blue-700",children:t.category})}),e.jsxs("td",{className:"px-6 py-4 text-sm font-medium",children:[t.fileType," (",t.fileSize,")"]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`rounded-full px-2.5 py-0.5 text-xs font-bold ${t.isPublic?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:t.isPublic?"Yes":"No"})}),e.jsx("td",{className:"px-6 py-4 text-sm font-medium",children:t.downloads||0}),e.jsxs("td",{className:"px-6 py-4 text-right",children:[e.jsx("button",{onClick:()=>{m(t),i(!0)},className:"mr-4 text-sm font-bold text-wiria-blue-dark hover:text-blue-800 transition-colors",children:"Edit"}),e.jsx("button",{onClick:()=>g(t.id),className:"text-sm font-bold text-red-600 hover:text-red-800 transition-colors",children:"Delete"})]})]},t.id)),o.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500",children:[e.jsx("div",{className:"mb-2 text-4xl opacity-20",children:"ðŸ“"}),"No resources available."]})})]})]})}),h&&e.jsx(D,{resource:c,onClose:()=>i(!1),onSuccess:()=>i(!1)})]})}export{H as default};
//# sourceMappingURL=ResourceManagementPage-DpblT92b.js.map
