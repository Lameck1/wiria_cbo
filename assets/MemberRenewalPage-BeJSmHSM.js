import{j as e}from"./query-vendor-CM55eWOT.js";import{u as U,P}from"./useMemberData-BdepG6Fx.js";import{C as h,a as u}from"./Card-C-jJKiAv.js";import{B as w}from"./Button-JX_3oChN.js";import{d as C,A as E,n as f,f as K,g as O,h as F,i as W,C as _,I as G,F as M,j as B}from"./index-Ck6qqv4n.js";import{r as g,c as H}from"./react-vendor-CXp26_Hx.js";import{b as V,c as z,P as Y,a as $}from"./PaymentInstructions-W5hntrkW.js";import{a as q}from"./validation-B2dPSVKP.js";import{m as j,A as T}from"./animation-vendor-Bcu85ETC.js";function Q(){const[t,a]=g.useState(!1),[r,o]=g.useState(null),[m,p]=g.useState(null);return{submitRenewal:async l=>{a(!0),o(null),p(null);try{const n=await C.post(E.MEMBERS_RENEW,l),{checkoutRequestId:c,message:N}=n;return l.paymentMethod==="STK_PUSH"&&c?(p(c),o("PENDING"),f.info("STK push sent to your phone. Please complete the payment.")):l.paymentMethod==="MANUAL"?(o("PENDING"),f.success("Transaction submitted for verification.")):(o("SUCCESS"),f.success(N||"Renewal successful!")),{success:!0}}catch{return f.error("Renewal failed. Please try again."),{success:!1}}finally{a(!1)}},checkPaymentStatus:async l=>{try{const n=await C.get(`${E.PAYMENTS_STATUS}/${l}`),{status:c}=n.data;return c==="COMPLETED"?(o("SUCCESS"),"SUCCESS"):c==="FAILED"?(o("FAILED"),"FAILED"):"PENDING"}catch{return"PENDING"}},isSubmitting:t,paymentStatus:r,transactionId:m}}function J({onNavigate:t}){const a=H(),r=()=>{t?t():a("/member-portal")};return e.jsx("div",{className:"mx-auto max-w-2xl py-12",children:e.jsx(h,{className:"border-none bg-gradient-to-b from-white to-blue-50/30 p-12 text-center shadow-2xl",children:e.jsxs(u,{children:[e.jsx("div",{className:"mx-auto mb-8 flex h-24 w-24 items-center justify-center rounded-full bg-green-100 shadow-inner",children:e.jsx("svg",{className:"h-12 w-12 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),e.jsx("h2",{className:"mb-4 text-3xl font-bold text-gray-900",children:"Renewal Complete!"}),e.jsx("p",{className:"mb-10 text-lg leading-relaxed text-gray-600",children:"Thank you for renewing your WIRIA membership. Your account has been updated successfully."}),e.jsx(w,{size:"lg",className:"h-14 px-12 text-lg shadow-lg",onClick:r,children:"Return to Dashboard"})]})})})}function X({paymentMethod:t,isSubmitting:a,onRefresh:r}){return e.jsx(j.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"py-16 text-center",children:e.jsx(h,{className:"mx-auto max-w-md border-none p-12 shadow-2xl",children:e.jsxs(u,{children:[e.jsxs("div",{className:"relative mb-10",children:[e.jsx("div",{className:"mx-auto h-24 w-24 animate-spin rounded-full border-4 border-blue-100 border-t-wiria-blue-dark",role:"progressbar","aria-label":"Processing payment"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center font-bold text-wiria-blue-dark",children:t==="STK_PUSH"?"SMS":"Wait"})]}),e.jsx("h3",{className:"mb-4 text-2xl font-bold text-gray-900",children:"Processing Renewal"}),e.jsx("p",{className:"mb-8 text-gray-600",children:t==="STK_PUSH"?"Please complete the payment on your phone by entering your M-Pesa PIN.":"We are verifying your transaction. This may take a few moments."}),e.jsx(w,{variant:"outline",fullWidth:!0,size:"lg",onClick:r,disabled:a,children:"Refresh Status"})]})})},"pending")}function Z({membershipType:t,expiresAt:a,daysUntilExpiry:r}){return e.jsxs(h,{className:"overflow-hidden border-none shadow-md",children:[e.jsx("div",{className:"h-1 bg-wiria-blue-dark","aria-hidden":"true"}),e.jsxs(u,{children:[e.jsx("h3",{className:"mb-4 text-sm font-bold uppercase tracking-wider text-gray-500",children:"Membership Status"}),e.jsxs("dl",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("dt",{className:"text-gray-600",children:"Member Type"}),e.jsx("dd",{className:"rounded-full bg-blue-50 px-3 py-1 text-xs font-bold text-blue-700",children:t||"INDIVIDUAL"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("dt",{className:"text-gray-600",children:"Expires On"}),e.jsx("dd",{className:"font-bold text-gray-900",children:a?new Date(a).toLocaleDateString():"--"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("dt",{className:"text-gray-600",children:"Days Remaining"}),e.jsx("dd",{className:`font-mono font-bold ${r!=null&&r<=30?"text-red-500":"text-green-600"}`,children:r??"--"})]})]})]})]})}function ee({total:t}){return e.jsxs("div",{className:"relative flex flex-col justify-center overflow-hidden rounded-2xl bg-gradient-to-br from-wiria-blue-dark to-blue-900 p-8 text-white shadow-xl",children:[e.jsx("div",{className:"absolute right-0 top-0 h-32 w-32 -translate-x-1/2 -translate-y-1/2 rounded-full bg-white/5","aria-hidden":"true"}),e.jsx("p",{className:"mb-2 text-sm font-bold uppercase tracking-widest text-blue-100",children:"Total Amount Due"}),e.jsxs("p",{className:"mb-2 text-5xl font-bold","aria-live":"polite",children:["KES ",t.toLocaleString()]}),e.jsx("p",{className:"text-xs italic text-blue-200",children:"Renewal for the next 12 months"})]})}function de(){K();const{profile:t,fetchProfile:a,daysUntilExpiry:r}=U(),o=(t==null?void 0:t.membershipType)==="GROUP",m=O({resolver:F(q),defaultValues:{paymentMethod:"STK_PUSH",memberCount:1,phoneNumber:"",transactionCode:"",agreedToDataProtection:!1,agreedToCodeOfEthics:!1}}),{handleSubmit:p,watch:x,setValue:b,formState:{errors:l}}=m,n=x("paymentMethod"),c=x("memberCount")||1,N=x("agreedToDataProtection"),R=x("agreedToCodeOfEthics"),I=x("transactionCode");g.useEffect(()=>{a()},[a]),g.useEffect(()=>{t&&(b("memberCount",t.currentMemberCount||1),b("phoneNumber",t.phone||""))},[t,b]);const{submitRenewal:k,checkPaymentStatus:D,isSubmitting:d,paymentStatus:y,transactionId:S}=Q();V({donationId:S,isActive:!!S&&y==="PENDING",onStatusCheck:D});const v=(t==null?void 0:t.maxMemberCountReached)||(t==null?void 0:t.currentMemberCount)||0,s=z({membershipType:o?"GROUP":"INDIVIDUAL",memberCount:c,maxCount:v}),L=async i=>{await k({paymentMethod:i.paymentMethod,phoneNumber:B(i.phoneNumber||""),transactionCode:i.paymentMethod==="MANUAL"?i.transactionCode:void 0,memberCount:o?i.memberCount:void 0,amount:s.total})},A=!N||!R||n==="MANUAL"&&!I;return y==="SUCCESS"?e.jsx(P,{title:"Renewal Successful",children:e.jsx(J,{})}):e.jsx(P,{title:"Renew Membership",children:e.jsx(W,{...m,children:e.jsx("div",{className:"mx-auto max-w-4xl px-4 py-8",children:e.jsx(T,{mode:"wait",children:y==="PENDING"?e.jsx(X,{paymentMethod:n,isSubmitting:d,onRefresh:()=>window.location.reload()}):e.jsxs(j.div,{initial:{opacity:0},animate:{opacity:1},children:[e.jsxs("div",{className:"mb-8 grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsx(Z,{membershipType:(t==null?void 0:t.membershipType)||"INDIVIDUAL",expiresAt:t==null?void 0:t.membershipExpiresAt,daysUntilExpiry:r}),e.jsx(ee,{total:s.total})]}),e.jsxs("form",{onSubmit:p(L),className:"space-y-8",children:[e.jsx(T,{children:o&&e.jsx(j.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},className:"mb-6 overflow-hidden",children:e.jsx(h,{className:"border-blue-100 bg-blue-50/30",children:e.jsx(u,{children:e.jsxs("div",{className:"flex flex-col justify-between gap-6 md:flex-row md:items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-1 text-lg font-bold text-blue-900",children:"Group Member Count"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Update your group size to include new members."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col items-end text-right",children:[e.jsx("span",{className:"text-xs font-bold uppercase text-gray-500",children:"Last Recorded"}),e.jsx("span",{className:"font-mono text-xl font-bold text-gray-800",children:v})]}),e.jsx("div",{className:"h-10 w-px bg-blue-200"}),e.jsx("div",{className:"w-32 text-center",children:e.jsx(_,{name:"memberCount",render:({field:i})=>e.jsx(G,{...i,type:"number",className:"h-12 text-center text-xl font-bold",min:1})})})]})]})})})})}),e.jsx("div",{className:"mb-8",children:e.jsx(h,{className:"border-2 border-gray-100 bg-gray-50",children:e.jsxs(u,{children:[e.jsxs("h3",{className:"mb-6 flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-gray-900",children:[e.jsx("svg",{className:"h-4 w-4 text-wiria-blue-dark",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),"Fee Breakdown"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-dashed border-gray-200 py-2",children:[e.jsxs("div",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Subscription Renewal"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.renewal.count," ",s.renewal.count===1?"member":"members"," × KES"," ",s.renewal.rate.toLocaleString()]})]}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["KES ",s.renewal.subtotal.toLocaleString()]})]}),s.newRegistration.count>0&&e.jsxs("div",{className:"flex items-center justify-between border-b border-dashed border-gray-200 py-2",children:[e.jsxs("div",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium text-blue-700",children:"Incremental Registration"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.newRegistration.count," new"," ",s.newRegistration.count===1?"member":"members"," × KES ",s.newRegistration.rate.toLocaleString()]})]}),e.jsxs("span",{className:"font-bold text-blue-700",children:["KES ",s.newRegistration.subtotal.toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsx("span",{className:"text-lg font-bold text-gray-900",children:"Total Due"}),e.jsxs(j.span,{initial:{scale:1.1,color:"#1e40af"},animate:{scale:1,color:"#1e3a8a"},className:"font-mono text-2xl font-bold text-wiria-blue-dark",children:["KES ",s.total.toLocaleString()]},s.total)]})]})]})})}),e.jsx(h,{className:"border-none shadow-lg",children:e.jsxs(u,{className:"p-8",children:[e.jsx("h2",{className:"mb-8 text-2xl font-bold text-wiria-blue-dark",children:"Payment Details"}),e.jsxs("div",{className:"mb-8 grid grid-cols-1 gap-8 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"mb-3 block text-sm font-bold text-gray-700",children:"Payment Method"}),e.jsx(Y,{selected:n,onChange:i=>b("paymentMethod",i),disabled:d})]}),e.jsx("div",{children:n==="STK_PUSH"?e.jsx(M,{name:"phoneNumber",label:"M-Pesa Phone Number",type:"tel",placeholder:"254700000000",description:"You'll receive a prompt on your phone",disabled:d}):e.jsx(M,{name:"transactionCode",label:"Transaction Code",placeholder:"e.g. QWE123RTY",description:"Enter the code from the M-Pesa SMS",disabled:d})})]}),e.jsx("div",{className:"mb-8 rounded-2xl bg-gray-50 p-6",children:e.jsx($,{paymentMethod:n,amount:s.total,submitLabel:"Complete Renewal",accountNumber:"MEMBERSHIP_RENEW"})}),e.jsxs("div",{className:"mb-8 space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",id:"agreedToDataProtection",...m.register("agreedToDataProtection"),className:"mt-1 h-5 w-5 rounded border-gray-300 text-wiria-blue-dark focus:ring-wiria-blue-dark",disabled:d}),e.jsx("label",{htmlFor:"agreedToDataProtection",className:"text-sm leading-tight text-gray-700",children:"I consent to the processing of my personal data under the Data Protection Policy. *"})]}),l.agreedToDataProtection&&e.jsx("p",{className:"text-xs text-red-500 ml-8",children:l.agreedToDataProtection.message}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",id:"agreedToCodeOfEthics",...m.register("agreedToCodeOfEthics"),className:"mt-1 h-5 w-5 rounded border-gray-300 text-wiria-blue-dark focus:ring-wiria-blue-dark",disabled:d}),e.jsx("label",{htmlFor:"agreedToCodeOfEthics",className:"text-sm leading-tight text-gray-700",children:"I agree to abide by the WIRIA Code of Ethics and Conduct. *"})]}),l.agreedToCodeOfEthics&&e.jsx("p",{className:"text-xs text-red-500 ml-8",children:l.agreedToCodeOfEthics.message})]}),e.jsxs(w,{type:"submit",fullWidth:!0,size:"lg",isLoading:d,disabled:A,className:"h-14 text-lg shadow-xl",children:["Complete Renewal • KES ",s.total.toLocaleString()]})]})})]})]},"form")})})})})}export{de as default};
//# sourceMappingURL=MemberRenewalPage-BeJSmHSM.js.map
