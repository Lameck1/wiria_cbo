import{j as e}from"./query-vendor-CM55eWOT.js";import{r as f}from"./react-vendor-CXp26_Hx.js";import{d as l,U as u,n as b}from"./index-Ck6qqv4n.js";import{B as p}from"./Button-JX_3oChN.js";import{u as N,a as y,D as j}from"./useAdminData-91Z-y-lf.js";import{M as C}from"./Modal-BGjbfc1U.js";import{g as E}from"./apiUtils-0UX-zM9U.js";import{A as S}from"./AdminPageHeader-BTeP1u2j.js";import{S as h}from"./StatusBadge-DxoyjbSs.js";import{f as D}from"./dateUtils-CLm2GaNA.js";import{C as U,a as M}from"./Card-C-jJKiAv.js";import"./animation-vendor-Bcu85ETC.js";const T=async()=>l.get("/admin/users"),P=async t=>l.post("/admin/users/invite",t),V=async(t="PENDING")=>l.get(`/admin/users/invitations?status=${t}`),L=async t=>l.delete(`/admin/users/invitations/${t}`),$=async(t,r)=>l.patch(`/admin/users/${t}/status`,{status:r});function X(){const[t,r]=f.useState("ACTIVE"),[a,i]=f.useState(!1),{items:g,isLoading:d}=N(["users"],T,{enabled:t==="ACTIVE"}),{items:n,isLoading:c}=N(["invitations"],V,{enabled:t==="PENDING"}),x=y(({email:s,status:o})=>$(s,o),[["users"]],{successMessage:"User status updated"}),m=y(s=>L(s),[["invitations"]],{successMessage:"Invitation cancelled"}),k=async(s,o)=>{const v=o==="ACTIVE"?"SUSPENDED":"ACTIVE";confirm(`Are you sure you want to change status to ${v}?`)&&x.mutate({email:s,status:v})},w=async s=>{confirm("Cancel this invitation?")&&m.mutate(s)},I=[{header:"User",key:"name",render:s=>e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:`${s.firstName} ${s.lastName}`}),e.jsx("div",{className:"text-xs text-gray-500",children:s.email})]})},{header:"Role",key:"role",render:s=>e.jsx(h,{status:s.role})},{header:"Status",key:"status",render:s=>e.jsx(h,{status:s.status})},{header:"Actions",key:"actions",align:"right",render:s=>e.jsx("button",{onClick:()=>k(s.email,s.status),className:`text-sm font-bold transition-colors hover:underline ${s.status==="ACTIVE"?"text-red-500 hover:text-red-700":"text-green-600 hover:text-green-800"}`,children:s.status==="ACTIVE"?"Deactivate":"Activate"})}],A=[{header:"Email",key:"email",className:"font-medium"},{header:"Role",key:"role",render:s=>e.jsx(h,{status:s.role})},{header:"Invited By",key:"inviter",render:s=>{var o;return((o=s.inviter)==null?void 0:o.email)||"N/A"}},{header:"Expires",key:"expiresAt",render:s=>e.jsx("span",{className:"text-sm",children:D(s.expiresAt)})},{header:"Actions",key:"actions",align:"right",render:s=>e.jsx("button",{onClick:()=>w(s.id),className:"text-sm font-bold text-red-500 transition-colors hover:text-red-700 hover:underline",children:"Cancel"})}];return e.jsxs("div",{className:"space-y-8",children:[e.jsx(S,{title:"User Management",description:"Manage system administrators and staff invitations.",children:e.jsx(p,{onClick:()=>i(!0),children:"+ Invite User"})}),e.jsx(U,{className:"overflow-hidden border-none shadow-sm",children:e.jsxs(M,{className:"p-0",children:[e.jsxs("div",{className:"flex border-b bg-gray-50/50",children:[e.jsx("button",{className:`px-8 py-4 text-sm font-bold transition-all ${t==="ACTIVE"?"border-b-2 border-wiria-blue-dark bg-white text-wiria-blue-dark":"text-gray-500 hover:bg-gray-100/50 hover:text-gray-700"}`,onClick:()=>r("ACTIVE"),children:"Active Users"}),e.jsx("button",{className:`px-8 py-4 text-sm font-bold transition-all ${t==="PENDING"?"border-b-2 border-wiria-blue-dark bg-white text-wiria-blue-dark":"text-gray-500 hover:bg-gray-100/50 hover:text-gray-700"}`,onClick:()=>r("PENDING"),children:"Pending Invitations"})]}),t==="ACTIVE"?e.jsx(j,{columns:I,data:g,isLoading:d,rowKey:"id",emptyMessage:"No active users found.",className:"rounded-none border-none shadow-none"}):e.jsx(j,{columns:A,data:n,isLoading:c,rowKey:"id",emptyMessage:"No pending invitations.",className:"rounded-none border-none shadow-none"})]})}),a&&e.jsx(F,{onClose:()=>i(!1),onSuccess:()=>{i(!1),r("PENDING")}})]})}function F({onClose:t,onSuccess:r}){const[a,i]=f.useState(!1),g=async d=>{d.preventDefault(),i(!0);const n=new FormData(d.currentTarget),c={email:n.get("email"),role:n.get("role"),firstName:n.get("firstName"),lastName:n.get("lastName")};try{await P(c),b.success(`Invitation sent to ${c.email}`),r()}catch(x){const m=E(x,"Failed to send invitation");m.includes("session is no longer valid")?b.error("Session expired: Please log out and back in."):b.error(m)}finally{i(!1)}};return e.jsx(C,{isOpen:!0,onClose:t,title:"Invite New User",size:"2xl",children:e.jsxs("form",{onSubmit:g,className:"space-y-6 p-2",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"mb-1.5 block text-xs font-bold uppercase tracking-wider text-gray-500",htmlFor:"invite-email",children:"Email Address *"}),e.jsx("input",{id:"invite-email",name:"email",type:"email",required:!0,placeholder:"e.g. staff@wiria.org",className:"w-full rounded-xl border-gray-200 bg-gray-50 p-3 outline-none focus:border-wiria-blue-dark focus:ring-2 focus:ring-wiria-blue-dark/20 transition-all",disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-xs font-bold uppercase tracking-wider text-gray-500",htmlFor:"invite-firstName",children:"First Name"}),e.jsx("input",{id:"invite-firstName",name:"firstName",placeholder:"e.g. Jane",className:"w-full rounded-xl border-gray-200 bg-gray-50 p-3 outline-none focus:border-wiria-blue-dark focus:ring-2 focus:ring-wiria-blue-dark/20 transition-all",disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-xs font-bold uppercase tracking-wider text-gray-500",htmlFor:"invite-lastName",children:"Last Name"}),e.jsx("input",{id:"invite-lastName",name:"lastName",placeholder:"e.g. Doe",className:"w-full rounded-xl border-gray-200 bg-gray-50 p-3 outline-none focus:border-wiria-blue-dark focus:ring-2 focus:ring-wiria-blue-dark/20 transition-all",disabled:a})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"mb-1.5 block text-xs font-bold uppercase tracking-wider text-gray-500",htmlFor:"invite-role",children:"System Role *"}),e.jsxs("select",{id:"invite-role",name:"role",required:!0,className:"w-full rounded-xl border-gray-200 bg-gray-50 p-3 outline-none focus:border-wiria-blue-dark focus:ring-2 focus:ring-wiria-blue-dark/20 transition-all appearance-none",disabled:a,children:[e.jsx("option",{value:"",children:"Select a role..."}),e.jsx("option",{value:u.STAFF,children:"Staff Member"}),e.jsx("option",{value:u.ADMIN,children:"Administrator"}),e.jsx("option",{value:u.VOLUNTEER,children:"Volunteer Coordinator"}),e.jsx("option",{value:u.SUPER_ADMIN,children:"Super Administrator"})]})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(p,{type:"submit",fullWidth:!0,isLoading:a,className:"h-12 text-lg",children:"Send Invitation"}),e.jsx(p,{type:"button",variant:"outline",fullWidth:!0,onClick:t,disabled:a,className:"h-12 text-lg",children:"Cancel"})]})]})})}export{X as default};
//# sourceMappingURL=UserManagementPage-DWnwY8k3.js.map
