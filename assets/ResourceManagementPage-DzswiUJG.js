import{b as f,j as e,u as g,c as j}from"./query-vendor-frBnvHSF.js";import{r as x}from"./react-vendor-BdaLayic.js";import{u as N,a as w,c as R,d as S,g as v}from"./resources.api-2-mmWAeK.js";import{F as C}from"./FormModal-t6sCIWsd.js";import{n as d}from"./index-ICA0O2oL.js";import{g as F,a as P}from"./apiUtils-CDDJc0SC.js";import{C as T}from"./ConfirmDialog-BLp-gmhy.js";import{B as k}from"./Button-K8iFFe9S.js";import"./Input-1n81zAKh.js";import"./helpers-Brneqz2V.js";import"./Modal-D8P6KMMh.js";import"./animation-vendor-CrU7SSpu.js";import"./Select-xLPpYUY_.js";import"./Textarea-Bn66OGKX.js";const E=["GOVERNANCE","STRATEGIC","FINANCIAL","REPORTS","POLICIES","PUBLICATIONS","OTHER"];function A(a){var o;const{selectedFile:n,resource:l}=a;return[{name:"title",label:"Title",type:"text",required:!0,placeholder:"e.g. Annual Strategic Report 2024"},{name:"category",label:"Category",type:"select",required:!0,options:E.map(i=>({value:i,label:i}))},{name:"fileType",label:"File Type",type:"text",placeholder:"Automatically detected from file",defaultValue:n?((o=n.name.split(".").pop())==null?void 0:o.toUpperCase())??"FILE":(l==null?void 0:l.fileType)??"PDF"},{name:"fileSize",label:"File Size",type:"text",placeholder:"Auto-filled from upload",defaultValue:n?`${(n.size/(1024*1024)).toFixed(2)} MB`:(l==null?void 0:l.fileSize)??""},{name:"isPublic",label:"Visibility",type:"select",required:!0,options:[{value:"true",label:"Public"},{value:"false",label:"Private (Internal Only)"}],defaultValue:(l==null?void 0:l.isPublic)===!1?"false":"true"},{name:"downloadUrl",label:"Download URL",type:"text",placeholder:"Or provide direct URL"},{name:"description",label:"Description",type:"textarea",required:!0,rows:3},{name:"summary",label:"Summary",type:"textarea",rows:4},{name:"keyPoints",label:"Key Points (comma separated)",type:"text",placeholder:"e.g. Governance, Transparency, Impact"}]}function I({resource:a,onClose:n,onSuccess:l}){const o=f(),[i,c]=x.useState(null),u=t=>{var s;const r=(s=t.target.files)==null?void 0:s[0];c(r??null)},p=async t=>{var h;let r=t.downloadUrl||"";i&&(d.info("Uploading file..."),r=(await N(i,"resources")).data.url,t.fileSize??(t.fileSize=`${(i.size/(1024*1024)).toFixed(2)} MB`),t.fileType??(t.fileType=((h=i.name.split(".").pop())==null?void 0:h.toUpperCase())??"FILE"));const s={title:t.title||"",category:t.category||"",fileType:t.fileType||"",fileSize:t.fileSize||"",description:t.description||"",summary:t.summary,downloadUrl:r,isPublic:t.isPublic==="true",keyPoints:t.keyPoints?t.keyPoints.split(",").map(m=>m.trim()).filter(m=>m!==""):[]};a?(await w(a.id,s),d.success("Resource updated successfully")):(await R(s),d.success("Resource added successfully")),o.invalidateQueries({queryKey:["admin","resources"]}),l()},y=async t=>{try{await p(t)}catch(r){throw d.error(F(r,"Operation failed")),r}},b=A({selectedFile:i,resource:a});return e.jsx(C,{isOpen:!0,onClose:n,onSubmit:y,title:a?"Edit Resource":"Add New Resource",fields:b,initialData:a?{...a}:void 0,submitLabel:"Save Resource",children:e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"resource-file-input",children:"Resource File"}),e.jsx("input",{type:"file",id:"resource-file-input",onChange:u,className:"w-full rounded-lg border p-2.5 text-sm",accept:".pdf,.doc,.docx,.xls,.xlsx"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Maximum size: 10MB. File type and size will be detected automatically."})]})})}function J(){const a=f(),[n,l]=x.useState(null),[o,i]=x.useState(!1),[c,u]=x.useState(null),{data:p=[],isLoading:y}=g({queryKey:["admin","resources"],queryFn:async()=>{const s=await v();return P(s)}}),b=j({mutationFn:S,onSuccess:()=>{d.success("Resource deleted successfully"),a.invalidateQueries({queryKey:["admin","resources"]})},onError:()=>{d.error("Failed to delete resource")}}),t=s=>{u(s)},r=()=>{c&&(b.mutate(c),u(null))};return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-wiria-blue-dark",children:"Resource Management"}),e.jsx(k,{onClick:()=>{l(null),i(!0)},children:"+ Add New Resource"})]}),e.jsx("div",{className:"overflow-hidden rounded-xl bg-white shadow",children:y?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx("div",{className:"mx-auto mb-2 h-8 w-8 animate-spin rounded-full border-4 border-gray-300 border-t-wiria-blue-dark"}),"Loading resources..."]}):e.jsxs("table",{className:"w-full border-collapse text-left",children:[e.jsx("thead",{className:"border-b bg-gray-50 text-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 font-semibold uppercase tracking-wider",children:"Title"}),e.jsx("th",{className:"px-6 py-4 font-semibold uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"px-6 py-4 font-semibold uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-4 font-semibold uppercase tracking-wider",children:"Public"}),e.jsx("th",{className:"px-6 py-4 font-semibold uppercase tracking-wider",children:"Downloads"}),e.jsx("th",{className:"px-6 py-4 text-right font-semibold uppercase tracking-wider",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y text-slate-600",children:[p.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 font-semibold text-slate-900",children:s.title}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"rounded bg-blue-50 px-2.5 py-1 text-xs font-bold uppercase text-blue-700",children:s.category})}),e.jsxs("td",{className:"px-6 py-4 text-sm font-medium",children:[s.fileType," (",s.fileSize,")"]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`rounded-full px-2.5 py-0.5 text-xs font-bold ${s.isPublic?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:s.isPublic?"Yes":"No"})}),e.jsx("td",{className:"px-6 py-4 text-sm font-medium",children:s.downloads||0}),e.jsxs("td",{className:"px-6 py-4 text-right",children:[e.jsx("button",{onClick:()=>{l(s),i(!0)},className:"mr-4 text-sm font-bold text-wiria-blue-dark transition-colors hover:text-blue-800",children:"Edit"}),e.jsx("button",{onClick:()=>void t(s.id),className:"text-sm font-bold text-red-600 transition-colors hover:text-red-800",children:"Delete"})]})]},s.id)),p.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500",children:[e.jsx("div",{className:"mb-2 text-4xl opacity-20",children:"ðŸ“"}),"No resources available."]})})]})]})}),o&&e.jsx(I,{resource:n,onClose:()=>i(!1),onSuccess:()=>i(!1)}),e.jsx(T,{isOpen:c!==null,title:"Delete Resource",message:"Are you sure you want to delete this resource?",confirmLabel:"Delete",onConfirm:r,onCancel:()=>u(null)})]})}export{J as default};
//# sourceMappingURL=ResourceManagementPage-DzswiUJG.js.map
