import{j as e}from"./query-vendor-DD8i-cqI.js";import{u as H,P as T}from"./useMemberData-pYLhKl2B.js";import{C as x,a as u}from"./Card-DWj3lHLM.js";import{B as S}from"./Button-C0mZ-O15.js";import{I as v}from"./Input-DK9Eiz8R.js";import{u as F,P as z,a as V}from"./PaymentInstructions-C1MXf34f.js";import{a as L,A,n as p,b as Y,f as $}from"./index-D1ZUH7bO.js";import{r,u as q}from"./react-vendor-CPrm261X.js";import{A as U,m as g}from"./animation-vendor-DKvKsx_2.js";function Q(){const[f,t]=r.useState(!1),[b,l]=r.useState(null),[o,i]=r.useState(null);return{submitRenewal:async c=>{t(!0),l(null),i(null);try{const a=await L.post(A.MEMBERS_RENEW,c),{checkoutRequestId:d,message:h}=a;return c.paymentMethod==="STK_PUSH"&&d?(i(d),l("PENDING"),p.info("STK push sent to your phone. Please complete the payment.")):c.paymentMethod==="MANUAL"?(l("PENDING"),p.success("Transaction submitted for verification.")):(l("SUCCESS"),p.success(h||"Renewal successful!")),{success:!0}}catch{return p.error("Renewal failed. Please try again."),{success:!1}}finally{t(!1)}},checkPaymentStatus:async c=>{try{const a=await L.get(`${A.PAYMENTS_STATUS}/${c}`),{status:d}=a.data;return d==="COMPLETED"?(l("SUCCESS"),"SUCCESS"):d==="FAILED"?(l("FAILED"),"FAILED"):"PENDING"}catch{return"PENDING"}},isSubmitting:f,paymentStatus:b,transactionId:o}}const J=1e3,X=500,Z=500,ee=250;function de(){const f=q();Y();const{profile:t,fetchProfile:b,daysUntilExpiry:l}=H(),o=(t==null?void 0:t.membershipType)==="GROUP",[i,j]=r.useState(1),[N,c]=r.useState(""),[a,d]=r.useState("STK_PUSH"),[h,_]=r.useState(""),[P,G]=r.useState(!1),[C,K]=r.useState(!1);r.useEffect(()=>{b()},[b]),r.useEffect(()=>{t&&(j(t.currentMemberCount||1),c(t.phone||""))},[t]);const{submitRenewal:B,checkPaymentStatus:W,isSubmitting:m,paymentStatus:y,transactionId:E}=Q();F({donationId:E,isActive:!!E&&y==="PENDING",onStatusCheck:W});const w=(t==null?void 0:t.maxMemberCountReached)||(t==null?void 0:t.currentMemberCount)||0,s=r.useMemo(()=>{const n=o?Z:J,R=o?ee:X,M=o?i:1,k=o?Math.max(0,i-w):0,I=M*n,D=k*R;return{renewal:{count:M,rate:n,subtotal:I},newRegistration:{count:k,rate:R,subtotal:D},total:I+D}},[i,w,o]),O=async n=>{n.preventDefault(),await B({paymentMethod:a,phoneNumber:$(N),transactionCode:a==="MANUAL"?h:void 0,memberCount:o?i:void 0,amount:s.total})};return y==="SUCCESS"?e.jsx(T,{title:"Renewal Successful",children:e.jsx("div",{className:"max-w-2xl mx-auto py-12",children:e.jsx(x,{className:"text-center p-12 border-none shadow-2xl bg-gradient-to-b from-white to-blue-50/30",children:e.jsxs(u,{children:[e.jsx("div",{className:"w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-8 shadow-inner",children:e.jsx("svg",{className:"w-12 h-12 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Renewal Complete!"}),e.jsx("p",{className:"text-lg text-gray-600 mb-10 leading-relaxed",children:"Thank you for renewing your WIRIA membership. Your account has been updated successfully."}),e.jsx(S,{size:"lg",className:"px-12 h-14 text-lg shadow-lg",onClick:()=>f("/member-portal"),children:"Return to Dashboard"})]})})})}):e.jsx(T,{title:"Renew Membership",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsx(U,{mode:"wait",children:y==="PENDING"?e.jsx(g.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"text-center py-16",children:e.jsx(x,{className:"max-w-md mx-auto p-12 border-none shadow-2xl",children:e.jsxs(u,{children:[e.jsxs("div",{className:"relative mb-10",children:[e.jsx("div",{className:"w-24 h-24 border-4 border-blue-100 border-t-wiria-blue-dark rounded-full animate-spin mx-auto"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-wiria-blue-dark font-bold",children:a==="STK_PUSH"?"SMS":"Wait"})]}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Processing Renewal"}),e.jsx("p",{className:"text-gray-600 mb-8",children:a==="STK_PUSH"?"Please complete the payment on your phone by entering your M-Pesa PIN.":"We are verifying your transaction. This may take a few moments."}),e.jsx(S,{variant:"outline",fullWidth:!0,size:"lg",onClick:()=>window.location.reload(),disabled:m,children:"Refresh Status"})]})})},"pending"):e.jsxs(g.div,{initial:{opacity:0},animate:{opacity:1},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsxs(x,{className:"border-none shadow-md overflow-hidden",children:[e.jsx("div",{className:"h-1 bg-wiria-blue-dark"}),e.jsxs(u,{children:[e.jsx("h3",{className:"text-sm font-bold text-gray-500 uppercase tracking-wider mb-4",children:"Membership Status"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Member Type"}),e.jsx("span",{className:"font-bold bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-xs",children:(t==null?void 0:t.membershipType)||"INDIVIDUAL"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Expires On"}),e.jsx("span",{className:"font-bold text-gray-900",children:t!=null&&t.membershipExpiresAt?new Date(t.membershipExpiresAt).toLocaleDateString():"--"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Days Remaining"}),e.jsx("span",{className:`font-mono font-bold ${l&&l<=30?"text-red-500":"text-green-600"}`,children:l??"--"})]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-wiria-blue-dark to-blue-900 text-white p-8 rounded-2xl shadow-xl flex flex-col justify-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full -translate-x-1/2 -translate-y-1/2"}),e.jsx("p",{className:"text-blue-100 text-sm font-bold uppercase tracking-widest mb-2",children:"Total Amount Due"}),e.jsxs("p",{className:"text-5xl font-bold mb-2",children:["KES ",s.total.toLocaleString()]}),e.jsx("p",{className:"text-blue-200 text-xs italic",children:"Renewal for the next 12 months"})]})]}),e.jsxs("form",{onSubmit:O,className:"space-y-8",children:[e.jsx(U,{children:o&&e.jsx(g.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},className:"mb-6 overflow-hidden",children:e.jsx(x,{className:"border-blue-100 bg-blue-50/30",children:e.jsx(u,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-blue-900 mb-1",children:"Group Member Count"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Update your group size to include new members."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right flex flex-col items-end",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase font-bold",children:"Last Recorded"}),e.jsx("span",{className:"text-xl font-mono font-bold text-gray-800",children:w})]}),e.jsx("div",{className:"w-px h-10 bg-blue-200"}),e.jsx("div",{className:"w-32",children:e.jsx(v,{type:"number",min:1,value:i,onChange:n=>j(Math.max(1,parseInt(n.target.value)||0)),className:"text-center font-bold text-xl h-12"})})]})]})})})})}),e.jsx("div",{className:"mb-8",children:e.jsx(x,{className:"bg-gray-50 border-gray-100 border-2",children:e.jsxs(u,{children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-900 uppercase tracking-wider mb-6 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-wiria-blue-dark",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),"Fee Breakdown"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-200 border-dashed",children:[e.jsxs("div",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Subscription Renewal"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.renewal.count," ",s.renewal.count===1?"member":"members"," × KES ",s.renewal.rate.toLocaleString()]})]}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["KES ",s.renewal.subtotal.toLocaleString()]})]}),s.newRegistration.count>0&&e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-200 border-dashed",children:[e.jsxs("div",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium text-blue-700",children:"Incremental Registration"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.newRegistration.count," new ",s.newRegistration.count===1?"member":"members"," × KES ",s.newRegistration.rate.toLocaleString()]})]}),e.jsxs("span",{className:"font-bold text-blue-700",children:["KES ",s.newRegistration.subtotal.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2",children:[e.jsx("span",{className:"text-lg font-bold text-gray-900",children:"Total Due"}),e.jsxs(g.span,{initial:{scale:1.1,color:"#1e40af"},animate:{scale:1,color:"#1e3a8a"},className:"text-2xl font-bold text-wiria-blue-dark font-mono",children:["KES ",s.total.toLocaleString()]},s.total)]})]})]})})}),e.jsx(x,{className:"shadow-lg border-none",children:e.jsxs(u,{className:"p-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-wiria-blue-dark mb-8",children:"Payment Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mb-8",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-3",children:"Payment Method"}),e.jsx(z,{selected:a,onChange:d,disabled:m})]}),e.jsx("div",{children:a==="STK_PUSH"?e.jsx(v,{label:"M-Pesa Phone Number",type:"tel",value:N,onChange:n=>c(n.target.value),placeholder:"254700000000",helperText:"You'll receive a prompt on your phone",disabled:m}):e.jsx(v,{label:"Transaction Code",value:h,onChange:n=>_(n.target.value),placeholder:"e.g. QWE123RTY",required:!0,helperText:"Enter the code from the M-Pesa SMS",disabled:m})})]}),e.jsx("div",{className:"bg-gray-50 p-6 rounded-2xl mb-8",children:e.jsx(V,{paymentMethod:a,amount:s.total,submitLabel:"Complete Renewal",accountNumber:"MEMBERSHIP_RENEW"})}),e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",id:"consentDataProtection",checked:P,onChange:n=>G(n.target.checked),disabled:m,className:"mt-1 w-5 h-5 rounded border-gray-300 text-wiria-blue-dark focus:ring-wiria-blue-dark"}),e.jsxs("label",{htmlFor:"consentDataProtection",className:"text-sm text-gray-700 leading-tight",children:["I consent to the processing of my personal data under the Data Protection Policy.",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",id:"consentCodeOfEthics",checked:C,onChange:n=>K(n.target.checked),disabled:m,className:"mt-1 w-5 h-5 rounded border-gray-300 text-wiria-blue-dark focus:ring-wiria-blue-dark"}),e.jsxs("label",{htmlFor:"consentCodeOfEthics",className:"text-sm text-gray-700 leading-tight",children:["I agree to abide by the WIRIA Code of Ethics and Conduct.",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]})]})]}),e.jsxs(S,{type:"submit",fullWidth:!0,size:"lg",isLoading:m,disabled:!P||!C||a==="MANUAL"&&!h,className:"h-14 text-lg shadow-xl",children:["Complete Renewal • KES ",s.total.toLocaleString()]})]})})]})]},"form")})})})}export{de as default};
//# sourceMappingURL=MemberRenewalPage-D4SzdhWg.js.map
