import{j as e,a as o}from"./query-vendor-DeB3i2OK.js";import{d as D}from"./react-vendor-D3fc32Hw.js";import{b as E,l as R,T as I,n as p}from"./index-8OXY4Dao.js";import{a as T}from"./apiUtils-CDDJc0SC.js";import{B as b}from"./Button-DJTJFzQ2.js";import{A as H}from"./AdminPageHeader-D8RkU4Nw.js";import{C as F}from"./ConfirmDialog-DWJd0Pek.js";import{D as G}from"./DataTable-CG6a3mm-.js";import{S as Y}from"./StatusBadge-YsC6pSWk.js";import{u as $,a as C}from"./useAdminData-DA4gw9n3.js";import"./animation-vendor-JsFu8W7l.js";import"./helpers-CdcGZezW.js";import"./Modal-D-omMokM.js";const B=async t=>{try{const s=t?.status?`?status=${t.status}`:"",r=await E.get(`/contact${s}`);return T(r)}catch(s){throw R.error("Failed to fetch contacts:",s),new Error("Failed to load contacts. Please try again.")}},V=async(t,s)=>{try{return await E.post(`/contact/${t}/respond`,{response:s}),!0}catch(r){throw R.error("Failed to respond to contact:",r),r}},W=async t=>{try{return await E.delete(`/contact/${t}`),!0}catch(s){throw R.error("Failed to archive contact:",s),s}},X=t=>new Date(t).toLocaleDateString("en-KE",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});function q({contact:t,onClose:s,onReply:r}){return e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 p-4",children:e.jsxs("div",{className:"flex max-h-[90vh] w-full max-w-2xl flex-col rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b p-6",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Message Details"}),e.jsx("button",{onClick:s,className:"text-2xl text-gray-500 hover:text-gray-700",children:"×"})]}),e.jsxs("div",{className:"flex-1 space-y-6 overflow-y-auto p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsx(f,{label:"From",value:t.name}),e.jsx(f,{label:"Email",value:t.email}),e.jsx(f,{label:"Phone",value:t.phone??"N/A"}),e.jsx(f,{label:"Received",value:X(t.createdAt)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-[10px] font-bold uppercase tracking-widest text-gray-400",children:"Subject"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:t.subject})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-[10px] font-bold uppercase tracking-widest text-gray-400",children:"Message Content"}),e.jsx("div",{className:"whitespace-pre-wrap rounded-xl border border-gray-100 bg-gray-50 p-5 leading-relaxed text-gray-700",children:t.message})]}),t.response&&e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-[10px] font-bold uppercase tracking-widest text-green-600",children:"Internal Response"}),e.jsx("div",{className:"rounded-xl border border-green-100 bg-green-50 p-5 text-green-700",children:t.response})]})]}),e.jsxs("div",{className:"flex gap-3 border-t p-6",children:[t.status==="NEW"&&e.jsx(b,{onClick:r,children:"Reply Now"}),e.jsx(b,{variant:"secondary",onClick:s,className:"ml-auto",children:"Close"})]})]})})}function f({label:t,value:s}){return e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-gray-400",children:t}),e.jsx("p",{className:"font-semibold text-gray-900",children:s})]})}function K({contact:t,replyText:s,isSubmitting:r,setReplyText:a,onReply:i,onCancel:l}){const d=s.trim().length>=10&&s.length<=1e3;return e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black bg-opacity-50 p-4",children:e.jsxs("div",{className:"w-full max-w-lg rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"border-b p-6",children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Reply to ",t.name]}),e.jsxs("p",{className:"mt-1 truncate text-sm text-gray-500",children:["Re: ",t.subject]})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("label",{htmlFor:"reply-text",className:"mb-2 block text-sm font-bold text-gray-700",children:"Your Response *"}),e.jsx("textarea",{id:"reply-text",value:s,onChange:m=>a(m.target.value),className:`h-40 w-full rounded-xl border p-4 outline-none transition-all focus:ring-2 ${s.trim().length>0&&!d?"border-red-300 focus:ring-red-100":"border-gray-200 focus:ring-wiria-blue-dark/10"}`,placeholder:"Type your reply here... This will be sent as an email response.",maxLength:1e3,required:!0}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsxs("div",{className:"text-[10px] font-bold uppercase tracking-wider",children:[s.trim().length>0&&s.trim().length<10&&e.jsxs("span",{className:"text-red-500",children:["Min ",10," chars required"]}),d&&e.jsx("span",{className:"text-green-600",children:"✓ Valid response"})]}),e.jsxs("span",{className:`text-[10px] font-bold ${s.length>1e3*.9?"text-orange-500":"text-gray-400"}`,children:[s.length," / ",1e3]})]})]}),e.jsxs("div",{className:"flex gap-3 border-t p-6",children:[e.jsx(b,{onClick:i,disabled:r||!d,className:"flex-1",children:r?"Sending Email...":"Send Reply"}),e.jsx(b,{variant:"secondary",onClick:l,disabled:r,children:"Cancel"})]})]})})}function O(t){return new Date(t).toLocaleDateString("en-KE",{year:"numeric",month:"short",day:"numeric"})}function z({pendingCount:t}){return t<=0?null:e.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-yellow-100 bg-yellow-50 px-4 py-2 shadow-sm",children:[e.jsx("span",{className:"h-2 w-2 animate-pulse rounded-full bg-yellow-600"}),e.jsxs("span",{className:"text-sm font-bold text-yellow-700",children:[t," new message",t>1?"s":""]})]})}function U({statusFilter:t,setStatusFilter:s}){const r=[{label:"All",value:""},{label:"New",value:"NEW"},{label:"Responded",value:"RESPONDED"},{label:"Archived",value:"ARCHIVED"}];return e.jsx("div",{className:"flex w-fit flex-wrap items-center gap-2 rounded-2xl border border-gray-100 bg-white p-2 shadow-sm",children:r.map(a=>e.jsx("button",{onClick:()=>s(a.value),className:`rounded-xl px-6 py-2 text-sm font-bold transition-all ${t===a.value?"bg-wiria-blue-dark text-white shadow-md":"text-gray-500 hover:bg-gray-50 hover:text-wiria-blue-dark"}`,children:a.label},a.value))})}function J(t,s,r){return[{header:"Sender",key:"name",render:a=>e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"font-bold text-gray-900",children:a.name}),e.jsx("p",{className:"max-w-[150px] truncate font-mono text-[10px] text-gray-400",children:a.email})]})},{header:"Subject",key:"subject",className:"font-medium text-gray-700"},{header:"Date",key:"createdAt",render:a=>e.jsx("span",{className:"text-xs text-gray-500",children:O(a.createdAt)})},{header:"Status",key:"status",render:a=>e.jsx(Y,{status:a.status})},{header:"Actions",key:"actions",align:"right",render:a=>e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>t(a.id),className:"text-xs font-bold text-wiria-blue-dark hover:underline",children:"Details"}),a.status==="NEW"&&e.jsx("button",{onClick:()=>{t(a.id),s(!0)},className:"text-xs font-bold text-green-600 hover:underline",children:"Reply"}),a.status!=="ARCHIVED"&&e.jsx("button",{onClick:()=>r(a.id),className:"text-xs font-bold text-gray-400 transition-colors hover:text-red-500",children:"Archive"})]})}]}function xe(){const[t,s]=D(),[r,a]=o.useState(""),i=t.get("highlight"),{items:l,isLoading:x}=$(["contacts",r],()=>B(r?{status:r}:void 0),{staleTime:I.POLLING_INTERVAL}),y=C(({id:n,text:g})=>V(n,g),[["contacts"]],{onSuccess:()=>{p.success("Reply sent successfully")},onError:()=>{p.error("Failed to send reply")}}),d=C(n=>W(n),[["contacts"]],{onSuccess:()=>{p.success("Message archived")},onError:()=>{p.error("Failed to archive message")}}),[m,u]=o.useState(null),[A,h]=o.useState(!1),[j,N]=o.useState(""),[v,w]=o.useState(null),c=o.useMemo(()=>l.find(n=>n.id===m)??null,[l,m]);o.useEffect(()=>{if(!x&&i){if(!l.some(_=>_.id===i))return;u(i);const g=new URLSearchParams(t);g.delete("highlight"),s(g,{replace:!0})}},[i,l,x,t,s]);const L=()=>{!c||!j.trim()||y.mutate({id:c.id,text:j},{onSuccess:()=>{h(!1),N(""),u(null)}})},k=n=>{w(n)},S=()=>{v&&(d.mutate(v),w(null))},M=J(n=>u(n),n=>h(n),n=>k(n)),P=l.filter(n=>n.status==="NEW").length;return e.jsxs("div",{className:"space-y-8",children:[e.jsx(H,{title:"Contact Messages",description:"Manage and respond to community inquiries from the contact form.",children:e.jsx(z,{pendingCount:P})}),e.jsx(U,{statusFilter:r,setStatusFilter:a}),e.jsx(G,{columns:M,data:l,rowKey:"id",isLoading:x,emptyMessage:"No messages found for this category.",rowClassName:n=>n.status==="NEW"?"bg-yellow-50/30":""}),c&&!A&&e.jsx(q,{contact:c,onClose:()=>u(null),onReply:()=>h(!0)}),A&&c&&e.jsx(K,{contact:c,replyText:j,isSubmitting:y.isPending,setReplyText:N,onReply:L,onCancel:()=>{h(!1),N("")}}),e.jsx(F,{isOpen:v!==null,title:"Archive Message",message:"Are you sure you want to archive this message?",confirmLabel:"Archive",onConfirm:S,onCancel:()=>w(null)})]})}export{xe as default};
//# sourceMappingURL=ContactManagementPage-Cj9LIG5u.js.map
