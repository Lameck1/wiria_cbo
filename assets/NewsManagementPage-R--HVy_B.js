import{j as e}from"./query-vendor-DD8i-cqI.js";import{r as o}from"./react-vendor-CPrm261X.js";import{a as g,n as i}from"./index-BdV3nUoJ.js";import{B as b}from"./Button-19zhKMt2.js";import{e as p,g as N}from"./apiUtils-BfmRaJyO.js";import"./animation-vendor-DKvKsx_2.js";const w=async()=>g.get("/updates?limit=100&includeAll=true"),v=async t=>g.post("/updates",t),U=async(t,r)=>g.patch(`/updates/${t}`,r),C=async t=>g.delete(`/updates/${t}`);function T(){const[t,r]=o.useState([]),[c,d]=o.useState(!0),[x,l]=o.useState(null),[m,n]=o.useState(!1),[a,h]=o.useState("ALL"),f=async()=>{d(!0);try{const s=await w();r(p(s))}catch(s){console.error(s),i.error("Failed to load news/updates")}finally{d(!1)}};o.useEffect(()=>{f()},[]);const y=async s=>{if(confirm("Are you sure you want to delete this update?"))try{await C(s),i.success("Update deleted successfully"),f()}catch{i.error("Failed to delete update")}},u=a==="ALL"?t:t.filter(s=>s.status===a),j=t.filter(s=>s.status==="DRAFT").length;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-wiria-blue-dark",children:"News & Updates Management"}),e.jsx(b,{onClick:()=>{l(null),n(!0)},children:"+ Post New Update"})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsxs("button",{onClick:()=>h("ALL"),className:`px-4 py-2 rounded-lg font-semibold transition-colors ${a==="ALL"?"bg-wiria-blue-dark text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["All (",t.length,")"]}),e.jsxs("button",{onClick:()=>h("PUBLISHED"),className:`px-4 py-2 rounded-lg font-semibold transition-colors ${a==="PUBLISHED"?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Published (",t.filter(s=>s.status==="PUBLISHED").length,")"]}),e.jsxs("button",{onClick:()=>h("DRAFT"),className:`px-4 py-2 rounded-lg font-semibold transition-colors flex items-center gap-2 ${a==="DRAFT"?"bg-yellow-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Drafts",j>0&&e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold ${a==="DRAFT"?"bg-white text-yellow-600":"bg-yellow-100 text-yellow-700"}`,children:j})]})]}),c?e.jsx("div",{className:"text-center py-12",children:"Loading..."}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[u&&Array.isArray(u)?u.map(s=>e.jsx(E,{update:s,onEdit:()=>{l(s),n(!0)},onDelete:()=>y(s.id)},s.id)):e.jsx("div",{className:"col-span-full text-red-500",children:"Error: Updates data is corrupted. Please refresh."}),u.length===0&&e.jsx("p",{className:"col-span-full text-center text-gray-500 py-12",children:a==="DRAFT"?"No draft updates. Create one by saving as Draft!":"No updates found."})]}),m&&e.jsx(D,{update:x,onClose:()=>n(!1),onSuccess:()=>{n(!1),f()}})]})}function E({update:t,onEdit:r,onDelete:c}){return e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border-t-4 border-wiria-yellow overflow-hidden flex flex-col h-full",children:[t.imageUrl?e.jsx("img",{src:t.imageUrl,alt:t.title,className:"w-full h-32 object-cover"}):e.jsx("div",{className:"w-full h-32 bg-gray-100 flex items-center justify-center text-gray-400",children:"No Image"}),e.jsxs("div",{className:"p-5 flex-grow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"bg-blue-100 text-blue-700 text-xs font-bold px-2 py-1 rounded-full",children:t.category}),e.jsx("span",{className:"text-gray-400 text-xs",children:new Date(t.createdAt).toLocaleDateString()})]}),e.jsx("h3",{className:"font-bold text-lg mb-2 text-wiria-blue-dark line-clamp-2",children:t.title}),e.jsx("p",{className:"text-gray-600 text-sm line-clamp-3",children:t.excerpt||(t.fullContent?t.fullContent.substring(0,150)+"...":"No content available")}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:`text-xs font-bold px-2 py-1 rounded ${t.status==="PUBLISHED"?"bg-green-100 text-green-700":"bg-gray-200 text-gray-700"}`,children:t.status})})]}),e.jsxs("div",{className:"bg-gray-50 p-4 border-t flex justify-end gap-3 mt-auto",children:[e.jsx("button",{onClick:r,className:"text-wiria-blue-dark hover:underline text-sm font-bold",children:"Edit"}),e.jsx("button",{onClick:c,className:"text-red-600 hover:underline text-sm font-bold",children:"Delete"})]})]})}function D({update:t,onClose:r,onSuccess:c}){const d=async x=>{x.preventDefault();const l=new FormData(x.currentTarget),m={title:l.get("title"),imageUrl:l.get("imageUrl"),category:l.get("category"),status:l.get("status"),fullContent:l.get("fullContent"),excerpt:l.get("excerpt")};try{t?(await U(t.id,m),i.success("Update modified successfully")):(await v(m),i.success("Update created successfully")),c()}catch(n){i.error(N(n,"Operation failed"))}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsx("h3",{className:"text-2xl font-bold",children:t?"Edit Update":"Post New Update"})}),e.jsx("div",{className:"p-6 overflow-y-auto flex-1",children:e.jsxs("form",{id:"news-form",onSubmit:d,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-bold mb-2",htmlFor:"news-title",children:"Title"}),e.jsx("input",{id:"news-title",name:"title",defaultValue:t==null?void 0:t.title,className:"w-full border rounded-lg p-3",required:!0,placeholder:"e.g. New Community Program Launch"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-bold mb-2",htmlFor:"news-imageUrl",children:"Image URL (Optional)"}),e.jsx("input",{id:"news-imageUrl",name:"imageUrl",defaultValue:t==null?void 0:t.imageUrl,className:"w-full border rounded-lg p-3",placeholder:"https://..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-2",htmlFor:"news-category",children:"Category"}),e.jsxs("select",{id:"news-category",name:"category",defaultValue:(t==null?void 0:t.category)||"GENERAL",className:"w-full border rounded-lg p-3",children:[e.jsx("option",{value:"GENERAL",children:"General"}),e.jsx("option",{value:"EVENT",children:"Event"}),e.jsx("option",{value:"ANNOUNCEMENT",children:"Announcement"}),e.jsx("option",{value:"STORY",children:"Success Story"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-2",htmlFor:"news-status",children:"Status"}),e.jsxs("select",{id:"news-status",name:"status",defaultValue:(t==null?void 0:t.status)||"PUBLISHED",className:"w-full border rounded-lg p-3",children:[e.jsx("option",{value:"PUBLISHED",children:"Published"}),e.jsx("option",{value:"DRAFT",children:"Draft"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-bold mb-2",htmlFor:"news-fullContent",children:"Content"}),e.jsx("textarea",{id:"news-fullContent",name:"fullContent",defaultValue:t==null?void 0:t.fullContent,className:"w-full border rounded-lg p-3 h-48",required:!0,placeholder:"Describe the update in detail..."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-bold mb-2",htmlFor:"news-excerpt",children:"Excerpt (Optional)"}),e.jsx("textarea",{id:"news-excerpt",name:"excerpt",defaultValue:t==null?void 0:t.excerpt,className:"w-full border rounded-lg p-3 h-20",placeholder:"Short summary..."})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(b,{type:"submit",fullWidth:!0,children:"Save Post"}),e.jsx(b,{type:"button",variant:"secondary",fullWidth:!0,onClick:r,children:"Cancel"})]})]})})]})})}export{T as default};
//# sourceMappingURL=NewsManagementPage-R--HVy_B.js.map
