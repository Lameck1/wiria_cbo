import{b as C,j as e}from"./query-vendor-CM55eWOT.js";import{r as p}from"./react-vendor-CXp26_Hx.js";import{d as N,n as y}from"./index-Ck6qqv4n.js";import{B as v}from"./Button-JX_3oChN.js";import{u as T,a as A,D as P}from"./useAdminData-91Z-y-lf.js";import{u as q}from"./resources.api-R4KhCyJj.js";import{g as V}from"./apiUtils-0UX-zM9U.js";import{M}from"./Modal-BGjbfc1U.js";import"./animation-vendor-Bcu85ETC.js";const F=async(s={})=>{const i=new URLSearchParams;s.status&&i.append("status",s.status),s.category&&i.append("category",s.category),s.all&&i.append("all","true");const n=i.toString(),u=`/tenders${n?`?${n}`:""}`;return N.get(u)},O=async s=>N.post("/tenders",s),I=async(s,i)=>N.patch(`/tenders/${s}`,i),R=async s=>N.delete(`/tenders/${s}`);function L({tender:s,onClose:i,onSuccess:n}){const u=C(),[h,m]=p.useState((s==null?void 0:s.eligibility)||["Legal registration in Kenya","Tax compliance"]),[f,c]=p.useState((s==null?void 0:s.requiredDocuments)||["Certificate of Incorporation","KRA PIN/Tax Compliance"]),[b,g]=p.useState(!1),l=(r,t,o)=>{r(a=>{const d=[...a];return d[t]=o,d})},w=r=>r(t=>[...t,""]),E=(r,t)=>r(o=>o.filter((a,d)=>d!==t)),S=async r=>{var k;r.preventDefault(),g(!0);const t=r.currentTarget,o=new FormData(t),a=Object.fromEntries(o.entries()),d=t.querySelector("#tender-file-input");let D=a.downloadUrl||"";try{if((k=d==null?void 0:d.files)!=null&&k.length){y.info("Uploading document...");const x=d.files[0];x&&(D=(await q(x,"tenders")).data.url)}const j={title:a.title,refNo:a.refNo,category:a.category,estimatedValue:a.estimatedValue,deadline:new Date(a.deadline).toISOString(),status:a.status,submissionMethod:a.submissionMethod,submissionEmail:a.submissionEmail,contactPerson:a.contactPerson,contactPhone:a.contactPhone,description:a.description,eligibility:h.filter(x=>x.trim()),requiredDocuments:f.filter(x=>x.trim()),downloadUrl:D};s?(await I(s.id,j),y.success("Tender updated")):(await O(j),y.success("Tender advertised")),u.invalidateQueries({queryKey:["tenders"]}),n()}catch(j){y.error(V(j,"Operation failed"))}finally{g(!1)}};return e.jsx(M,{isOpen:!0,onClose:i,title:s?"Edit Tender":"Advertise New Tender",size:"3xl",children:e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"border-b pb-1 font-bold text-wiria-blue-dark",children:"Basic Information"}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-title",children:"Tender Title *"}),e.jsx("input",{id:"tender-title",name:"title",defaultValue:s==null?void 0:s.title,className:"w-full rounded-lg border p-2.5",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-refNo",children:"Reference No *"}),e.jsx("input",{id:"tender-refNo",name:"refNo",defaultValue:s==null?void 0:s.refNo,className:"w-full rounded-lg border p-2.5",required:!0,placeholder:"WIRIA/2025/..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-category",children:"Category *"}),e.jsx("input",{id:"tender-category",name:"category",defaultValue:s==null?void 0:s.category,className:"w-full rounded-lg border p-2.5",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-deadline",children:"Deadline *"}),e.jsx("input",{id:"tender-deadline",type:"datetime-local",name:"deadline",defaultValue:s!=null&&s.deadline?new Date(s.deadline).toISOString().slice(0,16):"",className:"w-full rounded-lg border p-2.5",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-estimatedValue",children:"Est. Value"}),e.jsx("input",{id:"tender-estimatedValue",name:"estimatedValue",defaultValue:s==null?void 0:s.estimatedValue,className:"w-full rounded-lg border p-2.5"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-status",children:"Status"}),e.jsxs("select",{id:"tender-status",name:"status",defaultValue:(s==null?void 0:s.status)||"OPEN",className:"w-full rounded-lg border p-2.5",children:[e.jsx("option",{value:"OPEN",children:"Open"}),e.jsx("option",{value:"CLOSED",children:"Closed"}),e.jsx("option",{value:"AWARDED",children:"Awarded"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"border-b pb-1 font-bold text-wiria-blue-dark",children:"Submission & Contact"}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-submissionMethod",children:"Submission Method *"}),e.jsxs("select",{id:"tender-submissionMethod",name:"submissionMethod",defaultValue:(s==null?void 0:s.submissionMethod)||"ONLINE",className:"w-full rounded-lg border p-2.5",children:[e.jsx("option",{value:"ONLINE",children:"Online (Email)"}),e.jsx("option",{value:"PHYSICAL",children:"Physical (Seal Box)"}),e.jsx("option",{value:"BOTH",children:"Both"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-submissionEmail",children:"Submission Email *"}),e.jsx("input",{id:"tender-submissionEmail",type:"email",name:"submissionEmail",defaultValue:(s==null?void 0:s.submissionEmail)||"tenders@wiria.org",className:"w-full rounded-lg border p-2.5",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-contactPerson",children:"Contact Person *"}),e.jsx("input",{id:"tender-contactPerson",name:"contactPerson",defaultValue:s==null?void 0:s.contactPerson,className:"w-full rounded-lg border p-2.5",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-contactPhone",children:"Contact Phone *"}),e.jsx("input",{id:"tender-contactPhone",name:"contactPhone",defaultValue:s==null?void 0:s.contactPhone,className:"w-full rounded-lg border p-2.5",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-file-input",children:"Tender Document (PDF)"}),e.jsx("input",{type:"file",id:"tender-file-input",className:"w-full rounded-lg border p-2 text-sm",accept:".pdf,.doc,.docx"}),e.jsx("input",{type:"hidden",name:"downloadUrl",defaultValue:s==null?void 0:s.downloadUrl})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-bold",children:"Eligibility Criteria"}),h.map((r,t)=>e.jsxs("div",{className:"mb-2 flex gap-2",children:[e.jsx("input",{"aria-label":`Eligibility criteria ${t+1}`,value:r,onChange:o=>l(m,t,o.target.value),className:"flex-1 rounded-lg border p-2 text-sm",required:!0}),e.jsx("button",{type:"button",onClick:()=>E(m,t),className:"text-red-500",children:"✕"})]},t)),e.jsx("button",{type:"button",onClick:()=>w(m),className:"text-xs font-bold text-blue-600",children:"+ Add Criteria"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-bold",children:"Required Documents"}),f.map((r,t)=>e.jsxs("div",{className:"mb-2 flex gap-2",children:[e.jsx("input",{"aria-label":`Required document ${t+1}`,value:r,onChange:o=>l(c,t,o.target.value),className:"flex-1 rounded-lg border p-2 text-sm",required:!0}),e.jsx("button",{type:"button",onClick:()=>E(c,t),className:"text-red-500",children:"✕"})]},t)),e.jsx("button",{type:"button",onClick:()=>w(c),className:"text-xs font-bold text-blue-600",children:"+ Add Document"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-description",children:"Full Description *"}),e.jsx("textarea",{id:"tender-description",name:"description",defaultValue:s==null?void 0:s.description,className:"h-24 w-full rounded-lg border p-3 text-sm",required:!0})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(v,{type:"submit",fullWidth:!0,disabled:b,children:b?"Saving...":s?"Update Tender":"Advertise Tender"}),e.jsx(v,{type:"button",variant:"secondary",fullWidth:!0,onClick:i,disabled:b,children:"Cancel"})]})]})})}function G(){const s=C(),{items:i,isLoading:n}=T(["tenders",{all:!0}],()=>F({all:!0})),u=A(l=>R(l),[["tenders"]],{successMessage:"Tender deleted successfully",onSuccess:()=>s.invalidateQueries({queryKey:["tenders"]})}),[h,m]=p.useState(null),[f,c]=p.useState(!1),b=l=>{confirm("Are you sure you want to delete this tender?")&&u.mutate(l)},g=[{header:"Ref No",key:"refNo",className:"font-mono text-xs"},{header:"Title",key:"title",className:"font-semibold"},{header:"Deadline",key:"deadline",render:l=>e.jsx("span",{className:"text-sm",children:new Date(l.deadline).toLocaleDateString()})},{header:"Document",key:"downloadUrl",render:l=>l.downloadUrl?e.jsx("span",{className:"inline-flex items-center gap-1 rounded bg-green-100 px-2 py-0.5 text-[10px] font-bold uppercase text-green-700",children:"✓ Uploaded"}):e.jsx("span",{className:"inline-flex items-center gap-1 rounded bg-yellow-100 px-2 py-0.5 text-[10px] font-bold uppercase text-yellow-700",children:"⚠ Missing"})},{header:"Status",key:"status",render:l=>e.jsx(U,{tender:l})},{header:"Actions",key:"actions",align:"right",render:l=>e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{m(l),c(!0)},className:"text-sm font-bold text-wiria-blue-dark hover:underline",children:"Edit"}),e.jsx("button",{onClick:()=>b(l.id),className:"text-sm font-bold text-red-600 hover:underline",children:"Delete"})]})}];return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("header",{className:"flex items-center justify-between rounded-2xl border border-gray-100 bg-gray-50/50 p-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-gray-900",children:"Tender Management"}),e.jsx("p",{className:"mt-1 font-medium text-gray-500",children:"Advertise and manage organization procurement opportunities."})]}),e.jsx(v,{onClick:()=>{m(null),c(!0)},children:"+ Advertise New Tender"})]}),e.jsx(P,{columns:g,data:i,rowKey:"id",isLoading:n,emptyMessage:"No tenders advertised yet."}),f&&e.jsx(L,{tender:h,onClose:()=>c(!1),onSuccess:()=>c(!1)})]})}function U({tender:s}){const n=s.status==="OPEN"&&new Date(s.deadline)<new Date?"EXPIRED":s.status,u={OPEN:"bg-green-100 text-green-700",CLOSED:"bg-red-100 text-red-700",AWARDED:"bg-blue-100 text-blue-700",CANCELLED:"bg-gray-100 text-gray-700",EXPIRED:"bg-yellow-100 text-yellow-700"};return e.jsx("span",{className:`rounded-full px-2 py-1 text-[10px] font-bold uppercase tracking-wider ${u[n]||"bg-gray-100"}`,children:n})}export{G as default};
//# sourceMappingURL=TenderManagementPage-LjPESYKP.js.map
