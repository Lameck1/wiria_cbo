import{r as m}from"./react-vendor-BdaLayic.js";import{T as I,c as M,m as v}from"./index-ICA0O2oL.js";import{j as e}from"./query-vendor-frBnvHSF.js";import{C as p,a as N}from"./Card-DmlQfAyP.js";import{m as f}from"./animation-vendor-CrU7SSpu.js";function K({donationId:s,isActive:t,onStatusCheck:a,interval:n=I.PAYMENT_POLL_INTERVAL}){const r=m.useRef(null),i=m.useRef(a);m.useEffect(()=>{i.current=a},[a]),m.useEffect(()=>{if(!t||!s){r.current&&(clearInterval(r.current),r.current=null);return}const o=async()=>{const l=i.current;if(!l)return;const c=await l(s);(c==="COMPLETED"||c==="FAILED")&&r.current&&(clearInterval(r.current),r.current=null)};return o(),r.current=setInterval(()=>void o(),n),()=>{r.current&&(clearInterval(r.current),r.current=null)}},[s,t,n])}var d=(s=>(s.PENDING="PENDING",s.COMPLETED="COMPLETED",s.FAILED="FAILED",s.CANCELLED="CANCELLED",s))(d||{});function k(s,t){var r,i,o;const a=s.checkoutRequestId??s.transactionId??((r=s.data)==null?void 0:r.checkoutRequestId)??((i=s.data)==null?void 0:i.transactionId),n=s.message??((o=s.data)==null?void 0:o.message)??(t==null?void 0:t.initiationSuccess);return{requestId:a,message:n}}function L({paymentMethod:s,requestId:t,message:a,config:n,setCheckoutRequestId:r,setTransactionId:i,setPaymentStatus:o,notifySuccess:l}){var c,u,x;if(s==="STK_PUSH"&&t){r(t),i(t),o(d.PENDING);const h=((c=n.messages)==null?void 0:c.stkPushSent)??a??"STK push sent to your phone. Please complete the payment.";l(h);return}if(s==="MANUAL"){o(d.PENDING);const h=((u=n.messages)==null?void 0:u.manualPaymentSubmitted)??((x=n.messages)==null?void 0:x.initiationSuccess)??"Payment submitted for verification.";l(h);return}o(d.COMPLETED),l(a??"Payment initiated successfully!")}function D({apiClient:s,config:t,notificationService:a,setIsSubmitting:n,setPaymentStatus:r,setCheckoutRequestId:i,setTransactionId:o}){return async l=>v("payment_initiation",async()=>{n(!0),r(null);try{const c=await s.post(t.initiationEndpoint,l),{requestId:u,message:x}=k(c,t.messages);return L({paymentMethod:l.paymentMethod,requestId:u,message:x,config:t,setCheckoutRequestId:i,setTransactionId:o,setPaymentStatus:r,notifySuccess:h=>a.success(h)}),{success:!0,checkoutRequestId:u,transactionId:u,message:x}}catch(c){const u=c instanceof Error?c.message:"Payment initiation failed";return a.error(`${u}. Please try again.`),{success:!1}}finally{n(!1)}})()}function S({apiClient:s,config:t,notificationService:a,setPaymentStatus:n}){return async r=>{var i,o;try{const l=await s.get(`${t.statusEndpoint}/${r}`);let c=null;if("status"in l&&l.status?c=l.status:"data"in l&&((i=l.data)!=null&&i.status)&&(c=l.data.status),!c)return d.PENDING;switch(n(c),c){case d.COMPLETED:return a.success(((o=t.messages)==null?void 0:o.paymentCompleted)??"Payment completed successfully!"),d.COMPLETED;case d.FAILED:return a.error("Payment failed. Please try again."),d.FAILED;case d.CANCELLED:return a.warning("Payment was cancelled."),d.CANCELLED;default:return d.PENDING}}catch{return d.PENDING}}}function A({apiClient:s,config:t,notificationService:a,setIsVerifying:n,setIsManualPaymentVerified:r,setPaymentStatus:i}){return async(o,l,c)=>{if(!t.manualVerificationEndpoint)return a.error("Manual payment verification not configured."),{success:!1};n(!0),r(!1);try{const u=await s.post(t.manualVerificationEndpoint,{phone:o,amount:l,accountReference:c??t.flowType.toUpperCase()});return u.verified===!0||u.status==="CONFIRMED"?(r(!0),i(d.COMPLETED),a.success("Payment verified successfully!"),{success:!0,verified:!0}):(a.error("Payment not found yet. Please wait a moment and try again."),{success:!1,verified:!1})}catch{return a.error("Verification failed. Please try again."),{success:!1}}finally{n(!1)}}}function C({setCheckoutRequestId:s,setTransactionId:t,setPaymentStatus:a,setIsSubmitting:n,setIsVerifying:r,setIsManualPaymentVerified:i}){s(null),t(null),a(null),n(!1),r(!1),i(!1)}function V(s){const{apiClient:t,notificationService:a}=M(),[n,r]=m.useState(!1),[i,o]=m.useState(!1),[l,c]=m.useState(null),[u,x]=m.useState(null),[h,b]=m.useState(null),[g,y]=m.useState(!1),P=D({apiClient:t,config:s,notificationService:a,setIsSubmitting:r,setPaymentStatus:c,setCheckoutRequestId:x,setTransactionId:b}),j=S({apiClient:t,config:s,notificationService:a,setPaymentStatus:c}),E=A({apiClient:t,config:s,notificationService:a,setIsVerifying:o,setIsManualPaymentVerified:y,setPaymentStatus:c});return{isSubmitting:n,isVerifying:i,paymentStatus:l,checkoutRequestId:u,transactionId:h,isManualPaymentVerified:g,initiatePayment:P,checkPaymentStatus:j,verifyManualPayment:E,resetPayment:()=>{C({setCheckoutRequestId:x,setTransactionId:b,setPaymentStatus:c,setIsSubmitting:r,setIsVerifying:o,setIsManualPaymentVerified:y})}}}const w={INDIVIDUAL:{registration:500,subscription:1e3},GROUP:{registration:250,subscription:500}};function _({membershipType:s,memberCount:t}){return m.useMemo(()=>{const a=w[s],n=a.registration,r=a.subscription,i=s==="INDIVIDUAL"?1:Math.max(1,t),o={rate:n,count:i,subtotal:n*i},l={rate:r,count:i,subtotal:r*i};return{registration:o,subscription:l,total:o.subtotal+l.subtotal}},[s,t])}function H({membershipType:s,memberCount:t,maxCount:a}){return m.useMemo(()=>{const n=w[s],{subscription:r,registration:i}=n,o=s==="GROUP"?Math.max(1,t):1,l=s==="GROUP"?Math.max(0,t-a):0,c=o*r,u=l*i;return{renewal:{count:o,rate:r,subtotal:c},newRegistration:{count:l,rate:i,subtotal:u},total:c+u}},[s,t,a])}function q({paymentMethod:s,amount:t,submitLabel:a="Submit Donation",accountNumber:n="DONATION"}){return s==="STK_PUSH"?e.jsx(p,{className:"border-2 border-blue-200 bg-blue-50",children:e.jsxs(N,{children:[e.jsxs("h3",{className:"mb-3 flex items-center gap-2 font-semibold text-wiria-blue-dark",children:[e.jsx("span",{className:"text-2xl",children:"üì±"}),"M-Pesa STK Push Instructions"]}),e.jsxs("ol",{className:"space-y-2 text-sm text-gray-700",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-semibold text-wiria-blue-dark",children:"1."}),e.jsx("span",{children:"Enter your M-Pesa registered phone number"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-semibold text-wiria-blue-dark",children:"2."}),e.jsxs("span",{children:['Click "',a,'"']})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-semibold text-wiria-blue-dark",children:"3."}),e.jsx("span",{children:"Check your phone for an M-Pesa prompt"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-semibold text-wiria-blue-dark",children:"4."}),e.jsx("span",{children:"Enter your M-Pesa PIN to complete the payment"})]})]})]})}):e.jsx(p,{className:"border-2 border-green-200 bg-green-50",children:e.jsxs(N,{children:[e.jsxs("h3",{className:"mb-3 flex items-center gap-2 font-semibold text-wiria-blue-dark",children:[e.jsx("span",{className:"text-2xl",children:"üè¶"}),"Manual Paybill Instructions"]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"rounded-lg border border-green-200 bg-white p-3",children:[e.jsx("p",{className:"mb-2 text-gray-600",children:"Pay via M-Pesa Paybill:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Business Number:"}),e.jsx("p",{className:"text-lg font-bold text-wiria-blue-dark",children:"123456"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Account Number:"}),e.jsx("p",{className:"text-lg font-bold text-wiria-blue-dark",children:n})]})]})]}),e.jsxs("ol",{className:"space-y-2 text-gray-700",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-semibold text-wiria-blue-dark",children:"1."}),e.jsx("span",{children:"Go to M-Pesa menu on your phone"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-semibold text-wiria-blue-dark",children:"2."}),e.jsx("span",{children:'Select "Lipa na M-Pesa" then "Paybill"'})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-semibold text-wiria-blue-dark",children:"3."}),e.jsxs("span",{children:["Enter Business Number: ",e.jsx("strong",{children:"123456"})]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-semibold text-wiria-blue-dark",children:"4."}),e.jsxs("span",{children:["Enter Account Number: ",e.jsx("strong",{children:n})]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-semibold text-wiria-blue-dark",children:"5."}),e.jsxs("span",{children:["Enter Amount: ",e.jsxs("strong",{children:["KES ",t.toLocaleString()]})]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-semibold text-wiria-blue-dark",children:"6."}),e.jsx("span",{children:"Enter your M-Pesa PIN and confirm"})]})]}),e.jsx("p",{className:"mt-3 text-xs italic text-gray-600",children:"After payment, you'll receive an M-Pesa confirmation SMS. Your payment will be processed within 24 hours."})]})]})})}function B({selected:s,onChange:t,disabled:a}){return e.jsxs("div",{children:[e.jsxs("span",{className:"mb-4 block text-sm font-semibold text-wiria-blue-dark",children:["Payment Method ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(f.button,{type:"button",whileHover:{y:-2},whileTap:{scale:.98},onClick:()=>t("STK_PUSH"),disabled:a,className:`relative rounded-2xl border-2 p-5 text-center transition-all duration-200 ${s==="STK_PUSH"?"border-wiria-yellow bg-wiria-yellow/5 shadow-lg shadow-wiria-yellow/10 ring-2 ring-wiria-yellow/20":"border-gray-100 bg-white shadow-sm hover:border-wiria-yellow/30 hover:bg-gray-50"} disabled:cursor-not-allowed disabled:opacity-50`,children:[e.jsx("div",{className:"mb-3 text-4xl",children:"üì±"}),e.jsx("div",{className:"font-bold text-wiria-blue-dark",children:"M-Pesa STK Push"}),e.jsx("div",{className:"mt-1 text-xs font-medium text-gray-500",children:"Instant & Secure"}),s==="STK_PUSH"&&e.jsx(f.div,{layoutId:"activePayment",className:"absolute -right-2 -top-2 flex h-6 w-6 items-center justify-center rounded-full border-2 border-white bg-wiria-yellow text-xs text-white shadow-md",initial:{scale:0},animate:{scale:1},children:"‚úì"})]}),e.jsxs(f.button,{type:"button",whileHover:{y:-2},whileTap:{scale:.98},onClick:()=>t("MANUAL"),disabled:a,className:`relative rounded-2xl border-2 p-5 text-center transition-all duration-200 ${s==="MANUAL"?"border-wiria-yellow bg-wiria-yellow/5 shadow-lg shadow-wiria-yellow/10 ring-2 ring-wiria-yellow/20":"border-gray-100 bg-white shadow-sm hover:border-wiria-yellow/30 hover:bg-gray-50"} disabled:cursor-not-allowed disabled:opacity-50`,children:[e.jsx("div",{className:"mb-3 text-4xl",children:"üè¶"}),e.jsx("div",{className:"font-bold text-wiria-blue-dark",children:"Manual Paybill"}),e.jsx("div",{className:"mt-1 text-xs font-medium text-gray-500",children:"Direct Bank/M-Pesa"}),s==="MANUAL"&&e.jsx(f.div,{layoutId:"activePayment",className:"absolute -right-2 -top-2 flex h-6 w-6 items-center justify-center rounded-full border-2 border-white bg-wiria-yellow text-xs text-white shadow-md",initial:{scale:0},animate:{scale:1},children:"‚úì"})]})]})]})}export{B as P,q as a,_ as b,K as c,d,H as e,V as u};
//# sourceMappingURL=PaymentMethodToggle-DGzi79jd.js.map
