import{j as e}from"./query-vendor-DHwl1fd7.js";import{h as F,r as i}from"./react-vendor-Bq_hyp-_.js";import{a as N,n as d}from"./index-CpgmhssD.js";import{B as g}from"./Button-CR-7xgY1.js";import"./animation-vendor-DqiKO7jm.js";const L=t=>Array.isArray(t)?t:t!=null&&t.data&&Array.isArray(t.data)?t.data:t!=null&&t.contacts&&Array.isArray(t.contacts)?t.contacts:[],P=async t=>{try{const a=t!=null&&t.status?`?status=${t.status}`:"",n=await N.get(`/contact${a}`);return L(n)}catch(a){return console.error("Failed to fetch contacts:",a),[]}},I=async(t,a)=>{try{return await N.post(`/contact/${t}/respond`,{response:a}),!0}catch(n){throw console.error("Failed to respond to contact:",n),n}},T=async t=>{try{return await N.delete(`/contact/${t}`),!0}catch(a){throw console.error("Failed to archive contact:",a),a}},W={NEW:"bg-yellow-100 text-yellow-700",READ:"bg-blue-100 text-blue-700",RESPONDED:"bg-green-100 text-green-700",ARCHIVED:"bg-gray-100 text-gray-500"};function q(){const[t,a]=F(),[n,A]=i.useState([]),[k,v]=i.useState(!0),[c,x]=i.useState(""),[r,o]=i.useState(null),[w,h]=i.useState(!1),[l,u]=i.useState(""),[C,R]=i.useState(!1),E=t.get("highlight"),b=10,m=1e3,p=l.trim().length>=b&&l.length<=m,y=async()=>{v(!0);try{const s=await P(c?{status:c}:void 0);if(A(s),E){const j=s.find($=>$.id===E);j&&(o(j),t.delete("highlight"),a(t,{replace:!0}))}}catch(s){console.error(s),d.error("Failed to load messages")}finally{v(!1)}};i.useEffect(()=>{y()},[c]);const D=async()=>{if(!(!r||!l.trim())){R(!0);try{await I(r.id,l),d.success("Reply sent successfully"),h(!1),u(""),o(null),y()}catch{d.error("Failed to send reply")}finally{R(!1)}}},M=async s=>{if(confirm("Are you sure you want to archive this message?"))try{await T(s),d.success("Message archived"),y()}catch{d.error("Failed to archive message")}},S=s=>new Date(s).toLocaleDateString("en-KE",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),f=n.filter(s=>s.status==="NEW").length;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-wiria-blue-dark mb-2",children:"Contact Messages"}),e.jsx("p",{className:"text-gray-600",children:"Manage and respond to messages from the contact form."}),f>0&&e.jsxs("div",{className:"mt-2 inline-block bg-yellow-100 text-yellow-700 px-3 py-1 rounded-full text-sm font-bold",children:[f," pending message",f>1?"s":""]})]}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsx("button",{onClick:()=>x(""),className:`px-4 py-2 rounded-lg font-semibold transition-colors ${c?"bg-gray-100 text-gray-700 hover:bg-gray-200":"bg-wiria-blue-dark text-white"}`,children:"All"}),e.jsx("button",{onClick:()=>x("NEW"),className:`px-4 py-2 rounded-lg font-semibold transition-colors ${c==="NEW"?"bg-yellow-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"New"}),e.jsx("button",{onClick:()=>x("RESPONDED"),className:`px-4 py-2 rounded-lg font-semibold transition-colors ${c==="RESPONDED"?"bg-green-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Responded"}),e.jsx("button",{onClick:()=>x("ARCHIVED"),className:`px-4 py-2 rounded-lg font-semibold transition-colors ${c==="ARCHIVED"?"bg-gray-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Archived"})]}),e.jsx("div",{className:"space-y-4",children:k?e.jsx("div",{className:"bg-white rounded-xl shadow p-8 text-center",children:"Loading messages..."}):n.length===0?e.jsx("div",{className:"bg-white rounded-xl shadow p-8 text-center text-gray-500",children:"No messages found."}):n.map(s=>e.jsxs("div",{className:`bg-white rounded-xl shadow p-6 ${s.status==="NEW"?"border-l-4 border-yellow-500":""}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:s.subject}),e.jsxs("p",{className:"text-sm text-gray-500",children:["From: ",e.jsx("span",{className:"font-semibold",children:s.name})," (",s.email,")"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${W[s.status]}`,children:s.status}),e.jsx("span",{className:"text-xs text-gray-400",children:S(s.createdAt)})]})]}),e.jsx("p",{className:"text-gray-700 mb-4 line-clamp-2",children:s.message}),s.response&&e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg mb-4",children:[e.jsx("p",{className:"text-xs text-green-600 font-bold mb-1",children:"Your Response:"}),e.jsx("p",{className:"text-sm text-green-700",children:s.response})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>o(s),className:"text-wiria-blue-dark hover:underline text-sm font-bold",children:"View Full Message"}),s.status==="NEW"&&e.jsx("button",{onClick:()=>{o(s),h(!0)},className:"text-green-600 hover:underline text-sm font-bold",children:"Reply"}),s.status!=="ARCHIVED"&&e.jsx("button",{onClick:()=>M(s.id),className:"text-gray-500 hover:underline text-sm font-bold",children:"Archive"})]})]},s.id))}),r&&!w&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Message Details"}),e.jsx("button",{onClick:()=>o(null),className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-1 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase",children:"From"}),e.jsx("p",{className:"font-semibold",children:r.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase",children:"Email"}),e.jsx("p",{children:r.email})]}),r.phone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase",children:"Phone"}),e.jsx("p",{children:r.phone})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase",children:"Received"}),e.jsx("p",{children:S(r.createdAt)})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase mb-1",children:"Subject"}),e.jsx("p",{className:"font-semibold text-lg",children:r.subject})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase mb-1",children:"Message"}),e.jsx("p",{className:"bg-gray-50 p-4 rounded-lg whitespace-pre-wrap",children:r.message})]}),r.response&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-green-600 font-bold uppercase mb-1",children:"Your Response"}),e.jsx("p",{className:"bg-green-50 p-4 rounded-lg text-green-700",children:r.response})]})]}),e.jsxs("div",{className:"p-6 border-t flex gap-3",children:[r.status==="NEW"&&e.jsx(g,{onClick:()=>h(!0),children:"Reply"}),e.jsx(g,{variant:"secondary",onClick:()=>o(null),children:"Close"})]})]})}),w&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[70] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg",children:[e.jsxs("div",{className:"p-6 border-b",children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Reply to ",r.name]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Re: ",r.subject]})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Your Reply"}),e.jsx("textarea",{value:l,onChange:s=>u(s.target.value),className:`w-full border rounded-lg p-3 h-40 ${l.trim().length>0&&!p?"border-red-300 focus:border-red-500 focus:ring-red-200":"border-gray-300 focus:border-blue-500 focus:ring-blue-200"} focus:ring-2 focus:outline-none transition-colors`,placeholder:"Type your reply here... (minimum 10 characters)",maxLength:m}),e.jsxs("div",{className:"mt-2 flex justify-between items-center text-sm",children:[e.jsxs("div",{children:[l.trim().length>0&&l.trim().length<b&&e.jsxs("span",{className:"text-red-600",children:["Minimum ",b," characters required"]}),p&&e.jsx("span",{className:"text-green-600",children:"✓ Ready to send"})]}),e.jsxs("span",{className:`${l.length>m*.9?"text-orange-600 font-semibold":"text-gray-500"}`,children:[l.length," / ",m]})]})]}),e.jsxs("div",{className:"p-6 border-t flex gap-3",children:[e.jsx(g,{onClick:D,disabled:C||!p,children:C?"Sending...":"Send Reply"}),e.jsx(g,{variant:"secondary",onClick:()=>{h(!1),u("")},children:"Cancel"})]})]})})]})}export{q as default};
//# sourceMappingURL=ContactManagementPage-Be_lqKpb.js.map
