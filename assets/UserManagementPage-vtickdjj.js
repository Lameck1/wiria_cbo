import{a as u,j as e}from"./query-vendor-DeB3i2OK.js";import{b as x,U as h,n as o}from"./index-8OXY4Dao.js";import{A as P}from"./AdminPageHeader-D8RkU4Nw.js";import{B as f}from"./Button-DJTJFzQ2.js";import{M as V}from"./Modal-D-omMokM.js";import{g as $}from"./apiUtils-CDDJc0SC.js";import{S as p}from"./StatusBadge-YsC6pSWk.js";import{f as R}from"./dateUtils-D0Bnoiug.js";import{C as v}from"./ConfirmDialog-DWJd0Pek.js";import{C as B,a as G}from"./Card-DSTnzHyU.js";import{D as N}from"./DataTable-CG6a3mm-.js";import{u as y,a as C}from"./useAdminData-DA4gw9n3.js";import"./react-vendor-D3fc32Hw.js";import"./animation-vendor-JsFu8W7l.js";import"./helpers-CdcGZezW.js";const O=async()=>x.get("/admin/users"),q=async s=>x.post("/admin/users/invite",s),K=async(s="PENDING")=>x.get(`/admin/users/invitations?status=${s}`),W=async s=>x.delete(`/admin/users/invitations/${s}`),z=async(s,t)=>x.patch(`/admin/users/${s}/status`,{status:t});function H({onClose:s,onSuccess:t}){const[n,l]=u.useState(!1),m=async r=>{r.preventDefault(),l(!0);const a=new FormData(r.currentTarget),d={email:a.get("email"),role:a.get("role"),firstName:a.get("firstName"),lastName:a.get("lastName")};try{await q(d),o.success(`Invitation sent to ${d.email}`),t()}catch(g){const c=$(g,"Failed to send invitation");c.includes("session is no longer valid")?o.error("Session expired: Please log out and back in."):o.error(c)}finally{l(!1)}};return e.jsx(V,{isOpen:!0,onClose:s,title:"Invite New User",size:"2xl",children:e.jsxs("form",{onSubmit:r=>{m(r)},className:"space-y-6 p-2",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"mb-1.5 block text-xs font-bold uppercase tracking-wider text-gray-500",htmlFor:"invite-email",children:"Email Address *"}),e.jsx("input",{id:"invite-email",name:"email",type:"email",required:!0,placeholder:"e.g. staff@wiria.org",className:"w-full rounded-xl border-gray-200 bg-gray-50 p-3 outline-none transition-all focus:border-wiria-blue-dark focus:ring-2 focus:ring-wiria-blue-dark/20",disabled:n})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-xs font-bold uppercase tracking-wider text-gray-500",htmlFor:"invite-firstName",children:"First Name"}),e.jsx("input",{id:"invite-firstName",name:"firstName",placeholder:"e.g. Jane",className:"w-full rounded-xl border-gray-200 bg-gray-50 p-3 outline-none transition-all focus:border-wiria-blue-dark focus:ring-2 focus:ring-wiria-blue-dark/20",disabled:n})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-xs font-bold uppercase tracking-wider text-gray-500",htmlFor:"invite-lastName",children:"Last Name"}),e.jsx("input",{id:"invite-lastName",name:"lastName",placeholder:"e.g. Doe",className:"w-full rounded-xl border-gray-200 bg-gray-50 p-3 outline-none transition-all focus:border-wiria-blue-dark focus:ring-2 focus:ring-wiria-blue-dark/20",disabled:n})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"mb-1.5 block text-xs font-bold uppercase tracking-wider text-gray-500",htmlFor:"invite-role",children:"System Role *"}),e.jsxs("select",{id:"invite-role",name:"role",required:!0,className:"w-full appearance-none rounded-xl border-gray-200 bg-gray-50 p-3 outline-none transition-all focus:border-wiria-blue-dark focus:ring-2 focus:ring-wiria-blue-dark/20",disabled:n,children:[e.jsx("option",{value:"",children:"Select a role..."}),e.jsx("option",{value:h.STAFF,children:"Staff Member"}),e.jsx("option",{value:h.ADMIN,children:"Administrator"}),e.jsx("option",{value:h.VOLUNTEER,children:"Volunteer Coordinator"}),e.jsx("option",{value:h.SUPER_ADMIN,children:"Super Administrator"})]})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(f,{type:"submit",fullWidth:!0,isLoading:n,className:"h-12 text-lg",children:"Send Invitation"}),e.jsx(f,{type:"button",variant:"outline",fullWidth:!0,onClick:s,disabled:n,className:"h-12 text-lg",children:"Cancel"})]})]})})}const J=s=>[{header:"User",key:"name",render:t=>e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:`${t.firstName} ${t.lastName}`}),e.jsx("div",{className:"text-xs text-gray-500",children:t.email})]})},{header:"Role",key:"role",render:t=>e.jsx(p,{status:t.role})},{header:"Status",key:"status",render:t=>e.jsx(p,{status:t.status})},{header:"Actions",key:"actions",align:"right",render:t=>e.jsx("button",{onClick:()=>s(t.email,t.status),className:`text-sm font-bold transition-colors hover:underline ${t.status==="ACTIVE"?"text-red-500 hover:text-red-700":"text-green-600 hover:text-green-800"}`,children:t.status==="ACTIVE"?"Deactivate":"Activate"})}],_=s=>[{header:"Email",key:"email",className:"font-medium"},{header:"Role",key:"role",render:t=>e.jsx(p,{status:t.role})},{header:"Invited By",key:"inviter",render:t=>t.inviter?.email??"N/A"},{header:"Expires",key:"expiresAt",render:t=>e.jsx("span",{className:"text-sm",children:R(t.expiresAt)})},{header:"Actions",key:"actions",align:"right",render:t=>e.jsx("button",{onClick:()=>s(t.id),className:"text-sm font-bold text-red-500 transition-colors hover:text-red-700 hover:underline",children:"Cancel"})}];function ue(){const[s,t]=u.useState("ACTIVE"),[n,l]=u.useState(!1),[m,r]=u.useState(null),[a,d]=u.useState(null),[g,c]=u.useState(null),{items:j,isLoading:I}=y(["users"],O,{enabled:s==="ACTIVE"}),{items:S,isLoading:k}=y(["invitations"],K,{enabled:s==="PENDING"}),w=C(({email:i,status:b})=>z(i,b),[["users"]],{onSuccess:()=>{o.success("User status updated")},onError:()=>{o.error("Failed to update user status")}}),A=C(i=>W(i),[["invitations"]],{onSuccess:()=>{o.success("Invitation cancelled")},onError:()=>{o.error("Failed to cancel invitation")}}),E=(i,b)=>{const F=b==="ACTIVE"?"SUSPENDED":"ACTIVE";r(i),d(F)},D=()=>{!m||!a||(w.mutate({email:m,status:a}),r(null),d(null))},U=i=>{c(i)},T=()=>{g&&(A.mutate(g),c(null))},M=J(E),L=_(U);return e.jsxs("div",{className:"space-y-8",children:[e.jsx(P,{title:"User Management",description:"Manage system administrators and staff invitations.",children:e.jsx(f,{onClick:()=>l(!0),children:"+ Invite User"})}),e.jsx(B,{className:"overflow-hidden border-none shadow-sm",children:e.jsxs(G,{className:"p-0",children:[e.jsxs("div",{className:"flex border-b bg-gray-50/50",children:[e.jsx("button",{className:`px-8 py-4 text-sm font-bold transition-all ${s==="ACTIVE"?"border-b-2 border-wiria-blue-dark bg-white text-wiria-blue-dark":"text-gray-500 hover:bg-gray-100/50 hover:text-gray-700"}`,onClick:()=>t("ACTIVE"),children:"Active Users"}),e.jsx("button",{className:`px-8 py-4 text-sm font-bold transition-all ${s==="PENDING"?"border-b-2 border-wiria-blue-dark bg-white text-wiria-blue-dark":"text-gray-500 hover:bg-gray-100/50 hover:text-gray-700"}`,onClick:()=>t("PENDING"),children:"Pending Invitations"})]}),s==="ACTIVE"?e.jsx(N,{columns:M,data:j,isLoading:I,rowKey:"id",emptyMessage:"No active users found.",className:"rounded-none border-none shadow-none"}):e.jsx(N,{columns:L,data:S,isLoading:k,rowKey:"id",emptyMessage:"No pending invitations.",className:"rounded-none border-none shadow-none"})]})}),n&&e.jsx(H,{onClose:()=>l(!1),onSuccess:()=>{l(!1),t("PENDING")}}),e.jsx(v,{isOpen:m!==null&&a!==null,title:"Change User Status",message:`Are you sure you want to change status to ${a}?`,confirmLabel:"Change Status",onConfirm:D,onCancel:()=>{r(null),d(null)}}),e.jsx(v,{isOpen:g!==null,title:"Cancel Invitation",message:"Cancel this invitation?",confirmLabel:"Cancel Invitation",onConfirm:T,onCancel:()=>c(null)})]})}export{ue as default};
//# sourceMappingURL=UserManagementPage-vtickdjj.js.map
