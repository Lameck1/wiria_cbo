import{a as l,j as e}from"./query-vendor-DeB3i2OK.js";import{A as j}from"./AdminPageHeader-BwRDnFrq.js";import{b as m,l as f,M as y,n as x,T as N}from"./index-YnLEVKPI.js";import{B as u}from"./Button-jhyg_cfE.js";import{M as v}from"./Modal-DSDFZpMT.js";import{g as h}from"./apiUtils-CDDJc0SC.js";import{S as w}from"./Spinner-DGXkvh-k.js";import{b as M}from"./dateUtils-D0Bnoiug.js";import{D as S}from"./DataTable-Bz__wL_M.js";import{S as C}from"./StatusBadge-YsC6pSWk.js";import{u as k}from"./useAdminData-DA4gw9n3.js";import"./react-vendor-D3fc32Hw.js";import"./animation-vendor-JsFu8W7l.js";import"./helpers-C-aBis0i.js";const b=l.createContext(void 0);function D(){const s=l.useContext(b);if(s===void 0)throw new Error("useMember must be used within a MemberProvider");return s}const A=async(s={})=>{const t=new URLSearchParams;return s.status&&s.status!=="ALL"&&t.append("status",s.status),s.search&&t.append("search",s.search),await m.get(`/admin/members?${t.toString()}`)},E=async s=>await m.patch(`/admin/members/${s}/approve`),P=async(s,t)=>await m.patch(`/admin/members/${s}/reject`,{reason:t});function L({memberId:s}){const[t,r]=l.useState([]),[i,a]=l.useState(!0);return l.useEffect(()=>{(async()=>{try{const c=await m.get(`/admin/members/${s}/history`);r(c.data||[])}catch(c){f.error("Failed to fetch group history:",c)}finally{a(!1)}})()},[s]),i?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(w,{size:"sm"})}):t.length===0?e.jsx("div",{className:"py-4 text-center text-sm italic text-gray-500",children:"No group size history recorded."}):e.jsx("div",{className:"space-y-3",children:t.map(n=>e.jsxs("div",{className:"flex items-start gap-3 rounded-lg border border-gray-100 bg-gray-50 p-3",children:[e.jsx("div",{className:"rounded-full bg-blue-100 p-2 text-xs font-bold text-blue-700",children:n.newCount>n.oldCount?"↑":"↓"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-bold text-gray-900",children:[n.oldCount," → ",n.newCount," Members"]}),e.jsx("span",{className:"text-[10px] text-gray-500",children:M(n.createdAt)})]}),e.jsx("p",{className:"line-clamp-1 text-xs text-gray-600",children:n.reason??"Manual Update"})]})]},n.id))})}function T({member:s}){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{children:[e.jsx("h4",{className:"mb-3 text-xs font-bold uppercase tracking-wider text-gray-400",children:"Personal Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{label:"Full Name",value:`${s.firstName} ${s.lastName}`}),e.jsx(o,{label:"Gender",value:s.gender??"Not specified"}),e.jsx(o,{label:"National ID",value:s.nationalId??"Not provided"}),e.jsx(o,{label:"Date of Birth",value:s.dateOfBirth?new Date(s.dateOfBirth).toLocaleDateString():"Not provided"})]})]}),e.jsxs("section",{children:[e.jsx("h4",{className:"mb-3 text-xs font-bold uppercase tracking-wider text-gray-400",children:"Contact Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(o,{label:"Email Address",value:s.email}),e.jsx(o,{label:"Phone Number",value:s.phone}),e.jsx(o,{label:"Address / Location",value:`${s.address??""} ${s.ward?", "+s.ward:""}`})]})]})]})}function I({member:s}){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{children:[e.jsx("h4",{className:"mb-3 text-xs font-bold uppercase tracking-wider text-gray-400",children:"Professional Background"}),e.jsx(o,{label:"Occupation",value:s.occupation??"Not specified"}),e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Skills"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-2",children:s.skills?.length?s.skills.map(t=>e.jsx("span",{className:"rounded bg-blue-50 px-2 py-1 text-xs font-semibold text-blue-700",children:t},t)):e.jsx("span",{className:"text-sm text-gray-400",children:"None listed"})})]})]}),e.jsxs("section",{children:[e.jsx("h4",{className:"mb-3 text-xs font-bold uppercase tracking-wider text-gray-400",children:"Interests"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.interests?.length?s.interests.map(t=>e.jsx("span",{className:"rounded bg-wiria-yellow bg-opacity-20 px-2 py-1 text-xs font-semibold text-wiria-blue-dark",children:t},t)):e.jsx("span",{className:"text-sm text-gray-400",children:"None listed"})})]}),e.jsxs("section",{className:"mb-4 rounded-xl border border-blue-100 bg-blue-50/50 p-4",children:[e.jsx("h4",{className:"mb-3 text-xs font-bold uppercase tracking-wider text-blue-900",children:"Membership Context"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{label:"Type",value:s.membershipType}),s.membershipType==="GROUP"&&e.jsxs(e.Fragment,{children:[e.jsx(o,{label:"Group Name",value:s.groupName??"N/A"}),e.jsx(o,{label:"Current Count",value:s.currentMemberCount?.toString()??"0"}),e.jsx(o,{label:"Max Members Reached",value:s.maxMemberCountReached?.toString()??"0"}),e.jsxs("div",{className:"col-span-2 mt-4",children:[e.jsx("h5",{className:"mb-2 text-[10px] font-bold uppercase tracking-wider text-gray-400",children:"Group Size History"}),e.jsx(L,{memberId:s.id})]})]})]})]}),e.jsxs("section",{className:"rounded-xl border border-gray-100 bg-gray-50 p-4",children:[e.jsx("h4",{className:"mb-2 text-xs font-bold uppercase tracking-wider text-wiria-blue-dark",children:"Member Status"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Current Status"}),e.jsx("div",{className:"mt-1 font-bold",children:s.status})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Member Number"}),e.jsx("p",{className:"font-mono font-bold text-wiria-blue-dark",children:s.memberNumber})]})]})]})]})}function R({member:s,onClose:t,onStatusChange:r}){if(!s)return null;const i=async()=>{try{await E(s.id),x.success(`${s.firstName} has been approved!`),r(),t()}catch(n){x.error(h(n,"Failed to approve member"))}},a=async()=>{try{await P(s.id,"Rejected by admin"),x.success("Application rejected"),r(),t()}catch(n){x.error(h(n,"Failed to reject member"))}};return e.jsx(v,{isOpen:!0,onClose:t,title:"Member Application Review",size:"3xl",children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid gap-8 md:grid-cols-2",children:[e.jsx(T,{member:s}),e.jsx(I,{member:s})]}),e.jsxs("div",{className:"mt-8 flex flex-wrap items-center gap-4 border-t pt-6",children:[s.status===y.PENDING?e.jsxs(e.Fragment,{children:[e.jsx(u,{onClick:()=>{i()},className:"flex-1 bg-green-600 hover:bg-green-700",children:"✓ Approve Membership"}),e.jsx(u,{onClick:()=>{a()},className:"flex-1 bg-red-600 hover:bg-red-700",children:"✗ Reject Application"})]}):e.jsxs("div",{className:"flex-1 rounded-xl bg-gray-100 py-3 text-center font-bold text-gray-600",children:["Resolution: ",s.status," (Processed on"," ",new Date(s.updatedAt).toLocaleDateString(),")"]}),e.jsx(u,{variant:"outline",onClick:t,className:"flex-grow md:flex-none",children:"Close Review"})]})]})})}function o({label:s,value:t}){return e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:s}),e.jsx("p",{className:"font-semibold",children:t})]})}function F(s,t=300){const[r,i]=l.useState(s);return l.useEffect(()=>{const a=setTimeout(()=>{i(s)},t);return()=>{clearTimeout(a)}},[s,t]),r}function $({currentFilter:s,onFilterChange:t,onSearch:r}){const[i,a]=l.useState(""),n=F(i,N.DEBOUNCE_DEFAULT);l.useEffect(()=>{r(n)},[n,r]);const c=d=>{const g=d.target.value;a(g)},p=[{id:"ALL",label:"All Members"},{id:"PENDING",label:"Pending"},{id:"ACTIVE",label:"Active"},{id:"CANCELLED",label:"Cancelled"},{id:"EXPIRED",label:"Expired"}];return e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsx("div",{className:"flex space-x-2 overflow-x-auto border-b",children:p.map(d=>e.jsx("button",{onClick:()=>t(d.id),className:`whitespace-nowrap border-b-2 px-6 py-3 font-semibold transition-all ${s===d.id?"border-wiria-blue-dark text-wiria-blue-dark":"border-transparent text-gray-600 hover:text-wiria-blue-dark"}`,children:d.label},d.id))}),e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:"Search by name, email, phone, or member number...",className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-transparent focus:ring-2 focus:ring-wiria-blue-dark md:w-96",value:i,onChange:c})})]})}function G({members:s=[],isLoading:t,onViewDetails:r}){const i=l.useMemo(()=>[{header:"Member #",key:"memberNumber",className:"font-mono font-semibold"},{header:"Name",key:"name",render:a=>`${a.firstName} ${a.lastName}`},{header:"Type",key:"membershipType",render:a=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`rounded-md px-2 py-1 text-[10px] font-bold uppercase ${a.membershipType==="GROUP"?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700"}`,children:a.membershipType}),a.membershipType==="GROUP"&&e.jsx("div",{className:"mt-1 text-[10px] font-medium text-gray-500",children:a.groupName})]})},{header:"Contact",key:"contact",render:a=>e.jsxs(e.Fragment,{children:[e.jsx("div",{children:a.email}),e.jsx("div",{className:"text-xs text-gray-500",children:a.phone})]})},{header:"Status",key:"status",render:a=>e.jsx(C,{status:a.status})},{header:"Payment",key:"payment",render:a=>e.jsx(O,{payments:a.payments})},{header:"Join Date",key:"joinDate",render:a=>new Date(a.joinDate).toLocaleDateString()},{header:"Actions",key:"actions",align:"right",render:a=>e.jsx(u,{size:"sm",onClick:()=>r(a),children:"Review"})}],[r]);return e.jsx("div",{className:"overflow-hidden rounded-2xl bg-white shadow-xl","aria-live":"polite","aria-busy":t,children:e.jsx(S,{columns:i,data:s,isLoading:t,rowKey:"id",emptyMessage:"No members found matching your criteria.",className:"rounded-none border-none shadow-none"})})}function O({payments:s}){if(!s||s.length===0)return e.jsx("span",{className:"text-xs text-gray-400",children:"No payments"});const t=s[0];if(!t)return e.jsx("span",{className:"text-xs text-gray-400",children:"No payments"});const r=t.status==="COMPLETED"?"text-green-600":t.status==="FAILED"?"text-red-600":"text-yellow-600";return e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:["KES ",(t.amount||0).toLocaleString()]}),e.jsx("div",{className:`text-xs ${r}`,children:t.status})]})}function B({filter:s,search:t,onFilterChange:r,onSearch:i,selectedMember:a,onSelectMember:n}){const{members:c,isLoading:p,refetch:d}=D();return e.jsxs(e.Fragment,{children:[e.jsx($,{currentFilter:s,onFilterChange:r,onSearch:i}),e.jsx(G,{members:c,isLoading:p,onViewDetails:n}),e.jsx(R,{member:a,onClose:()=>n(null),onStatusChange:()=>{d()}})]})}function V({children:s,filter:t,search:r}){const{items:i,isLoading:a,refetch:n}=k(["admin","members",t,r],()=>A({status:t,search:r}),{arrayKey:"members"});return e.jsx(b.Provider,{value:{members:i,isLoading:a,refetch:async()=>{await n()},filter:t,search:r},children:s})}function te(){const[s,t]=l.useState("ALL"),[r,i]=l.useState(""),a=l.useDeferredValue(r),[n,c]=l.useState(null);return e.jsxs("div",{children:[e.jsx(j,{title:"Member Management",description:"View and manage member applications"}),e.jsx(V,{filter:s,search:a,children:e.jsx(B,{filter:s,search:r,onFilterChange:t,onSearch:i,selectedMember:n,onSelectMember:c})})]})}export{te as default};
//# sourceMappingURL=MemberManagementPage-BZZUJHI8.js.map
