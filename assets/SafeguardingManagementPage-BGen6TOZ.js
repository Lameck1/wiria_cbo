import{j as e,b as F}from"./query-vendor-frBnvHSF.js";import{r as u}from"./react-vendor-BdaLayic.js";import{b as R,l as S,T as M,n as f,d as D}from"./index-ICA0O2oL.js";import{a as V}from"./apiUtils-CDDJc0SC.js";import{A as G}from"./AdminPageHeader-CmCPoIZw.js";import{B as y}from"./Button-K8iFFe9S.js";import{S as _}from"./StatusBadge-DPX4J2hm.js";import{f as U}from"./dateUtils-D0Bnoiug.js";import{D as H}from"./DataTable-D2X_cuFs.js";import{u as $,a as L}from"./useAdminData-B_72029o.js";import"./animation-vendor-CrU7SSpu.js";import"./helpers-Brneqz2V.js";const K=async t=>{try{const r=new URLSearchParams;t!=null&&t.status&&r.append("status",t.status),t!=null&&t.priority&&r.append("priority",t.priority);const s=r.toString()?`?${r.toString()}`:"",n=await R.get(`/safeguarding${s}`);return V(n)}catch(r){throw S.error("Failed to fetch safeguarding reports:",r),new Error("Failed to load safeguarding reports. Please try again.")}},q=async(t,r)=>{try{return await R.patch(`/safeguarding/${t}`,r),!0}catch(s){throw S.error("Failed to update safeguarding report:",s),s}},W=async(t,r)=>{try{return await R.post(`/safeguarding/${t}/resolve`,{resolution:r}),!0}catch(s){throw S.error("Failed to resolve safeguarding report:",s),s}},Q={PENDING:"bg-yellow-100 text-yellow-700",UNDER_REVIEW:"bg-blue-100 text-blue-700",INVESTIGATING:"bg-orange-100 text-orange-700",RESOLVED:"bg-green-100 text-green-700",CLOSED:"bg-gray-100 text-gray-500"},T={CRITICAL:"bg-red-600 text-white",HIGH:"bg-orange-500 text-white",MEDIUM:"bg-yellow-500 text-white",LOW:"bg-green-500 text-white"},O={CHILD_PROTECTION:"Child Protection",SEXUAL_EXPLOITATION:"Sexual Exploitation",HARASSMENT:"Harassment",DISCRIMINATION:"Discrimination",FRAUD:"Fraud",OTHER:"Other"},A=t=>new Date(t).toLocaleDateString("en-KE",{year:"numeric",month:"short",day:"numeric"});function B({report:t,statusColors:r,priorityColors:s,incidentTypes:n,onClose:i,onResolve:c,onStatusChange:o}){const g=t.incidentType??t.category,b=g===void 0?void 0:n[g]??g;return e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 p-4",children:e.jsxs("div",{className:"flex max-h-[90vh] w-full max-w-3xl flex-col rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b p-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-mono text-xl font-bold",children:["Report: ",t.referenceNumber]}),e.jsxs("div",{className:"mt-1 flex gap-2",children:[e.jsx("span",{className:`rounded px-2 py-0.5 text-[10px] font-bold uppercase ${s[t.priority]}`,children:t.priority}),e.jsx("span",{className:`rounded-full px-2 py-0.5 text-[10px] font-bold uppercase ${r[t.status]}`,children:t.status.replace("_"," ")})]})]}),e.jsx("button",{onClick:i,className:"text-2xl text-gray-500 hover:text-gray-700",children:"Ã—"})]}),e.jsxs("div",{className:"flex-1 space-y-6 overflow-y-auto p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsx(x,{label:"Incident Type",value:b}),e.jsx(x,{label:"Incident Date",value:A(t.incidentDate)}),e.jsx(x,{label:"Location",value:t.incidentLocation??t.location}),e.jsx(x,{label:"Reported On",value:A(t.createdAt)}),!t.isAnonymous&&e.jsxs(e.Fragment,{children:[e.jsx(x,{label:"Reporter Name",value:t.reporterName}),e.jsx(x,{label:"Reporter Contact",value:t.reporterEmail??t.reporterPhone??"N/A"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-[10px] font-bold uppercase tracking-widest text-gray-400",children:"Description"}),e.jsx("div",{className:"whitespace-pre-wrap rounded-xl border border-gray-100 bg-gray-50 p-4 leading-relaxed text-gray-700",children:t.description})]}),t.personsInvolved&&e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-[10px] font-bold uppercase tracking-widest text-gray-400",children:"Persons Involved"}),e.jsx("div",{className:"rounded-xl border border-gray-100 bg-gray-50 p-4 text-gray-700",children:t.personsInvolved})]}),t.resolution&&e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-[10px] font-bold uppercase tracking-widest text-green-600",children:"Final Resolution"}),e.jsx("div",{className:"rounded-xl border border-green-100 bg-green-50 p-4 font-medium text-green-800",children:t.resolution})]}),t.status!=="RESOLVED"&&t.status!=="CLOSED"&&e.jsxs("div",{children:[e.jsx("p",{className:"mb-3 text-[10px] font-bold uppercase tracking-widest text-gray-400",children:"Update Status"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["PENDING","UNDER_REVIEW","INVESTIGATING"].map(d=>e.jsx("button",{onClick:()=>o(d),className:`rounded-lg px-4 py-1.5 text-xs font-bold shadow-sm transition-all ${t.status===d?r[d]:"border border-gray-200 bg-white text-gray-500 hover:bg-gray-50"}`,children:d.replace("_"," ")},d))})]})]}),e.jsxs("div",{className:"flex gap-3 border-t p-6",children:[t.status!=="RESOLVED"&&t.status!=="CLOSED"&&e.jsx(y,{onClick:c,children:"Mark as Resolved"}),e.jsx(y,{variant:"secondary",onClick:i,className:"ml-auto",children:"Close"})]})]})})}function x({label:t,value:r}){return e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-gray-400",children:t}),e.jsx("p",{className:"font-semibold text-gray-900",children:r??"N/A"})]})}function Y({report:t,resolution:r,isSubmitting:s,setResolution:n,onResolve:i,onCancel:c}){return e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black bg-opacity-50 p-4",children:e.jsxs("div",{className:"w-full max-w-lg rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"border-b p-6",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Resolve Report"}),e.jsxs("p",{className:"mt-1 font-mono text-sm text-gray-500",children:["Ref: ",t.referenceNumber]})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("label",{htmlFor:"resolution-details",className:"mb-2 block text-sm font-bold text-gray-700",children:"Resolution Details *"}),e.jsx("textarea",{id:"resolution-details",value:r,onChange:o=>n(o.target.value),className:"h-40 w-full rounded-xl border border-gray-200 p-4 outline-none transition-all focus:ring-2 focus:ring-wiria-blue-dark",placeholder:"Please describe how this concern was investigated and resolved in detail...",required:!0}),e.jsx("p",{className:"mt-2 text-[10px] font-medium italic text-gray-400",children:"This resolution will be permanently stored and used for audit purposes."})]}),e.jsxs("div",{className:"flex gap-3 border-t p-6",children:[e.jsx(y,{onClick:i,disabled:s||!r.trim(),className:"flex-1",children:s?"Saving Resolution...":"Confirm Resolution"}),e.jsx(y,{variant:"secondary",onClick:c,disabled:s,children:"Cancel"})]})]})})}function z({statusFilter:t,setStatusFilter:r,priorityFilter:s,setPriorityFilter:n}){return e.jsxs("div",{className:"flex flex-wrap items-center gap-4 rounded-xl border border-gray-100 bg-white p-4 shadow-sm",children:[e.jsx("span",{className:"px-2 text-xs font-bold uppercase tracking-widest text-gray-400",children:"Filters:"}),e.jsxs("select",{value:t,onChange:i=>r(i.target.value),className:"rounded-lg border-none bg-gray-50 px-4 py-2 text-sm font-medium outline-none transition-all focus:ring-2 focus:ring-wiria-blue-dark","aria-label":"Filter by Status",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"UNDER_REVIEW",children:"Under Review"}),e.jsx("option",{value:"INVESTIGATING",children:"Investigating"}),e.jsx("option",{value:"RESOLVED",children:"Resolved"}),e.jsx("option",{value:"CLOSED",children:"Closed"})]}),e.jsxs("select",{value:s,onChange:i=>n(i.target.value),className:"rounded-lg border-none bg-gray-50 px-4 py-2 text-sm font-medium outline-none transition-all focus:ring-2 focus:ring-wiria-blue-dark","aria-label":"Filter by Priority",children:[e.jsx("option",{value:"",children:"All Priorities"}),e.jsx("option",{value:"CRITICAL",children:"Critical"}),e.jsx("option",{value:"HIGH",children:"High"}),e.jsx("option",{value:"MEDIUM",children:"Medium"}),e.jsx("option",{value:"LOW",children:"Low"})]})]})}const X=(t,r)=>[{header:"Reference",key:"referenceNumber",className:"font-mono text-xs font-bold"},{header:"Type",key:"incidentType",render:s=>{const n=s.incidentType??s.category,i=n?O[n]??n:"N/A";return e.jsx("span",{className:"text-sm",children:i})}},{header:"Priority",key:"priority",render:s=>e.jsx("span",{className:`rounded px-2 py-0.5 text-[10px] font-bold uppercase ${T[s.priority]}`,children:s.priority})},{header:"Status",key:"status",render:s=>e.jsx(_,{status:s.status})},{header:"Date",key:"createdAt",render:s=>e.jsx("span",{className:"text-sm text-gray-500",children:U(s.createdAt)})},{header:"Actions",key:"actions",align:"right",render:s=>e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>t(s),className:"text-sm font-bold text-wiria-blue-dark hover:underline",children:"View"}),s.status!=="RESOLVED"&&s.status!=="CLOSED"&&e.jsx("button",{onClick:()=>r(s),className:"text-sm font-bold text-green-600 hover:underline",children:"Resolve"})]})}];function ce(){const t=F(),[r,s]=u.useState(""),[n,i]=u.useState(""),c={...r&&{status:r},...n&&{priority:n}},{items:o,isLoading:g}=$(["safeguarding",c],()=>K(Object.keys(c).length>0?c:void 0),{staleTime:M.POLLING_INTERVAL}),b=L(({id:a,status:p})=>q(a,{status:p}),[["safeguarding"]],{onSuccess:()=>{f.success("Report status updated"),t.invalidateQueries({queryKey:D.notifications})},onError:()=>{f.error("Failed to update report status")}}),d=L(({id:a,resolution:p})=>W(a,p),[["safeguarding"]],{onSuccess:()=>{f.success("Report resolved successfully"),t.invalidateQueries({queryKey:D.notifications})},onError:()=>{f.error("Failed to resolve report")}}),[E,m]=u.useState(null),[I,h]=u.useState(!1),[v,j]=u.useState(""),l=u.useMemo(()=>o.find(a=>a.id===E)??null,[o,E]),k=()=>{!l||!v.trim()||d.mutate({id:l.id,resolution:v},{onSuccess:()=>{h(!1),j(""),m(null)}})},P=X(a=>m(a.id),a=>{m(a.id),h(!0)}),C=o.filter(a=>a.priority==="CRITICAL"&&a.status!=="RESOLVED"&&a.status!=="CLOSED").length,N=o.filter(a=>a.status!=="RESOLVED"&&a.status!=="CLOSED").length;return e.jsxs("div",{className:"space-y-8",children:[e.jsx(G,{title:"Safeguarding Reports",description:"Manage and respond to safeguarding concerns within the community.",children:e.jsxs("div",{className:"flex gap-3",children:[C>0&&e.jsxs("div",{className:"flex animate-pulse items-center gap-2 rounded-xl border border-red-100 bg-red-50 px-4 py-2 shadow-sm",children:[e.jsx("span",{className:"h-2 w-2 rounded-full bg-red-600"}),e.jsxs("span",{className:"text-sm font-bold text-red-700",children:[C," critical"]})]}),N>0&&e.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-yellow-100 bg-yellow-50 px-4 py-2 shadow-sm",children:[e.jsx("span",{className:"h-2 w-2 rounded-full bg-yellow-600"}),e.jsxs("span",{className:"text-sm font-bold text-yellow-700",children:[N," active case",N>1?"s":""]})]})]})}),e.jsx(z,{statusFilter:r,setStatusFilter:s,priorityFilter:n,setPriorityFilter:i}),e.jsx(H,{columns:P,data:o,rowKey:"id",isLoading:g,emptyMessage:"No safeguarding reports found matching your criteria.",rowClassName:a=>a.priority==="CRITICAL"?"bg-red-50/50 hover:bg-red-50":""}),l&&!I&&e.jsx(B,{report:l,statusColors:Q,priorityColors:T,incidentTypes:O,onClose:()=>m(null),onResolve:()=>h(!0),onStatusChange:a=>{l&&(t.setQueriesData({queryKey:["safeguarding"]},p=>(p??[]).map(w=>w.id===l.id?{...w,status:a}:w)),b.mutate({id:l.id,status:a}))}}),I&&l&&e.jsx(Y,{report:l,resolution:v,isSubmitting:d.isPending,setResolution:j,onResolve:k,onCancel:()=>{h(!1),j("")}})]})}export{ce as default};
//# sourceMappingURL=SafeguardingManagementPage-BGen6TOZ.js.map
