import{j as e,b as v}from"./query-vendor-frBnvHSF.js";import{r as f}from"./react-vendor-BdaLayic.js";import{b as h,n as p}from"./index-ICA0O2oL.js";import{u as w}from"./resources.api-2-mmWAeK.js";import{B as g}from"./Button-K8iFFe9S.js";import{M as D}from"./Modal-D8P6KMMh.js";import{g as C}from"./apiUtils-CDDJc0SC.js";import{C as E}from"./ConfirmDialog-BLp-gmhy.js";import{D as S}from"./DataTable-D2X_cuFs.js";import{u as T,a as k}from"./useAdminData-B_72029o.js";import"./animation-vendor-CrU7SSpu.js";import"./helpers-Brneqz2V.js";const A=async(t={})=>{const s=new URLSearchParams;t.status&&s.append("status",t.status),t.category&&s.append("category",t.category),t.all&&s.append("all","true");const l=s.toString(),i=l?`/tenders?${l}`:"/tenders";return h.get(i)},P=async t=>h.post("/tenders",t),F=async(t,s)=>h.patch(`/tenders/${t}`,s),V=async t=>h.delete(`/tenders/${t}`);function j(t,s,l){t(i=>{const r=[...i];return r[s]=l,r})}function N(t){t(s=>[...s,""])}function y(t,s){t(l=>l.filter((i,r)=>r!==s))}function q({tender:t}){return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"border-b pb-1 font-bold text-wiria-blue-dark",children:"Basic Information"}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-title",children:"Tender Title *"}),e.jsx("input",{id:"tender-title",name:"title",defaultValue:t==null?void 0:t.title,className:"w-full rounded-lg border p-2.5",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-refNo",children:"Reference No *"}),e.jsx("input",{id:"tender-refNo",name:"refNo",defaultValue:t==null?void 0:t.refNo,className:"w-full rounded-lg border p-2.5",required:!0,placeholder:"WIRIA/2025/..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-category",children:"Category *"}),e.jsx("input",{id:"tender-category",name:"category",defaultValue:t==null?void 0:t.category,className:"w-full rounded-lg border p-2.5",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-deadline",children:"Deadline *"}),e.jsx("input",{id:"tender-deadline",type:"datetime-local",name:"deadline",defaultValue:t!=null&&t.deadline?new Date(t.deadline).toISOString().slice(0,16):"",className:"w-full rounded-lg border p-2.5",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-estimatedValue",children:"Est. Value"}),e.jsx("input",{id:"tender-estimatedValue",name:"estimatedValue",defaultValue:t==null?void 0:t.estimatedValue,className:"w-full rounded-lg border p-2.5"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-status",children:"Status"}),e.jsxs("select",{id:"tender-status",name:"status",defaultValue:(t==null?void 0:t.status)??"OPEN",className:"w-full rounded-lg border p-2.5",children:[e.jsx("option",{value:"OPEN",children:"Open"}),e.jsx("option",{value:"CLOSED",children:"Closed"}),e.jsx("option",{value:"AWARDED",children:"Awarded"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"})]})]})]})}function M({tender:t}){return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"border-b pb-1 font-bold text-wiria-blue-dark",children:"Submission & Contact"}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-submissionMethod",children:"Submission Method *"}),e.jsxs("select",{id:"tender-submissionMethod",name:"submissionMethod",defaultValue:(t==null?void 0:t.submissionMethod)??"ONLINE",className:"w-full rounded-lg border p-2.5",children:[e.jsx("option",{value:"ONLINE",children:"Online (Email)"}),e.jsx("option",{value:"PHYSICAL",children:"Physical (Seal Box)"}),e.jsx("option",{value:"BOTH",children:"Both"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-submissionEmail",children:"Submission Email *"}),e.jsx("input",{id:"tender-submissionEmail",type:"email",name:"submissionEmail",defaultValue:(t==null?void 0:t.submissionEmail)??"tenders@wiria.org",className:"w-full rounded-lg border p-2.5",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-contactPerson",children:"Contact Person *"}),e.jsx("input",{id:"tender-contactPerson",name:"contactPerson",defaultValue:t==null?void 0:t.contactPerson,className:"w-full rounded-lg border p-2.5",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-contactPhone",children:"Contact Phone *"}),e.jsx("input",{id:"tender-contactPhone",name:"contactPhone",defaultValue:t==null?void 0:t.contactPhone,className:"w-full rounded-lg border p-2.5",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-file-input",children:"Tender Document (PDF)"}),e.jsx("input",{type:"file",id:"tender-file-input",className:"w-full rounded-lg border p-2 text-sm",accept:".pdf,.doc,.docx"}),e.jsx("input",{type:"hidden",name:"downloadUrl",defaultValue:t==null?void 0:t.downloadUrl})]})]})}function O({eligibility:t,requiredDocuments:s,setEligibility:l,setRequiredDocuments:i}){return e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-2 block text-sm font-bold",children:"Eligibility Criteria"}),t.map((r,n)=>e.jsxs("div",{className:"mb-2 flex gap-2",children:[e.jsx("input",{"aria-label":`Eligibility criteria ${n+1}`,value:r,onChange:d=>j(l,n,d.target.value),className:"flex-1 rounded-lg border p-2 text-sm",required:!0}),e.jsx("button",{type:"button",onClick:()=>y(l,n),className:"text-red-500",children:"✕"})]},n)),e.jsx("button",{type:"button",onClick:()=>N(l),className:"text-xs font-bold text-blue-600",children:"+ Add Criteria"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"mb-2 block text-sm font-bold",children:"Required Documents"}),s.map((r,n)=>e.jsxs("div",{className:"mb-2 flex gap-2",children:[e.jsx("input",{"aria-label":`Required document ${n+1}`,value:r,onChange:d=>j(i,n,d.target.value),className:"flex-1 rounded-lg border p-2 text-sm",required:!0}),e.jsx("button",{type:"button",onClick:()=>y(i,n),className:"text-red-500",children:"✕"})]},n)),e.jsx("button",{type:"button",onClick:()=>N(i),className:"text-xs font-bold text-blue-600",children:"+ Add Document"})]})]})}function I({tender:t,eligibility:s,requiredDocuments:l,queryClient:i,onSuccess:r,setIsSubmitting:n}){return async d=>{d.preventDefault(),n(!0);const m=d.currentTarget,c=new FormData(m),o=Object.fromEntries(c.entries()),u=m.querySelector("#tender-file-input");let x=o.downloadUrl||"";try{if(u!=null&&u.files&&u.files.length>0){p.info("Uploading document...");const b=u.files[0];b&&(x=(await w(b,"tenders")).data.url)}const a={title:o.title,refNo:o.refNo,category:o.category,estimatedValue:o.estimatedValue,deadline:new Date(o.deadline).toISOString(),status:o.status,submissionMethod:o.submissionMethod,submissionEmail:o.submissionEmail,contactPerson:o.contactPerson,contactPhone:o.contactPhone,description:o.description,eligibility:s.filter(b=>b.trim()),requiredDocuments:l.filter(b=>b.trim()),downloadUrl:x};t?(await F(t.id,a),p.success("Tender updated")):(await P(a),p.success("Tender advertised")),i.invalidateQueries({queryKey:["tenders"]}),r()}catch(a){p.error(C(a,"Operation failed"))}finally{n(!1)}}}function L({tender:t,onClose:s,onSuccess:l}){const i=v(),[r,n]=f.useState((t==null?void 0:t.eligibility)??["Legal registration in Kenya","Tax compliance"]),[d,m]=f.useState((t==null?void 0:t.requiredDocuments)??["Certificate of Incorporation","KRA PIN/Tax Compliance"]),[c,o]=f.useState(!1),u=I({tender:t,eligibility:r,requiredDocuments:d,queryClient:i,onSuccess:l,setIsSubmitting:o});return e.jsx(D,{isOpen:!0,onClose:s,title:t?"Edit Tender":"Advertise New Tender",size:"3xl",children:e.jsxs("form",{onSubmit:x=>void u(x),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsx(q,{tender:t}),e.jsx(M,{tender:t})]}),e.jsx(O,{eligibility:r,requiredDocuments:d,setEligibility:n,setRequiredDocuments:m}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-bold",htmlFor:"tender-description",children:"Full Description *"}),e.jsx("textarea",{id:"tender-description",name:"description",defaultValue:t==null?void 0:t.description,className:"h-24 w-full rounded-lg border p-3 text-sm",required:!0})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(g,{type:"submit",fullWidth:!0,disabled:c,children:c?"Saving...":t?"Update Tender":"Advertise Tender"}),e.jsx(g,{type:"button",variant:"secondary",fullWidth:!0,onClick:s,disabled:c,children:"Cancel"})]})]})})}function Z(){const{items:t,isLoading:s}=T(["tenders",{all:!0}],()=>A({all:!0})),l=k(a=>V(a),[["tenders"]],{onSuccess:()=>{p.success("Tender deleted successfully")},onError:()=>{p.error("Failed to delete tender")}}),[i,r]=f.useState(null),[n,d]=f.useState(!1),[m,c]=f.useState(null),o=a=>{c(a)},u=()=>{m&&(l.mutate(m),c(null))},x=[{header:"Ref No",key:"refNo",className:"font-mono text-xs"},{header:"Title",key:"title",className:"font-semibold"},{header:"Deadline",key:"deadline",render:a=>e.jsx("span",{className:"text-sm",children:new Date(a.deadline).toLocaleDateString()})},{header:"Document",key:"downloadUrl",render:a=>a.downloadUrl?e.jsx("span",{className:"inline-flex items-center gap-1 rounded bg-green-100 px-2 py-0.5 text-[10px] font-bold uppercase text-green-700",children:"✓ Uploaded"}):e.jsx("span",{className:"inline-flex items-center gap-1 rounded bg-yellow-100 px-2 py-0.5 text-[10px] font-bold uppercase text-yellow-700",children:"⚠ Missing"})},{header:"Status",key:"status",render:a=>e.jsx(R,{tender:a})},{header:"Actions",key:"actions",align:"right",render:a=>e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{r(a),d(!0)},className:"text-sm font-bold text-wiria-blue-dark hover:underline",children:"Edit"}),e.jsx("button",{onClick:()=>o(a.id),className:"text-sm font-bold text-red-600 hover:underline",children:"Delete"})]})}];return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("header",{className:"flex items-center justify-between rounded-2xl border border-gray-100 bg-gray-50/50 p-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-gray-900",children:"Tender Management"}),e.jsx("p",{className:"mt-1 font-medium text-gray-500",children:"Advertise and manage organization procurement opportunities."})]}),e.jsx(g,{onClick:()=>{r(null),d(!0)},children:"+ Advertise New Tender"})]}),e.jsx(S,{columns:x,data:t,rowKey:"id",isLoading:s,emptyMessage:"No tenders advertised yet."}),n&&e.jsx(L,{tender:i,onClose:()=>d(!1),onSuccess:()=>d(!1)}),e.jsx(E,{isOpen:m!==null,title:"Delete Tender",message:"Are you sure you want to delete this tender?",confirmLabel:"Delete",onConfirm:u,onCancel:()=>c(null)})]})}function R({tender:t}){const l=t.status==="OPEN"&&new Date(t.deadline)<new Date?"EXPIRED":t.status,i={OPEN:"bg-green-100 text-green-700",CLOSED:"bg-red-100 text-red-700",AWARDED:"bg-blue-100 text-blue-700",CANCELLED:"bg-gray-100 text-gray-700",EXPIRED:"bg-yellow-100 text-yellow-700"};return e.jsx("span",{className:`rounded-full px-2 py-1 text-[10px] font-bold uppercase tracking-wider ${i[l]??"bg-gray-100"}`,children:l})}export{Z as default};
//# sourceMappingURL=TenderManagementPage-BvcVeiKO.js.map
