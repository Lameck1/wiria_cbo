import{j as e}from"./query-vendor-CM55eWOT.js";import{r as o}from"./react-vendor-CXp26_Hx.js";import{d as g,n as i}from"./index-Ck6qqv4n.js";import{B as b}from"./Button-JX_3oChN.js";import{a as p,g as N}from"./apiUtils-0UX-zM9U.js";import"./animation-vendor-Bcu85ETC.js";const w=async()=>g.get("/updates?limit=100&includeAll=true"),v=async t=>g.post("/updates",t),U=async(t,r)=>g.patch(`/updates/${t}`,r),C=async t=>g.delete(`/updates/${t}`);function T(){const[t,r]=o.useState([]),[c,d]=o.useState(!0),[x,l]=o.useState(null),[m,n]=o.useState(!1),[a,h]=o.useState("ALL"),f=async()=>{d(!0);try{const s=await w();r(p(s))}catch(s){console.error(s),i.error("Failed to load news/updates")}finally{d(!1)}};o.useEffect(()=>{f()},[]);const y=async s=>{if(confirm("Are you sure you want to delete this update?"))try{await C(s),i.success("Update deleted successfully"),f()}catch{i.error("Failed to delete update")}},u=a==="ALL"?t:t.filter(s=>s.status===a),j=t.filter(s=>s.status==="DRAFT").length;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-wiria-blue-dark",children:"News & Updates Management"}),e.jsx(b,{onClick:()=>{l(null),n(!0)},children:"+ Post New Update"})]}),e.jsxs("div",{className:"mb-6 flex gap-2",children:[e.jsxs("button",{onClick:()=>h("ALL"),className:`rounded-lg px-4 py-2 font-semibold transition-colors ${a==="ALL"?"bg-wiria-blue-dark text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["All (",t.length,")"]}),e.jsxs("button",{onClick:()=>h("PUBLISHED"),className:`rounded-lg px-4 py-2 font-semibold transition-colors ${a==="PUBLISHED"?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Published (",t.filter(s=>s.status==="PUBLISHED").length,")"]}),e.jsxs("button",{onClick:()=>h("DRAFT"),className:`flex items-center gap-2 rounded-lg px-4 py-2 font-semibold transition-colors ${a==="DRAFT"?"bg-yellow-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Drafts",j>0&&e.jsx("span",{className:`rounded-full px-2 py-0.5 text-xs font-bold ${a==="DRAFT"?"bg-white text-yellow-600":"bg-yellow-100 text-yellow-700"}`,children:j})]})]}),c?e.jsx("div",{className:"py-12 text-center",children:"Loading..."}):e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:[u&&Array.isArray(u)?u.map(s=>e.jsx(E,{update:s,onEdit:()=>{l(s),n(!0)},onDelete:()=>y(s.id)},s.id)):e.jsx("div",{className:"col-span-full text-red-500",children:"Error: Updates data is corrupted. Please refresh."}),u.length===0&&e.jsx("p",{className:"col-span-full py-12 text-center text-gray-500",children:a==="DRAFT"?"No draft updates. Create one by saving as Draft!":"No updates found."})]}),m&&e.jsx(D,{update:x,onClose:()=>n(!1),onSuccess:()=>{n(!1),f()}})]})}function E({update:t,onEdit:r,onDelete:c}){return e.jsxs("div",{className:"flex h-full flex-col overflow-hidden rounded-xl border-t-4 border-wiria-yellow bg-white shadow-lg",children:[t.imageUrl?e.jsx("img",{src:t.imageUrl,alt:t.title,className:"h-32 w-full object-cover"}):e.jsx("div",{className:"flex h-32 w-full items-center justify-center bg-gray-100 text-gray-400",children:"No Image"}),e.jsxs("div",{className:"flex-grow p-5",children:[e.jsxs("div",{className:"mb-2 flex items-start justify-between",children:[e.jsx("span",{className:"rounded-full bg-blue-100 px-2 py-1 text-xs font-bold text-blue-700",children:t.category}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(t.createdAt).toLocaleDateString()})]}),e.jsx("h3",{className:"mb-2 line-clamp-2 text-lg font-bold text-wiria-blue-dark",children:t.title}),e.jsx("p",{className:"line-clamp-3 text-sm text-gray-600",children:t.excerpt||(t.fullContent?t.fullContent.substring(0,150)+"...":"No content available")}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:`rounded px-2 py-1 text-xs font-bold ${t.status==="PUBLISHED"?"bg-green-100 text-green-700":"bg-gray-200 text-gray-700"}`,children:t.status})})]}),e.jsxs("div",{className:"mt-auto flex justify-end gap-3 border-t bg-gray-50 p-4",children:[e.jsx("button",{onClick:r,className:"text-sm font-bold text-wiria-blue-dark hover:underline",children:"Edit"}),e.jsx("button",{onClick:c,className:"text-sm font-bold text-red-600 hover:underline",children:"Delete"})]})]})}function D({update:t,onClose:r,onSuccess:c}){const d=async x=>{x.preventDefault();const l=new FormData(x.currentTarget),m={title:l.get("title"),imageUrl:l.get("imageUrl"),category:l.get("category"),status:l.get("status"),fullContent:l.get("fullContent"),excerpt:l.get("excerpt")};try{t?(await U(t.id,m),i.success("Update modified successfully")):(await v(m),i.success("Update created successfully")),c()}catch(n){i.error(N(n,"Operation failed"))}};return e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 p-4",children:e.jsxs("div",{className:"flex max-h-[90vh] w-full max-w-3xl flex-col rounded-2xl bg-white shadow-2xl",children:[e.jsx("div",{className:"border-b p-6",children:e.jsx("h3",{className:"text-2xl font-bold",children:t?"Edit Update":"Post New Update"})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("form",{id:"news-form",onSubmit:d,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-bold",htmlFor:"news-title",children:"Title"}),e.jsx("input",{id:"news-title",name:"title",defaultValue:t==null?void 0:t.title,className:"w-full rounded-lg border p-3",required:!0,placeholder:"e.g. New Community Program Launch"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-bold",htmlFor:"news-imageUrl",children:"Image URL (Optional)"}),e.jsx("input",{id:"news-imageUrl",name:"imageUrl",defaultValue:t==null?void 0:t.imageUrl,className:"w-full rounded-lg border p-3",placeholder:"https://..."})]}),e.jsxs("div",{className:"mb-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-bold",htmlFor:"news-category",children:"Category"}),e.jsxs("select",{id:"news-category",name:"category",defaultValue:(t==null?void 0:t.category)||"GENERAL",className:"w-full rounded-lg border p-3",children:[e.jsx("option",{value:"GENERAL",children:"General"}),e.jsx("option",{value:"EVENT",children:"Event"}),e.jsx("option",{value:"ANNOUNCEMENT",children:"Announcement"}),e.jsx("option",{value:"STORY",children:"Success Story"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-bold",htmlFor:"news-status",children:"Status"}),e.jsxs("select",{id:"news-status",name:"status",defaultValue:(t==null?void 0:t.status)||"PUBLISHED",className:"w-full rounded-lg border p-3",children:[e.jsx("option",{value:"PUBLISHED",children:"Published"}),e.jsx("option",{value:"DRAFT",children:"Draft"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"mb-2 block text-sm font-bold",htmlFor:"news-fullContent",children:"Content"}),e.jsx("textarea",{id:"news-fullContent",name:"fullContent",defaultValue:t==null?void 0:t.fullContent,className:"h-48 w-full rounded-lg border p-3",required:!0,placeholder:"Describe the update in detail..."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-bold",htmlFor:"news-excerpt",children:"Excerpt (Optional)"}),e.jsx("textarea",{id:"news-excerpt",name:"excerpt",defaultValue:t==null?void 0:t.excerpt,className:"h-20 w-full rounded-lg border p-3",placeholder:"Short summary..."})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(b,{type:"submit",fullWidth:!0,children:"Save Post"}),e.jsx(b,{type:"button",variant:"secondary",fullWidth:!0,onClick:r,children:"Cancel"})]})]})})]})})}export{T as default};
//# sourceMappingURL=NewsManagementPage-tLCxNyRU.js.map
