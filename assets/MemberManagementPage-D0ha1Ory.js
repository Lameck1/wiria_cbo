import{j as e}from"./query-vendor-DD8i-cqI.js";import{r as o,h as k}from"./react-vendor-CPrm261X.js";import{B as u}from"./Button-CwtQO0gO.js";import{a as g,n as h}from"./index-C0i1O_L5.js";import{S as M}from"./Spinner-WBeB5_B5.js";import{a as S}from"./dateFormat-IzS6Qn-3.js";import{e as C}from"./apiUtils-BfmRaJyO.js";import"./animation-vendor-DKvKsx_2.js";function L({members:s=[],isLoading:t,onViewDetails:r}){return t?e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-12 text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-4 border-wiria-blue-dark/20 border-t-wiria-blue-dark"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading members..."})]}):s.length===0?e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-12 text-center text-gray-500",children:[e.jsx("p",{className:"text-lg font-semibold",children:"No members found"}),e.jsx("p",{className:"text-sm mt-2",children:"Try changing your filter or search criteria"})]}):e.jsx("div",{className:"bg-white rounded-2xl shadow-xl overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b border-gray-100",children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Member #"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Contact"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Payment"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Join Date"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:s.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-mono font-semibold text-gray-900",children:a.memberNumber}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900",children:[a.firstName," ",a.lastName]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[e.jsx("span",{className:`px-2 py-1 rounded-md text-[10px] uppercase font-bold ${a.membershipType==="GROUP"?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700"}`,children:a.membershipType}),a.membershipType==="GROUP"&&e.jsx("div",{className:"text-[10px] text-gray-500 font-medium mt-1",children:a.groupName})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:[e.jsx("div",{children:a.email}),e.jsx("div",{className:"text-xs",children:a.phone})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(A,{status:a.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx(E,{payments:a.payments})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:new Date(a.joinDate).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx(u,{size:"sm",onClick:()=>r(a),children:"Review"})})]},a.id))})]})})})}function A({status:s}){const t={PENDING:"bg-yellow-100 text-yellow-800",ACTIVE:"bg-green-100 text-green-800",CANCELLED:"bg-red-100 text-red-800",EXPIRED:"bg-gray-100 text-gray-800"};return e.jsx("span",{className:`px-3 py-1 inline-flex text-xs leading-5 font-bold rounded-full ${t[s]}`,children:s})}function E({payments:s}){if(!s||s.length===0)return e.jsx("span",{className:"text-gray-400 text-xs",children:"No payments"});const t=s[0],r=t.status==="COMPLETED"?"text-green-600":t.status==="FAILED"?"text-red-600":"text-yellow-600";return e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:["KES ",t.amount.toLocaleString()]}),e.jsx("div",{className:`text-xs ${r}`,children:t.status})]})}function D({currentFilter:s,onFilterChange:t,onSearch:r}){const a=[{id:"ALL",label:"All Members"},{id:"PENDING",label:"Pending"},{id:"ACTIVE",label:"Active"},{id:"CANCELLED",label:"Cancelled"},{id:"EXPIRED",label:"Expired"}];return e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsx("div",{className:"flex space-x-2 border-b overflow-x-auto",children:a.map(n=>e.jsx("button",{onClick:()=>t(n.id),className:`px-6 py-3 font-semibold transition-all border-b-2 whitespace-nowrap ${s===n.id?"border-wiria-blue-dark text-wiria-blue-dark":"border-transparent text-gray-600 hover:text-wiria-blue-dark"}`,children:n.label},n.id))}),e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:"Search by name, email, phone, or member number...",className:"w-full md:w-96 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-wiria-blue-dark focus:border-transparent",onChange:n=>r(n.target.value)})})]})}const P=async(s={})=>{const t=new URLSearchParams;return s.status&&s.status!=="ALL"&&t.append("status",s.status),s.search&&t.append("search",s.search),await g.get(`/admin/members?${t.toString()}`)},I=async s=>await g.patch(`/admin/members/${s}/approve`),R=async(s,t)=>await g.patch(`/admin/members/${s}/reject`,{reason:t});function $({memberId:s}){const[t,r]=o.useState([]),[a,n]=o.useState(!0);return o.useEffect(()=>{(async()=>{try{const d=await g.get(`/admin/members/${s}/history`);r(d.data||[])}catch(d){console.error("Failed to fetch group history:",d)}finally{n(!1)}})()},[s]),a?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(M,{size:"sm"})}):t.length===0?e.jsx("div",{className:"text-center py-4 text-gray-500 text-sm italic",children:"No group size history recorded."}):e.jsx("div",{className:"space-y-3",children:t.map(l=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg border border-gray-100",children:[e.jsx("div",{className:"bg-blue-100 text-blue-700 p-2 rounded-full text-xs font-bold",children:l.newCount>l.oldCount?"↑":"↓"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsxs("span",{className:"text-sm font-bold text-gray-900",children:[l.oldCount," → ",l.newCount," Members"]}),e.jsx("span",{className:"text-[10px] text-gray-500",children:S(l.createdAt)})]}),e.jsx("p",{className:"text-xs text-gray-600 line-clamp-1",children:l.reason||"Manual Update"})]})]},l.id))})}function T({member:s,onClose:t,onStatusChange:r}){var l,d,m,x;if(!s)return null;const a=async()=>{if(confirm(`Approve membership for ${s.firstName} ${s.lastName}?`))try{await I(s.id),h.success(`${s.firstName} has been approved!`),r(),t()}catch(i){h.error(i.userMessage||"Failed to approve member")}},n=async()=>{const i=prompt(`Reject ${s.firstName}? Please provide a reason:`);if(i)try{await R(s.id,i),h.success("Application rejected"),r(),t()}catch(b){h.error(b.userMessage||"Failed to reject member")}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[70] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-5xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"p-8 pb-4 border-b flex justify-between items-center",children:[e.jsx("h3",{className:"text-2xl font-bold",children:"Member Application Review"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 text-3xl",children:"×"})]}),e.jsxs("div",{className:"p-8 pt-4 overflow-y-auto flex-1",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{children:[e.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-3",children:"Personal Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(c,{label:"Full Name",value:`${s.firstName} ${s.lastName}`}),e.jsx(c,{label:"Gender",value:s.gender||"Not specified"}),e.jsx(c,{label:"National ID",value:s.nationalId||"Not provided"}),e.jsx(c,{label:"Date of Birth",value:s.dateOfBirth?new Date(s.dateOfBirth).toLocaleDateString():"Not provided"})]})]}),e.jsxs("section",{children:[e.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-3",children:"Contact Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{label:"Email Address",value:s.email}),e.jsx(c,{label:"Phone Number",value:s.phone}),e.jsx(c,{label:"Address / Location",value:`${s.address||""} ${s.ward?", "+s.ward:""}`})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{children:[e.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-3",children:"Professional Background"}),e.jsx(c,{label:"Occupation",value:s.occupation||"Not specified"}),e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Skills"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:(l=s.skills)!=null&&l.length?s.skills.map(i=>e.jsx("span",{className:"bg-blue-50 text-blue-700 px-2 py-1 rounded text-xs font-semibold",children:i},i)):e.jsx("span",{className:"text-gray-400 text-sm",children:"None listed"})})]})]}),e.jsxs("section",{children:[e.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-3",children:"Interests"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(d=s.interests)!=null&&d.length?s.interests.map(i=>e.jsx("span",{className:"bg-wiria-yellow bg-opacity-20 text-wiria-blue-dark px-2 py-1 rounded text-xs font-semibold",children:i},i)):e.jsx("span",{className:"text-gray-400 text-sm",children:"None listed"})})]}),e.jsxs("section",{className:"bg-blue-50/50 p-4 rounded-xl border border-blue-100 mb-4",children:[e.jsx("h4",{className:"text-xs font-bold text-blue-900 uppercase tracking-wider mb-3",children:"Membership Context"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(c,{label:"Type",value:s.membershipType}),s.membershipType==="GROUP"&&e.jsxs(e.Fragment,{children:[e.jsx(c,{label:"Group Name",value:s.groupName||"N/A"}),e.jsx(c,{label:"Current Count",value:((m=s.currentMemberCount)==null?void 0:m.toString())||"0"}),e.jsx(c,{label:"Max Members Reached",value:((x=s.maxMemberCountReached)==null?void 0:x.toString())||"0"}),e.jsxs("div",{className:"col-span-2 mt-4",children:[e.jsx("h5",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-2",children:"Group Size History"}),e.jsx($,{memberId:s.id})]})]})]})]}),e.jsxs("section",{className:"bg-gray-50 p-4 rounded-xl border border-gray-100",children:[e.jsx("h4",{className:"text-xs font-bold text-wiria-blue-dark uppercase tracking-wider mb-2",children:"Member Status"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Current Status"}),e.jsx("div",{className:"mt-1 font-bold",children:s.status})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Member Number"}),e.jsx("p",{className:"font-mono font-bold text-wiria-blue-dark",children:s.memberNumber})]})]})]})]})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t flex flex-wrap gap-4 items-center",children:[s.status==="PENDING"?e.jsxs(e.Fragment,{children:[e.jsx(u,{onClick:a,className:"bg-green-600 hover:bg-green-700 flex-1",children:"✓ Approve Membership"}),e.jsx(u,{onClick:n,className:"bg-red-600 hover:bg-red-700 flex-1",children:"✗ Reject Application"})]}):e.jsxs("div",{className:"flex-1 text-center py-3 bg-gray-100 rounded-xl text-gray-600 font-bold",children:["Resolution: ",s.status," (Processed on ",new Date(s.updatedAt).toLocaleDateString(),")"]}),e.jsx(u,{variant:"outline",onClick:t,className:"flex-grow md:flex-none",children:"Close Review"})]})]})]})})}function c({label:s,value:t}){return e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:s}),e.jsx("p",{className:"font-semibold",children:t})]})}function X(){const[s,t]=k(),[r,a]=o.useState([]),[n,l]=o.useState(!0),[d,m]=o.useState("ALL"),[x,i]=o.useState(""),[b,f]=o.useState(null),j=s.get("highlight"),y=async()=>{l(!0);try{const p=await P({status:d,search:x}),N=C(p,"members");if(a(N),j){const w=N.find(v=>v.id===j);w&&(f(w),s.delete("highlight"),t(s,{replace:!0}))}}catch(p){console.error(p),h.error("Failed to load members")}finally{l(!1)}};return o.useEffect(()=>{const p=setTimeout(()=>{y()},500);return()=>clearTimeout(p)},[d,x]),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-wiria-blue-dark",children:"Member Management"}),e.jsx("p",{className:"text-gray-600",children:"View and manage member applications"})]}),e.jsx(D,{currentFilter:d,onFilterChange:m,onSearch:i}),e.jsx(L,{members:r,isLoading:n,onViewDetails:f}),e.jsx(T,{member:b,onClose:()=>f(null),onStatusChange:y})]})}export{X as default};
//# sourceMappingURL=MemberManagementPage-D0ha1Ory.js.map
